<!DOCTYPE html><html lang="kr"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><script>
            (function(c,l,a,r,i,t,y){
                c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
                t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
                y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
            })(window, document, "clarity", "script", "446ekw0kl6");
            </script><script data-ad-client="ca-pub-8002857692825455" async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><meta name="naver-site-verification" content="0738293103ffff9ea9eb43b3c9621e5fb353f97b"/><meta name="generator" content="Gatsby 5.14.5"/><meta data-react-helmet="true" name="description" content="목표 회사의 내부 전산 작업화를 위해 ERP 서버를 구축해
데이터를 한 곳에 모으고, 추적하고, 관리하기 docker-compose.yml 파일 하나로 구성 odoo -- postgresql -- nginx -- nagios 형태가 된다 Step by Step Docker…"/><meta data-react-helmet="true" property="og:title" content="ERP 서버 개발 스텝 바이 스텝 &amp; 회고"/><meta data-react-helmet="true" property="og:description" content="목표 회사의 내부 전산 작업화를 위해 ERP 서버를 구축해
데이터를 한 곳에 모으고, 추적하고, 관리하기 docker-compose.yml 파일 하나로 구성 odoo -- postgresql -- nginx -- nagios 형태가 된다 Step by Step Docker…"/><meta data-react-helmet="true" property="og:type" content="website"/><style data-href="/styles.903cab3a6739cf62f9b3.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#f8f8f2;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;text-shadow:0 1px rgba(0,0,0,.3);white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.class-name,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}:root{--main-color:#2a2a2a;--second-color:#e0e0e0;--heading-color:#ff8c00}[data-theme=dark]{--main-color:silver;--second-color:#000;--heading-color:salmon}body{background-color:var(--main-color,var(--second-color));color:var(--second-color);font-family:sans-serif;font-size:19px;margin:1rem auto;max-width:900px;padding:1rem}.blog-post-item{border-left:2px solid #404040;line-height:1.2;margin-bottom:32px;padding-left:16px}.blog-post-item:last-child{margin-bottom:0}@media (max-width:767px){.blog-post-item{border-left:1px solid #404040;margin-bottom:24px;padding-left:12px}}@media (min-width:768px){body{background-color:#2a2a2a;letter-spacing:.01em;line-height:1.7}body,p{color:#e0e0e0}p{margin-bottom:1.2em;text-align:justify}h1,h2,h3,h4,h5,h6{color:#f0f0f0;line-height:1.4;margin-bottom:.8em}h1{border-bottom:2px solid #404040;font-size:2.2em;padding-bottom:.3em}h2{border-bottom:1px solid #404040;font-size:1.8em;padding-bottom:.2em}h3{color:#d0d0d0;font-size:1.4em}a{border-bottom:1px solid transparent;color:#7bb3d1;text-decoration:none;transition:border-bottom-color .2s ease}a:hover{border-bottom-color:#7bb3d1}a:visited{color:#7bb3ce}pre{background:#1e1e1e;border:1px solid #404040;border-radius:6px;margin:1.5em 0;padding:20px}code{background:rgba(255,157,107,.1);border-radius:3px;color:#ff9d6b;padding:2px 6px}blockquote{background:hsla(0,0%,100%,.02);border-left:2px solid #555;color:#b8b8b8;font-style:italic;margin:1.5em 0;padding:1em 1.2em}ol,ul{margin:1.2em 0;padding-left:2em}li{line-height:1.6;margin:.5em 0}figcaption{color:#b0b0b0;font-size:.9em;margin-top:.5em}.content-toc a{color:#7bb3d1;margin:0;padding:0;text-decoration:underline;transition:color .2s ease}.content-toc a:hover{color:#9bc7e0}article header,article section,article small{line-height:1.2}.square,.square-field{line-height:1.3}.square ul{line-height:1.2;margin-top:.5em}.square li{line-height:1.2;margin:.2em 0}}h1{color:var(--heading-color)}h2:before{content:"# "}h2,h3,h4{margin-left:-15px;margin-top:50px}h4:before{content:"## "}p{color:var(--second-color,var(--main-color));margin-bottom:0}ul{margin-top:0;padding-inline-start:20px}ul p{margin:0}li{margin-bottom:5px;margin-top:5px}a{color:#40a0bd;display:inline-block;max-width:100%;overflow:hidden;text-overflow:ellipsis;vertical-align:top}a:visited{color:#40a0ba}pre{background:#161b22;padding:15px}code{color:salmon;display:block;overflow:auto;word-break:break-all}blockquote{font-style:italic}header h3{margin:2em 0 0}:target:before{content:"";display:block;height:50px;margin-top:-50px}@media (min-width:1200px){.content-toc{display:block;max-height:60vh;overflow-x:hidden;overflow-y:auto;padding:0 20px;position:fixed;right:0;top:300px;width:20%}.toc-header{top:280px}}@media (max-width:1200px){.content-toc{margin-top:50px}}@media (max-width:600px){.square{grid-column:1/4}.square-center{display:none!important}}.square-field{grid-gap:10px;display:grid;font-weight:700;grid-template-areas:". . ." ". center ." ". . .";grid-template-columns:repeat(3,1fr)}.square{border:1px solid #fff;border-radius:5px;overflow:hidden;padding:10px;text-overflow:ellipsis}.square-center{align-items:center;background:linear-gradient(90deg,#6a11cb 0,#2575fc);border-radius:5px;color:#fff;display:flex;grid-area:center;justify-content:center}.rel{display:inline-block;opacity:.8;padding:5px}:not(pre)>code[class*=language-]{background:none;color:salmon;display:inline}figcaption{color:#999;font-size:.8em;text-align:center}</style><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><title data-react-helmet="true">ERP 서버 개발 스텝 바이 스텝 &amp; 회고 | SH</title><link rel="sitemap" type="application/xml" href="/sitemap-index.xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-GPKPTMNVF5"></script><script>
    window.GATSBY_GTAG_PLUGIN_GA_TRACKING_ID = (
      'G-GPKPTMNVF5'
    );
    window.GATSBY_GTAG_PLUGIN_ANONYMIZE = false;

    var options = {
      send_page_view: false
    };
    if (false) {
      options.anonymize_ip = true;
    }

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    window.gtag = gtag;
    gtag('js', new Date());
    gtag('config', 'G-GPKPTMNVF5', options);
  </script></head><body class=""><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><header><nav><a href="/">SH</a> | <a href="/tags/">WIKI</a> | <a href="/about/">ABOUT</a></nav></header><br/>---<main><article><header><h1>ERP 서버 개발 스텝 바이 스텝 &amp; 회고</h1><p>odoo와 docker-compose를 이용한 erp 서버 구축</p><small style="width:50%">Created: <!-- -->2020, 03 23<!-- --> &gt;<a href="https://github.com/shdkej/shdkej.github.io/blame/master/content/blog/Deploy_ERP_server_story.md">Updated: <!-- -->2021, 06 15</a></small></header><nav class="content-toc"><strong>Table of Contents</strong><div><ul>
<li>
<p><a href="#%EB%AA%A9%ED%91%9C">목표</a></p>
</li>
<li>
<p><a href="#step-by-step">Step by Step</a></p>
<ul>
<li><a href="#docker%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%84%9C-%EC%96%B4%EB%96%A4-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%EB%8F%84-%EC%89%BD%EA%B3%A0-%EB%B9%A0%EB%A5%B4%EA%B2%8C-%EC%84%9C%EB%B2%84%EB%A5%BC-%EA%B4%80%EB%A6%AC">Docker를 사용해서 어떤 환경에서도 쉽고 빠르게 서버를 관리</a></li>
<li><a href="#docker-compose-%EB%A1%9C-%EC%97%AC%EB%9F%AC-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B0%99%EC%9D%B4-%EA%B4%80%EB%A6%AC%ED%95%9C%EB%8B%A4">docker compose 로 여러 서비스 같이 관리한다</a></li>
<li><a href="#%EC%88%98%EC%A0%95%ED%95%98%EA%B3%A0-%EC%A7%80%EC%9B%A0%EB%8B%A4%EA%B0%80-%EB%8B%A4%EC%8B%9C-%EC%8B%A4%ED%96%89%ED%95%B4%EB%B3%B4%EA%B8%B0">수정하고 지웠다가 다시 실행해보기</a></li>
<li><a href="#docker-compose-%ED%99%95%EC%9E%A5-%EB%B0%8F-%EA%B0%9C%EC%84%A0">docker-compose 확장 및 개선</a></li>
<li><a href="#%EA%B0%84%EB%8B%A8%ED%95%9C-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81%EC%9D%84-%EC%9C%84%ED%95%B4-nagios%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%96%88%EB%8B%A4">간단한 모니터링을 위해 nagios를 이용했다</a></li>
<li><a href="#%EC%B6%94%EA%B0%80%EB%A1%9C-ssl-%EC%84%A4%EC%A0%95">추가로 SSL 설정</a></li>
</ul>
</li>
<li>
<p><a href="#%EC%95%84%EC%89%AC%EC%9A%B4-%EC%A0%90">아쉬운 점</a></p>
</li>
</ul></div></nav><div style="border-top:1px solid;align:center"></div><section><h2 id="목표" style="position:relative;"><a href="#%EB%AA%A9%ED%91%9C" aria-label="목표 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>목표</h2>
<p>회사의 내부 전산 작업화를 위해 ERP 서버를 구축해
데이터를 한 곳에 모으고, 추적하고, 관리하기</p>
<p>docker-compose.yml 파일 하나로 구성</p>
<ul>
<li>odoo -- postgresql -- nginx -- nagios 형태가 된다</li>
</ul>
<h2 id="step-by-step" style="position:relative;"><a href="#step-by-step" aria-label="step by step permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Step by Step</h2>
<h3 id="docker를-사용해서-어떤-환경에서도-쉽고-빠르게-서버를-관리" style="position:relative;"><a href="#docker%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%84%9C-%EC%96%B4%EB%96%A4-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%EB%8F%84-%EC%89%BD%EA%B3%A0-%EB%B9%A0%EB%A5%B4%EA%B2%8C-%EC%84%9C%EB%B2%84%EB%A5%BC-%EA%B4%80%EB%A6%AC" aria-label="docker를 사용해서 어떤 환경에서도 쉽고 빠르게 서버를 관리 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker를 사용해서 어떤 환경에서도 쉽고 빠르게 서버를 관리</h3>
<p>docker 에 대해서는 <a href="https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html">subicura님의 블로그</a>에 잘 정리되어 있어서 이것을 보면 바로
사용가능할 것 같다.</p>
<p>우분투 기준 설치 방법</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">apt install -y docker.io
usermod -aG docker $USER

curl -L https://github.com/docker/compose/releases/download/1.24.0/docker-compose-`uname -s`-`uname -m` -o /usr/bin/docker-compose
chmod 755 /usr/bin/docker-compose
chmod +x /usr/bin/docker-compose</code></pre></div>
<p>오픈소스 ERP 프레임워크를 이용해서 필요한 것에만 집중하고 빠르게 개발
python 기반의 odoo 이용
javascript, c++, php 기반의 다른 프레임워크도 있었지만 파이썬을 써보고 싶고,
MVC 구조에 모듈로 잘 구성되어 있고 지원해주는 기능이 많아서 odoo 사용</p>
<p>docker 이미지도 제공되어 있어 바로 사용 가능</p>
<p>DB는 mysql, mssql, postgresql을 두고 봤을 때 postgresql이 docker에서 볼륨상태를
그대로 옮기기 좋다고 하여 사용.</p>
<p><code class="language-text">docker-compose.yml</code> 기본 뼈대</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">version: '3'
services:
  erp:
    image: odoo:10.0

  db:
    image: postgres:9.4</code></pre></div>
<h3 id="docker-compose-로-여러-서비스-같이-관리한다" style="position:relative;"><a href="#docker-compose-%EB%A1%9C-%EC%97%AC%EB%9F%AC-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B0%99%EC%9D%B4-%EA%B4%80%EB%A6%AC%ED%95%9C%EB%8B%A4" aria-label="docker compose 로 여러 서비스 같이 관리한다 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>docker compose 로 여러 서비스 같이 관리한다</h3>
<p>포트, 아이디, 비밀번호 설정 등 추가적인 설정을 더해줬다</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">version: '3'
services:
  erp:
    image: odoo:10.0
    depens_on:
      - db # db 실행 후 erp 서버 실행하도록 설정
    ports:
      - "8069:8069"
    environment:
      - HOST=db
      - USER=odoo
      - PASSWORD=odoo
    volumes:
      - odoo-data:/var/lib/odoo
      - ./addons:/addions_external
    working_dir: /usr/lib/python2.7/dist-packages/odoo/addons

  db:
    image: postgres:9.4
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=odoo
      - POSTGRES_PASSWORD=odoo
    volumes:
      - db-data:/var/lib/postgresql/data

volumes: # 세미콜론(:) 뒤에 공백으로 해두면 docker에서 임의의 위치에 폴더를 잡는다
  odoo-data:
  db-data:</code></pre></div>
<p><code class="language-text">docker-compose up</code> 을 해주면 odoo와 postgresql을 돌릴 수 있다.
브라우저를 띄워서 <code class="language-text">localhost:8069</code> 입력하고 조금 기다리면 화면이 뜬다</p>
<p><figure class="gatsby-resp-image-figure" style="margin: 0 0 50px auto;">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/471204de652bf3688e9110aba927f5f9/29114/erp_first_page.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 54.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAr0lEQVR42u2PTQ7CIBCFuf9JtBQXgDepC09gUrvQ2ojl7zmgbU010YULF77kS5jh8ZhhTb2HdRabqsJKCKy1hlbqhiakgig43ZVjX0oJQd5FKSASywKcc6iSg8UYMfCoVOZOiGibE45d9+R5JTYFRIQQMulsLj3a7ozeeTiqPQVfrIMhnPejdw6b/zDMULcG290hd0xvc5inB5PjzYRzpYmcj9P6dz5e+Vv6B/5g4BUg0lpWSZZvHAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="erp_first_page"
        title=""
        src="/static/471204de652bf3688e9110aba927f5f9/1cfc2/erp_first_page.png"
        srcset="/static/471204de652bf3688e9110aba927f5f9/3684f/erp_first_page.png 225w,
/static/471204de652bf3688e9110aba927f5f9/fc2a6/erp_first_page.png 450w,
/static/471204de652bf3688e9110aba927f5f9/1cfc2/erp_first_page.png 900w,
/static/471204de652bf3688e9110aba927f5f9/21482/erp_first_page.png 1350w,
/static/471204de652bf3688e9110aba927f5f9/d61c2/erp_first_page.png 1800w,
/static/471204de652bf3688e9110aba927f5f9/29114/erp_first_page.png 1920w"
        sizes="(max-width: 900px) 100vw, 900px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">erp_first_page</figcaption>
  </figure></p>
<p>여기까지만 해도 프로그램 자체는 띄울 수 있다
그런데 각 상황에 맞게 수정을 해줘야 하는데,
각 프로그램의 관리 파일을 찾아서 볼륨을 시켜주는 작업을 해야 한다.</p>
<h3 id="수정하고-지웠다가-다시-실행해보기" style="position:relative;"><a href="#%EC%88%98%EC%A0%95%ED%95%98%EA%B3%A0-%EC%A7%80%EC%9B%A0%EB%8B%A4%EA%B0%80-%EB%8B%A4%EC%8B%9C-%EC%8B%A4%ED%96%89%ED%95%B4%EB%B3%B4%EA%B8%B0" aria-label="수정하고 지웠다가 다시 실행해보기 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>수정하고 지웠다가 다시 실행해보기</h3>
<p>처음 아이디와 비밀번호는 admin으로 입력하면 로그인이 된다.</p>
<p><code class="language-text">http://localhost:8069/web/database/manager</code> 에 접속하면 db를 새로 만들거나
수정할 수 있다</p>
<p>이제 odoo를 입맛대로 수정하기 위해서는 addons 폴더에 있는 내용을
addons_external 폴더로 이동 후에 수정하던지, 새로 만들어서 사용하면 된다</p>
<p>project 모듈로 한 번 테스트 해보자
바로 확인하기 위해 views 쪽을 수정해본다.</p>
<p><figure class="gatsby-resp-image-figure" style="margin: 0 0 50px auto;">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/dc8c46f280fd0651d9cfca8252958a1b/29114/before_update.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABm0lEQVR42q2Q2y8DQRTG97+VoHqlby5PLq9ufwDxQrGKxEOX1tLS0FYEkSC03UV3dqfbbmOJfs5MpfHgRWqSX+acOV+++WaU5aUlqKqK+blZDAUGEQqGiCCCQ0GEw2HEYjHE43GMDA8jGo12iEQQGAygr3+ANCHESCf0caqVnfUtrCcSUDeT2N7axYGmIb2v4UhPYz+V6nJMfSZ9gMNMhvYMslkduq4jnz9H4byIk1wOOTpTmGGh7tjgdh0NtwWxHu5rSKpn8P136tpotXxsJPIwKkz2Ai11g9NsAZ57hVbjGqXCBQUqQqmUq3AYmXKOtzdfGp7kbjExtgbP61zgOC7GR1dxefko+3b7A4sLGlaWN+FYh6gzHdtqEtOTSSjVpwoZMmnY9DySf+Isf4eZKRXMYnDrXM7LjwasVwucdJxeZJRNmFWTZi+SZ8NE5cmEwm3xXFsa+t8JS8V7LM7vgdXEdzhy3nR5txY06CIBtzu4IhBpuoYihUDUNiWTab5nf0H57VAk+ZmmZ8NeUHpJ86uhbVlgrzVw9j+GXxAnEPZY4zTpAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="before_update"
        title=""
        src="/static/dc8c46f280fd0651d9cfca8252958a1b/1cfc2/before_update.png"
        srcset="/static/dc8c46f280fd0651d9cfca8252958a1b/3684f/before_update.png 225w,
/static/dc8c46f280fd0651d9cfca8252958a1b/fc2a6/before_update.png 450w,
/static/dc8c46f280fd0651d9cfca8252958a1b/1cfc2/before_update.png 900w,
/static/dc8c46f280fd0651d9cfca8252958a1b/21482/before_update.png 1350w,
/static/dc8c46f280fd0651d9cfca8252958a1b/d61c2/before_update.png 1800w,
/static/dc8c46f280fd0651d9cfca8252958a1b/29114/before_update.png 1920w"
        sizes="(max-width: 900px) 100vw, 900px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">before_update</figcaption>
  </figure></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">> docker exec -it --user root odoo_erp_1 /bin/bash

$ apt-get update &amp;&amp; apt-get install -y vim # 문서 편집기 설치
$ mv project /addons_external
$ vi /etc/odoo/odoo.conf
  addons_path = /mnt,extra-addons,/usr/lib/python2.7/dist-packages/odoo/addons 뒤에 /addons_external 추가
  addons_path = /mnt,extra-addons,/usr/lib/python2.7/dist-packages/odoo/addons,/addons_external
$ exit

> vi /addons_external/project/views/project_views.xml
> docker restart odoo_erp_1</code></pre></div>
<p><figure class="gatsby-resp-image-figure" style="margin: 0 0 50px auto;">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b42e1e77a9ed1d715808bc95a7e8233d/29114/after_update.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 56.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpUlEQVR42q2SS2/TQBSF/W+RoGmeNDseKx7rlv4AIjZ9kBeVWMTBqSEpUZu0qgAhtajNw9B47IlTRzWIfMy4VcSiGxRG+qR75x6de0Yao1B4SbFUZG11leXEEqlkSpEkuZwknU6Ty+XI5/Os3F8hm80osmQzGRJLCe7cvac0KXJKp/V5VRs722W2NjcoF6u8qezwzjSx6ibvbYt6rTbng+otq85uo0HDatBs2ti2Tbt9QOegy16rRUvdGe7AZex5SG/MJJiiz7fTEZXSPlH0U3UzptOI11tthn0R9xqz9oWPzQ5h8Inp5DOHnSOq5S5G77yP5ypT6XN1FcWGe62vPH64SRheL/D9gEcPNjg+Pov72ewX6y9MXhWK+O4uY2FTLVV49qSCMVCGvhDKUHIZhkr+m/32Cc+flhCuIBjLeN47G+JeuEilk77HsOfgDBw1+xHzfejQP3cwZPxcLzaMbhIedk9ZX3uLGKnkvh/PLwM5rzUTtUgjvWsCHUhp5oY6hUbXnkoWp7mZ/QvGbZc6yd9pFjZcBGORNLca6i8jLkZI8X8M/wD1oBDsDoLR1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="after_update"
        title=""
        src="/static/b42e1e77a9ed1d715808bc95a7e8233d/1cfc2/after_update.png"
        srcset="/static/b42e1e77a9ed1d715808bc95a7e8233d/3684f/after_update.png 225w,
/static/b42e1e77a9ed1d715808bc95a7e8233d/fc2a6/after_update.png 450w,
/static/b42e1e77a9ed1d715808bc95a7e8233d/1cfc2/after_update.png 900w,
/static/b42e1e77a9ed1d715808bc95a7e8233d/21482/after_update.png 1350w,
/static/b42e1e77a9ed1d715808bc95a7e8233d/d61c2/after_update.png 1800w,
/static/b42e1e77a9ed1d715808bc95a7e8233d/29114/after_update.png 1920w"
        sizes="(max-width: 900px) 100vw, 900px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">after_update</figcaption>
  </figure></p>
<p>odoo 가 아니더라도 volumes를 이용해서 수정할 폴더를 따로 빼놓고 수정할 내용은
그곳에 넣는 방식으로 하면 수정된 내용을 바로 적용하기 좋았다</p>
<p>지운 후 재실행 했을 때 작업했던 것이 남아있는지 확인해보자</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">docker-compose down
docker-compose up</code></pre></div>
<p>이렇게 하면 위에서 docker exec 이후 수정했던 부분은 초기화 되므로 이 작업을
자동화 해주어야 한다.
그래서 docker-compose.yml 파일 하나로만 구성 하려던 계획대로 되지는 않았다
대신 확장성이 높아졌다.</p>
<h3 id="docker-compose-확장-및-개선" style="position:relative;"><a href="#docker-compose-%ED%99%95%EC%9E%A5-%EB%B0%8F-%EA%B0%9C%EC%84%A0" aria-label="docker compose 확장 및 개선 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>docker-compose 확장 및 개선</h3>
<p>Dockerfile 을 docker-compose.yml 이 있던 위치에 저장</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">FROM odoo:10.0
USER root
RUN apt-get update &amp;&amp; apt-get update -y vim
RUN sed -i "/addons_path/ s/$/,\/addons_external/" /etc/odoo/odoo.conf
RUN rm -rf /usr/lib/python2.7/dist-packages/odoo/addons/project</code></pre></div>
<p>다시 docker-compose.yml 수정</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">services:
  erp:
    image: odoo:10.0</code></pre></div>
<p>-></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">services:
  erp:
    build: ./</code></pre></div>
<p>다시 <code class="language-text">docker-compose up</code> 을 해서 확인 가능하다</p>
<p>다른 컴퓨터로 옮기기 위해서는 볼륨했던 것을 찾아서 옮겨주면 된다</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">docker volume ls
docker volume inspect &lt;odoo-erp-data></code></pre></div>
<p><figure class="gatsby-resp-image-figure" style="margin: 0 0 50px auto;">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 895px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a589eddfa448e7f69584d70127407202/fcbaf/docker_volume.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 55.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABqUlEQVR42pWS63KaUBSF+dOpt5o2NdaqLQEUBYEjIIoYKXhJ08SYTp+h7/8Kq/ts6kwZJ53kxzd7n9s66+x9lB/jFEFjiGnVoGjiwc7x6OQ42BkerAyP7hZHb8fzT94e9zR3mGxwcDY40trt8AZ+nc7XBoxydHaUmHDe6PAbY9zbG+RqjFsjoc0rrD/7vFFeJi+Wh2Uu44mTGAsuVBOrzgBZl+gNsdcmSLsulleC8BC33GJz9S+cGyWRkuCsbWLeGiLr+0zaE/jWC3BDztbdANmXCPPLyX9FSoLTygCLSxd3ZoqkPWURKTC7GCN6b7HDsDmCqLxUsFY0Y6vFXOSdnjBynKsLrNqCxzKKig5BTplnLlBOBU/aHr6ba+Rf57gbpcxWXyKTY3Kf9WeIPtgF5FxGee5M0H2rUScD/BQ7crLEnrq7UedFvI6Lxnx0GJkn5FSWQRoIm2N2WxIM6iNEFxP+KqsONaMTlp7j0TOfQ9TOn61ELRPhO43sqwjqGqLmNcJGUSfuLH0Vv/rPtylhnKHkQYz1KMSvyMLvrYGlbiHsWxCfbEw7r+cPQ1JAlDOCH74AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="docker volume ls"
        title=""
        src="/static/a589eddfa448e7f69584d70127407202/fcbaf/docker_volume.png"
        srcset="/static/a589eddfa448e7f69584d70127407202/3684f/docker_volume.png 225w,
/static/a589eddfa448e7f69584d70127407202/fc2a6/docker_volume.png 450w,
/static/a589eddfa448e7f69584d70127407202/fcbaf/docker_volume.png 895w"
        sizes="(max-width: 895px) 100vw, 895px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">docker volume ls</figcaption>
  </figure></p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">docker-compose stop
sudo cp -r /var/lib/docker/volumes/odoo_test_odoo-erp-data/_data/ ./erp-data
sudo cp -r /var/lib/docker/volumes/odoo_test_odoo-db-data/_data/ ./db-data</code></pre></div>
<p>기존 데이터를 가져오고</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">docker-compose up -d
docker-compose stop
sudo su
cp -r ./erp-data/_data/* /var/lib/docker/volumes/odoo_test_odoo-erp-data/_data
cp -r ./db-data/_data/* /var/lib/docker/volumes/odoo_test_odoo-db-data/_data
docker-compose start</code></pre></div>
<p>다시 가져온 데이터를 원래 위치로 보내준다.
DB에서 추가 설정 필요 없이 바로 데이터 적용이 된다</p>
<p>이렇게 하면 5개의 파일 및 폴더로 ERP 서버를 구동하게 된다</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># 폴더 트리
addons/ # 수정할 프로젝트 파일들
docker-compose.yml
Dockerfile
erp-data/ # web 내부 데이터들
db-data/ # db 내부 데이터들</code></pre></div>
<h3 id="간단한-모니터링을-위해-nagios를-이용했다" style="position:relative;"><a href="#%EA%B0%84%EB%8B%A8%ED%95%9C-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81%EC%9D%84-%EC%9C%84%ED%95%B4-nagios%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%96%88%EB%8B%A4" aria-label="간단한 모니터링을 위해 nagios를 이용했다 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>간단한 모니터링을 위해 nagios를 이용했다</h3>
<ul>
<li>Nagios - light weight, lots of modules, well documentation</li>
</ul>
<p>위 작성된 내용에 추가</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">services:
...
  nagios4:
    build:
    volumes:
      - "/var/run/docker.sock:/var/run/docker.sock" # docker process 모니터링
    ports:
      - "8080:80"</code></pre></div>
<h3 id="추가로-ssl-설정" style="position:relative;"><a href="#%EC%B6%94%EA%B0%80%EB%A1%9C-ssl-%EC%84%A4%EC%A0%95" aria-label="추가로 ssl 설정 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>추가로 SSL 설정</h3>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">services:
...
  nginx:
    build:
    volumes:
    ports:</code></pre></div>
<p>전체 소스는 <a href="https://github.com/shdkej/odoo_gvm">github</a>에서 볼 수 있다</p>
<h2 id="아쉬운-점" style="position:relative;"><a href="#%EC%95%84%EC%89%AC%EC%9A%B4-%EC%A0%90" aria-label="아쉬운 점 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>아쉬운 점</h2>
<ul>
<li>CI/CD</li>
<li>Test Code</li>
<li>HAproxy</li>
<li>ip setting automatic to vagrant</li>
<li>repository split</li>
<li>docker build to image</li>
<li>announcing update</li>
</ul></section><hr/></article><nav><div style="max-width:90%"></div><ul style="display:flex;flex-wrap:wrap;justify-content:space-between;list-style:none;padding:0"><li><a rel="prev" href="/blogging/">← <!-- -->Blogging</a></li><li><a rel="next" href="/data_structure/">Data Structure<!-- --> →</a></li></ul></nav><div></div></main><footer><small>© 2020, Built with<!-- --> <a href="https://www.gatsbyjs.org">Gatsby</a>, Inspired by<!-- --> <a href="https://johngrib.github.io/">john grib</a> and<!-- --> <a href="https://devroom.io">Ariejan de Vroom</a></small></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/deploy_erp_server_story/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-3e75b1a1624b064fdb92.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-995dc061fefb8a2b6378.js\"],\"component---src-pages-about-js\":[\"/component---src-pages-about-js-2b56c919f1406d5412e6.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-87b4768eaf25f0e5a3f3.js\"],\"component---src-pages-tags-js\":[\"/component---src-pages-tags-js-e341062119bd0ed513dc.js\"],\"component---src-pages-wiki-js\":[\"/component---src-pages-wiki-js-978ffc6b31ea14d00f78.js\"],\"component---src-templates-blog-post-js\":[\"/component---src-templates-blog-post-js-e89c9f34309aaedd1bc9.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="27b40e59959a2c823eb9";</script><script src="/webpack-runtime-a81a99791596fd69f3a2.js" async></script><script src="/framework-f70f545f8287a5fac375.js" async></script><script src="/app-3e75b1a1624b064fdb92.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>