{"componentChunkName":"component---src-templates-blog-post-js","path":"/deploy_erp_server_story/","result":{"data":{"site":{"siteMetadata":{"title":"SH"}},"markdownRemark":{"id":"06b83b92-41f2-5a01-9bd2-d092b3407416","excerpt":"목표 회사의 내부 전산 작업화를 위해 ERP 서버를 구축해\n데이터를 한 곳에 모으고, 추적하고, 관리하기 docker-compose.yml 파일 하나로 구성 odoo -- postgresql -- nginx -- nagios 형태가 된다 Step by Step Docker…","html":"<h2 id=\"목표\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%ED%91%9C\" aria-label=\"목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목표</h2>\n<p>회사의 내부 전산 작업화를 위해 ERP 서버를 구축해\n데이터를 한 곳에 모으고, 추적하고, 관리하기</p>\n<p>docker-compose.yml 파일 하나로 구성</p>\n<ul>\n<li>odoo -- postgresql -- nginx -- nagios 형태가 된다</li>\n</ul>\n<h2 id=\"step-by-step\" style=\"position:relative;\"><a href=\"#step-by-step\" aria-label=\"step by step permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Step by Step</h2>\n<h3 id=\"docker를-사용해서-어떤-환경에서도-쉽고-빠르게-서버를-관리\" style=\"position:relative;\"><a href=\"#docker%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%84%9C-%EC%96%B4%EB%96%A4-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%EB%8F%84-%EC%89%BD%EA%B3%A0-%EB%B9%A0%EB%A5%B4%EA%B2%8C-%EC%84%9C%EB%B2%84%EB%A5%BC-%EA%B4%80%EB%A6%AC\" aria-label=\"docker를 사용해서 어떤 환경에서도 쉽고 빠르게 서버를 관리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker를 사용해서 어떤 환경에서도 쉽고 빠르게 서버를 관리</h3>\n<p>docker 에 대해서는 <a href=\"https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html\">subicura님의 블로그</a>에 잘 정리되어 있어서 이것을 보면 바로\n사용가능할 것 같다.</p>\n<p>우분투 기준 설치 방법</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apt install -y docker.io\nusermod -aG docker $USER\n\ncurl -L https://github.com/docker/compose/releases/download/1.24.0/docker-compose-`uname -s`-`uname -m` -o /usr/bin/docker-compose\nchmod 755 /usr/bin/docker-compose\nchmod +x /usr/bin/docker-compose</code></pre></div>\n<p>오픈소스 ERP 프레임워크를 이용해서 필요한 것에만 집중하고 빠르게 개발\npython 기반의 odoo 이용\njavascript, c++, php 기반의 다른 프레임워크도 있었지만 파이썬을 써보고 싶고,\nMVC 구조에 모듈로 잘 구성되어 있고 지원해주는 기능이 많아서 odoo 사용</p>\n<p>docker 이미지도 제공되어 있어 바로 사용 가능</p>\n<p>DB는 mysql, mssql, postgresql을 두고 봤을 때 postgresql이 docker에서 볼륨상태를\n그대로 옮기기 좋다고 하여 사용.</p>\n<p><code class=\"language-text\">docker-compose.yml</code> 기본 뼈대</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">version: '3'\nservices:\n  erp:\n    image: odoo:10.0\n\n  db:\n    image: postgres:9.4</code></pre></div>\n<h3 id=\"docker-compose-로-여러-서비스-같이-관리한다\" style=\"position:relative;\"><a href=\"#docker-compose-%EB%A1%9C-%EC%97%AC%EB%9F%AC-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B0%99%EC%9D%B4-%EA%B4%80%EB%A6%AC%ED%95%9C%EB%8B%A4\" aria-label=\"docker compose 로 여러 서비스 같이 관리한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker compose 로 여러 서비스 같이 관리한다</h3>\n<p>포트, 아이디, 비밀번호 설정 등 추가적인 설정을 더해줬다</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">version: '3'\nservices:\n  erp:\n    image: odoo:10.0\n    depens_on:\n      - db # db 실행 후 erp 서버 실행하도록 설정\n    ports:\n      - \"8069:8069\"\n    environment:\n      - HOST=db\n      - USER=odoo\n      - PASSWORD=odoo\n    volumes:\n      - odoo-data:/var/lib/odoo\n      - ./addons:/addions_external\n    working_dir: /usr/lib/python2.7/dist-packages/odoo/addons\n\n  db:\n    image: postgres:9.4\n    ports:\n      - \"5432:5432\"\n    environment:\n      - POSTGRES_USER=odoo\n      - POSTGRES_PASSWORD=odoo\n    volumes:\n      - db-data:/var/lib/postgresql/data\n\nvolumes: # 세미콜론(:) 뒤에 공백으로 해두면 docker에서 임의의 위치에 폴더를 잡는다\n  odoo-data:\n  db-data:</code></pre></div>\n<p><code class=\"language-text\">docker-compose up</code> 을 해주면 odoo와 postgresql을 돌릴 수 있다.\n브라우저를 띄워서 <code class=\"language-text\">localhost:8069</code> 입력하고 조금 기다리면 화면이 뜬다</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin: 0 0 50px auto;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/471204de652bf3688e9110aba927f5f9/29114/erp_first_page.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAr0lEQVR42u2PTQ7CIBCFuf9JtBQXgDepC09gUrvQ2ojl7zmgbU010YULF77kS5jh8ZhhTb2HdRabqsJKCKy1hlbqhiakgig43ZVjX0oJQd5FKSASywKcc6iSg8UYMfCoVOZOiGibE45d9+R5JTYFRIQQMulsLj3a7ozeeTiqPQVfrIMhnPejdw6b/zDMULcG290hd0xvc5inB5PjzYRzpYmcj9P6dz5e+Vv6B/5g4BUg0lpWSZZvHAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"erp_first_page\"\n        title=\"\"\n        src=\"/static/471204de652bf3688e9110aba927f5f9/1cfc2/erp_first_page.png\"\n        srcset=\"/static/471204de652bf3688e9110aba927f5f9/3684f/erp_first_page.png 225w,\n/static/471204de652bf3688e9110aba927f5f9/fc2a6/erp_first_page.png 450w,\n/static/471204de652bf3688e9110aba927f5f9/1cfc2/erp_first_page.png 900w,\n/static/471204de652bf3688e9110aba927f5f9/21482/erp_first_page.png 1350w,\n/static/471204de652bf3688e9110aba927f5f9/d61c2/erp_first_page.png 1800w,\n/static/471204de652bf3688e9110aba927f5f9/29114/erp_first_page.png 1920w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">erp_first_page</figcaption>\n  </figure></p>\n<p>여기까지만 해도 프로그램 자체는 띄울 수 있다\n그런데 각 상황에 맞게 수정을 해줘야 하는데,\n각 프로그램의 관리 파일을 찾아서 볼륨을 시켜주는 작업을 해야 한다.</p>\n<h3 id=\"수정하고-지웠다가-다시-실행해보기\" style=\"position:relative;\"><a href=\"#%EC%88%98%EC%A0%95%ED%95%98%EA%B3%A0-%EC%A7%80%EC%9B%A0%EB%8B%A4%EA%B0%80-%EB%8B%A4%EC%8B%9C-%EC%8B%A4%ED%96%89%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"수정하고 지웠다가 다시 실행해보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>수정하고 지웠다가 다시 실행해보기</h3>\n<p>처음 아이디와 비밀번호는 admin으로 입력하면 로그인이 된다.</p>\n<p><code class=\"language-text\">http://localhost:8069/web/database/manager</code> 에 접속하면 db를 새로 만들거나\n수정할 수 있다</p>\n<p>이제 odoo를 입맛대로 수정하기 위해서는 addons 폴더에 있는 내용을\naddons_external 폴더로 이동 후에 수정하던지, 새로 만들어서 사용하면 된다</p>\n<p>project 모듈로 한 번 테스트 해보자\n바로 확인하기 위해 views 쪽을 수정해본다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin: 0 0 50px auto;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dc8c46f280fd0651d9cfca8252958a1b/29114/before_update.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABm0lEQVR42q2Q2y8DQRTG97+VoHqlby5PLq9ufwDxQrGKxEOX1tLS0FYEkSC03UV3dqfbbmOJfs5MpfHgRWqSX+acOV+++WaU5aUlqKqK+blZDAUGEQqGiCCCQ0GEw2HEYjHE43GMDA8jGo12iEQQGAygr3+ANCHESCf0caqVnfUtrCcSUDeT2N7axYGmIb2v4UhPYz+V6nJMfSZ9gMNMhvYMslkduq4jnz9H4byIk1wOOTpTmGGh7tjgdh0NtwWxHu5rSKpn8P136tpotXxsJPIwKkz2Ai11g9NsAZ57hVbjGqXCBQUqQqmUq3AYmXKOtzdfGp7kbjExtgbP61zgOC7GR1dxefko+3b7A4sLGlaWN+FYh6gzHdtqEtOTSSjVpwoZMmnY9DySf+Isf4eZKRXMYnDrXM7LjwasVwucdJxeZJRNmFWTZi+SZ8NE5cmEwm3xXFsa+t8JS8V7LM7vgdXEdzhy3nR5txY06CIBtzu4IhBpuoYihUDUNiWTab5nf0H57VAk+ZmmZ8NeUHpJ86uhbVlgrzVw9j+GXxAnEPZY4zTpAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"before_update\"\n        title=\"\"\n        src=\"/static/dc8c46f280fd0651d9cfca8252958a1b/1cfc2/before_update.png\"\n        srcset=\"/static/dc8c46f280fd0651d9cfca8252958a1b/3684f/before_update.png 225w,\n/static/dc8c46f280fd0651d9cfca8252958a1b/fc2a6/before_update.png 450w,\n/static/dc8c46f280fd0651d9cfca8252958a1b/1cfc2/before_update.png 900w,\n/static/dc8c46f280fd0651d9cfca8252958a1b/21482/before_update.png 1350w,\n/static/dc8c46f280fd0651d9cfca8252958a1b/d61c2/before_update.png 1800w,\n/static/dc8c46f280fd0651d9cfca8252958a1b/29114/before_update.png 1920w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">before_update</figcaption>\n  </figure></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">> docker exec -it --user root odoo_erp_1 /bin/bash\n\n$ apt-get update &amp;&amp; apt-get install -y vim # 문서 편집기 설치\n$ mv project /addons_external\n$ vi /etc/odoo/odoo.conf\n  addons_path = /mnt,extra-addons,/usr/lib/python2.7/dist-packages/odoo/addons 뒤에 /addons_external 추가\n  addons_path = /mnt,extra-addons,/usr/lib/python2.7/dist-packages/odoo/addons,/addons_external\n$ exit\n\n> vi /addons_external/project/views/project_views.xml\n> docker restart odoo_erp_1</code></pre></div>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin: 0 0 50px auto;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b42e1e77a9ed1d715808bc95a7e8233d/29114/after_update.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpUlEQVR42q2SS2/TQBSF/W+RoGmeNDseKx7rlv4AIjZ9kBeVWMTBqSEpUZu0qgAhtajNw9B47IlTRzWIfMy4VcSiGxRG+qR75x6de0Yao1B4SbFUZG11leXEEqlkSpEkuZwknU6Ty+XI5/Os3F8hm80osmQzGRJLCe7cvac0KXJKp/V5VRs722W2NjcoF6u8qezwzjSx6ibvbYt6rTbng+otq85uo0HDatBs2ti2Tbt9QOegy16rRUvdGe7AZex5SG/MJJiiz7fTEZXSPlH0U3UzptOI11tthn0R9xqz9oWPzQ5h8Inp5DOHnSOq5S5G77yP5ypT6XN1FcWGe62vPH64SRheL/D9gEcPNjg+Pov72ewX6y9MXhWK+O4uY2FTLVV49qSCMVCGvhDKUHIZhkr+m/32Cc+flhCuIBjLeN47G+JeuEilk77HsOfgDBw1+xHzfejQP3cwZPxcLzaMbhIedk9ZX3uLGKnkvh/PLwM5rzUTtUgjvWsCHUhp5oY6hUbXnkoWp7mZ/QvGbZc6yd9pFjZcBGORNLca6i8jLkZI8X8M/wD1oBDsDoLR1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"after_update\"\n        title=\"\"\n        src=\"/static/b42e1e77a9ed1d715808bc95a7e8233d/1cfc2/after_update.png\"\n        srcset=\"/static/b42e1e77a9ed1d715808bc95a7e8233d/3684f/after_update.png 225w,\n/static/b42e1e77a9ed1d715808bc95a7e8233d/fc2a6/after_update.png 450w,\n/static/b42e1e77a9ed1d715808bc95a7e8233d/1cfc2/after_update.png 900w,\n/static/b42e1e77a9ed1d715808bc95a7e8233d/21482/after_update.png 1350w,\n/static/b42e1e77a9ed1d715808bc95a7e8233d/d61c2/after_update.png 1800w,\n/static/b42e1e77a9ed1d715808bc95a7e8233d/29114/after_update.png 1920w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">after_update</figcaption>\n  </figure></p>\n<p>odoo 가 아니더라도 volumes를 이용해서 수정할 폴더를 따로 빼놓고 수정할 내용은\n그곳에 넣는 방식으로 하면 수정된 내용을 바로 적용하기 좋았다</p>\n<p>지운 후 재실행 했을 때 작업했던 것이 남아있는지 확인해보자</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker-compose down\ndocker-compose up</code></pre></div>\n<p>이렇게 하면 위에서 docker exec 이후 수정했던 부분은 초기화 되므로 이 작업을\n자동화 해주어야 한다.\n그래서 docker-compose.yml 파일 하나로만 구성 하려던 계획대로 되지는 않았다\n대신 확장성이 높아졌다.</p>\n<h3 id=\"docker-compose-확장-및-개선\" style=\"position:relative;\"><a href=\"#docker-compose-%ED%99%95%EC%9E%A5-%EB%B0%8F-%EA%B0%9C%EC%84%A0\" aria-label=\"docker compose 확장 및 개선 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker-compose 확장 및 개선</h3>\n<p>Dockerfile 을 docker-compose.yml 이 있던 위치에 저장</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">FROM odoo:10.0\nUSER root\nRUN apt-get update &amp;&amp; apt-get update -y vim\nRUN sed -i \"/addons_path/ s/$/,\\/addons_external/\" /etc/odoo/odoo.conf\nRUN rm -rf /usr/lib/python2.7/dist-packages/odoo/addons/project</code></pre></div>\n<p>다시 docker-compose.yml 수정</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">services:\n  erp:\n    image: odoo:10.0</code></pre></div>\n<p>-></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">services:\n  erp:\n    build: ./</code></pre></div>\n<p>다시 <code class=\"language-text\">docker-compose up</code> 을 해서 확인 가능하다</p>\n<p>다른 컴퓨터로 옮기기 위해서는 볼륨했던 것을 찾아서 옮겨주면 된다</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker volume ls\ndocker volume inspect &lt;odoo-erp-data></code></pre></div>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin: 0 0 50px auto;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 895px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a589eddfa448e7f69584d70127407202/fcbaf/docker_volume.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABqUlEQVR42pWS63KaUBSF+dOpt5o2NdaqLQEUBYEjIIoYKXhJ08SYTp+h7/8Kq/ts6kwZJ53kxzd7n9s66+x9lB/jFEFjiGnVoGjiwc7x6OQ42BkerAyP7hZHb8fzT94e9zR3mGxwcDY40trt8AZ+nc7XBoxydHaUmHDe6PAbY9zbG+RqjFsjoc0rrD/7vFFeJi+Wh2Uu44mTGAsuVBOrzgBZl+gNsdcmSLsulleC8BC33GJz9S+cGyWRkuCsbWLeGiLr+0zaE/jWC3BDztbdANmXCPPLyX9FSoLTygCLSxd3ZoqkPWURKTC7GCN6b7HDsDmCqLxUsFY0Y6vFXOSdnjBynKsLrNqCxzKKig5BTplnLlBOBU/aHr6ba+Rf57gbpcxWXyKTY3Kf9WeIPtgF5FxGee5M0H2rUScD/BQ7crLEnrq7UedFvI6Lxnx0GJkn5FSWQRoIm2N2WxIM6iNEFxP+KqsONaMTlp7j0TOfQ9TOn61ELRPhO43sqwjqGqLmNcJGUSfuLH0Vv/rPtylhnKHkQYz1KMSvyMLvrYGlbiHsWxCfbEw7r+cPQ1JAlDOCH74AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"docker volume ls\"\n        title=\"\"\n        src=\"/static/a589eddfa448e7f69584d70127407202/fcbaf/docker_volume.png\"\n        srcset=\"/static/a589eddfa448e7f69584d70127407202/3684f/docker_volume.png 225w,\n/static/a589eddfa448e7f69584d70127407202/fc2a6/docker_volume.png 450w,\n/static/a589eddfa448e7f69584d70127407202/fcbaf/docker_volume.png 895w\"\n        sizes=\"(max-width: 895px) 100vw, 895px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">docker volume ls</figcaption>\n  </figure></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker-compose stop\nsudo cp -r /var/lib/docker/volumes/odoo_test_odoo-erp-data/_data/ ./erp-data\nsudo cp -r /var/lib/docker/volumes/odoo_test_odoo-db-data/_data/ ./db-data</code></pre></div>\n<p>기존 데이터를 가져오고</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker-compose up -d\ndocker-compose stop\nsudo su\ncp -r ./erp-data/_data/* /var/lib/docker/volumes/odoo_test_odoo-erp-data/_data\ncp -r ./db-data/_data/* /var/lib/docker/volumes/odoo_test_odoo-db-data/_data\ndocker-compose start</code></pre></div>\n<p>다시 가져온 데이터를 원래 위치로 보내준다.\nDB에서 추가 설정 필요 없이 바로 데이터 적용이 된다</p>\n<p>이렇게 하면 5개의 파일 및 폴더로 ERP 서버를 구동하게 된다</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 폴더 트리\naddons/ # 수정할 프로젝트 파일들\ndocker-compose.yml\nDockerfile\nerp-data/ # web 내부 데이터들\ndb-data/ # db 내부 데이터들</code></pre></div>\n<h3 id=\"간단한-모니터링을-위해-nagios를-이용했다\" style=\"position:relative;\"><a href=\"#%EA%B0%84%EB%8B%A8%ED%95%9C-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81%EC%9D%84-%EC%9C%84%ED%95%B4-nagios%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%96%88%EB%8B%A4\" aria-label=\"간단한 모니터링을 위해 nagios를 이용했다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>간단한 모니터링을 위해 nagios를 이용했다</h3>\n<ul>\n<li>Nagios - light weight, lots of modules, well documentation</li>\n</ul>\n<p>위 작성된 내용에 추가</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">services:\n...\n  nagios4:\n    build:\n    volumes:\n      - \"/var/run/docker.sock:/var/run/docker.sock\" # docker process 모니터링\n    ports:\n      - \"8080:80\"</code></pre></div>\n<h3 id=\"추가로-ssl-설정\" style=\"position:relative;\"><a href=\"#%EC%B6%94%EA%B0%80%EB%A1%9C-ssl-%EC%84%A4%EC%A0%95\" aria-label=\"추가로 ssl 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>추가로 SSL 설정</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">services:\n...\n  nginx:\n    build:\n    volumes:\n    ports:</code></pre></div>\n<p>전체 소스는 <a href=\"https://github.com/shdkej/odoo_gvm\">github</a>에서 볼 수 있다</p>\n<h2 id=\"아쉬운-점\" style=\"position:relative;\"><a href=\"#%EC%95%84%EC%89%AC%EC%9A%B4-%EC%A0%90\" aria-label=\"아쉬운 점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>아쉬운 점</h2>\n<ul>\n<li>CI/CD</li>\n<li>Test Code</li>\n<li>HAproxy</li>\n<li>ip setting automatic to vagrant</li>\n<li>repository split</li>\n<li>docker build to image</li>\n<li>announcing update</li>\n</ul>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h2","properties":{"id":"목표","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EB%AA%A9%ED%91%9C","ariaLabel":"목표 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"목표"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"회사의 내부 전산 작업화를 위해 ERP 서버를 구축해\n데이터를 한 곳에 모으고, 추적하고, 관리하기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"docker-compose.yml 파일 하나로 구성"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"odoo -- postgresql -- nginx -- nagios 형태가 된다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"step-by-step","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#step-by-step","ariaLabel":"step by step permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Step by Step"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"docker를-사용해서-어떤-환경에서도-쉽고-빠르게-서버를-관리","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%84%9C-%EC%96%B4%EB%96%A4-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%EB%8F%84-%EC%89%BD%EA%B3%A0-%EB%B9%A0%EB%A5%B4%EA%B2%8C-%EC%84%9C%EB%B2%84%EB%A5%BC-%EA%B4%80%EB%A6%AC","ariaLabel":"docker를 사용해서 어떤 환경에서도 쉽고 빠르게 서버를 관리 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Docker를 사용해서 어떤 환경에서도 쉽고 빠르게 서버를 관리"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"docker 에 대해서는 "},{"type":"element","tagName":"a","properties":{"href":"https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html"},"children":[{"type":"text","value":"subicura님의 블로그"}]},{"type":"text","value":"에 잘 정리되어 있어서 이것을 보면 바로\n사용가능할 것 같다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"우분투 기준 설치 방법"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"apt install -y docker.io\nusermod -aG docker $USER\n\ncurl -L https://github.com/docker/compose/releases/download/1.24.0/docker-compose-`uname -s`-`uname -m` -o /usr/bin/docker-compose\nchmod 755 /usr/bin/docker-compose\nchmod +x /usr/bin/docker-compose"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"오픈소스 ERP 프레임워크를 이용해서 필요한 것에만 집중하고 빠르게 개발\npython 기반의 odoo 이용\njavascript, c++, php 기반의 다른 프레임워크도 있었지만 파이썬을 써보고 싶고,\nMVC 구조에 모듈로 잘 구성되어 있고 지원해주는 기능이 많아서 odoo 사용"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"docker 이미지도 제공되어 있어 바로 사용 가능"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"DB는 mysql, mssql, postgresql을 두고 봤을 때 postgresql이 docker에서 볼륨상태를\n그대로 옮기기 좋다고 하여 사용."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose.yml"}]},{"type":"text","value":" 기본 뼈대"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"version: '3'\nservices:\n  erp:\n    image: odoo:10.0\n\n  db:\n    image: postgres:9.4"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"docker-compose-로-여러-서비스-같이-관리한다","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-compose-%EB%A1%9C-%EC%97%AC%EB%9F%AC-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B0%99%EC%9D%B4-%EA%B4%80%EB%A6%AC%ED%95%9C%EB%8B%A4","ariaLabel":"docker compose 로 여러 서비스 같이 관리한다 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"docker compose 로 여러 서비스 같이 관리한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"포트, 아이디, 비밀번호 설정 등 추가적인 설정을 더해줬다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"version: '3'\nservices:\n  erp:\n    image: odoo:10.0\n    depens_on:\n      - db # db 실행 후 erp 서버 실행하도록 설정\n    ports:\n      - \"8069:8069\"\n    environment:\n      - HOST=db\n      - USER=odoo\n      - PASSWORD=odoo\n    volumes:\n      - odoo-data:/var/lib/odoo\n      - ./addons:/addions_external\n    working_dir: /usr/lib/python2.7/dist-packages/odoo/addons\n\n  db:\n    image: postgres:9.4\n    ports:\n      - \"5432:5432\"\n    environment:\n      - POSTGRES_USER=odoo\n      - POSTGRES_PASSWORD=odoo\n    volumes:\n      - db-data:/var/lib/postgresql/data\n\nvolumes: # 세미콜론(:) 뒤에 공백으로 해두면 docker에서 임의의 위치에 폴더를 잡는다\n  odoo-data:\n  db-data:"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose up"}]},{"type":"text","value":" 을 해주면 odoo와 postgresql을 돌릴 수 있다.\n브라우저를 띄워서 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"localhost:8069"}]},{"type":"text","value":" 입력하고 조금 기다리면 화면이 뜬다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[]},{"type":"element","tagName":"figure","properties":{"className":["gatsby-resp-image-figure"],"style":"margin: 0 0 50px auto;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/471204de652bf3688e9110aba927f5f9/29114/erp_first_page.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 54.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAr0lEQVR42u2PTQ7CIBCFuf9JtBQXgDepC09gUrvQ2ojl7zmgbU010YULF77kS5jh8ZhhTb2HdRabqsJKCKy1hlbqhiakgig43ZVjX0oJQd5FKSASywKcc6iSg8UYMfCoVOZOiGibE45d9+R5JTYFRIQQMulsLj3a7ozeeTiqPQVfrIMhnPejdw6b/zDMULcG290hd0xvc5inB5PjzYRzpYmcj9P6dz5e+Vv6B/5g4BUg0lpWSZZvHAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"erp_first_page","title":"","src":"/static/471204de652bf3688e9110aba927f5f9/1cfc2/erp_first_page.png","srcSet":["/static/471204de652bf3688e9110aba927f5f9/3684f/erp_first_page.png 225w","/static/471204de652bf3688e9110aba927f5f9/fc2a6/erp_first_page.png 450w","/static/471204de652bf3688e9110aba927f5f9/1cfc2/erp_first_page.png 900w","/static/471204de652bf3688e9110aba927f5f9/21482/erp_first_page.png 1350w","/static/471204de652bf3688e9110aba927f5f9/d61c2/erp_first_page.png 1800w","/static/471204de652bf3688e9110aba927f5f9/29114/erp_first_page.png 1920w"],"sizes":"(max-width: 900px) 100vw, 900px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"figcaption","properties":{"className":["gatsby-resp-image-figcaption"]},"children":[{"type":"text","value":"erp_first_page"}]},{"type":"text","value":"\n  "}]},{"type":"element","tagName":"p","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"여기까지만 해도 프로그램 자체는 띄울 수 있다\n그런데 각 상황에 맞게 수정을 해줘야 하는데,\n각 프로그램의 관리 파일을 찾아서 볼륨을 시켜주는 작업을 해야 한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"수정하고-지웠다가-다시-실행해보기","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%88%98%EC%A0%95%ED%95%98%EA%B3%A0-%EC%A7%80%EC%9B%A0%EB%8B%A4%EA%B0%80-%EB%8B%A4%EC%8B%9C-%EC%8B%A4%ED%96%89%ED%95%B4%EB%B3%B4%EA%B8%B0","ariaLabel":"수정하고 지웠다가 다시 실행해보기 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"수정하고 지웠다가 다시 실행해보기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"처음 아이디와 비밀번호는 admin으로 입력하면 로그인이 된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"http://localhost:8069/web/database/manager"}]},{"type":"text","value":" 에 접속하면 db를 새로 만들거나\n수정할 수 있다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이제 odoo를 입맛대로 수정하기 위해서는 addons 폴더에 있는 내용을\naddons_external 폴더로 이동 후에 수정하던지, 새로 만들어서 사용하면 된다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"project 모듈로 한 번 테스트 해보자\n바로 확인하기 위해 views 쪽을 수정해본다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[]},{"type":"element","tagName":"figure","properties":{"className":["gatsby-resp-image-figure"],"style":"margin: 0 0 50px auto;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/dc8c46f280fd0651d9cfca8252958a1b/29114/before_update.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 56.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABm0lEQVR42q2Q2y8DQRTG97+VoHqlby5PLq9ufwDxQrGKxEOX1tLS0FYEkSC03UV3dqfbbmOJfs5MpfHgRWqSX+acOV+++WaU5aUlqKqK+blZDAUGEQqGiCCCQ0GEw2HEYjHE43GMDA8jGo12iEQQGAygr3+ANCHESCf0caqVnfUtrCcSUDeT2N7axYGmIb2v4UhPYz+V6nJMfSZ9gMNMhvYMslkduq4jnz9H4byIk1wOOTpTmGGh7tjgdh0NtwWxHu5rSKpn8P136tpotXxsJPIwKkz2Ai11g9NsAZ57hVbjGqXCBQUqQqmUq3AYmXKOtzdfGp7kbjExtgbP61zgOC7GR1dxefko+3b7A4sLGlaWN+FYh6gzHdtqEtOTSSjVpwoZMmnY9DySf+Isf4eZKRXMYnDrXM7LjwasVwucdJxeZJRNmFWTZi+SZ8NE5cmEwm3xXFsa+t8JS8V7LM7vgdXEdzhy3nR5txY06CIBtzu4IhBpuoYihUDUNiWTab5nf0H57VAk+ZmmZ8NeUHpJ86uhbVlgrzVw9j+GXxAnEPZY4zTpAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"before_update","title":"","src":"/static/dc8c46f280fd0651d9cfca8252958a1b/1cfc2/before_update.png","srcSet":["/static/dc8c46f280fd0651d9cfca8252958a1b/3684f/before_update.png 225w","/static/dc8c46f280fd0651d9cfca8252958a1b/fc2a6/before_update.png 450w","/static/dc8c46f280fd0651d9cfca8252958a1b/1cfc2/before_update.png 900w","/static/dc8c46f280fd0651d9cfca8252958a1b/21482/before_update.png 1350w","/static/dc8c46f280fd0651d9cfca8252958a1b/d61c2/before_update.png 1800w","/static/dc8c46f280fd0651d9cfca8252958a1b/29114/before_update.png 1920w"],"sizes":"(max-width: 900px) 100vw, 900px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"figcaption","properties":{"className":["gatsby-resp-image-figcaption"]},"children":[{"type":"text","value":"before_update"}]},{"type":"text","value":"\n  "}]},{"type":"element","tagName":"p","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"> docker exec -it --user root odoo_erp_1 /bin/bash\n\n$ apt-get update && apt-get install -y vim # 문서 편집기 설치\n$ mv project /addons_external\n$ vi /etc/odoo/odoo.conf\n  addons_path = /mnt,extra-addons,/usr/lib/python2.7/dist-packages/odoo/addons 뒤에 /addons_external 추가\n  addons_path = /mnt,extra-addons,/usr/lib/python2.7/dist-packages/odoo/addons,/addons_external\n$ exit\n\n> vi /addons_external/project/views/project_views.xml\n> docker restart odoo_erp_1"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[]},{"type":"element","tagName":"figure","properties":{"className":["gatsby-resp-image-figure"],"style":"margin: 0 0 50px auto;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/b42e1e77a9ed1d715808bc95a7e8233d/29114/after_update.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 56.44444444444444%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpUlEQVR42q2SS2/TQBSF/W+RoGmeNDseKx7rlv4AIjZ9kBeVWMTBqSEpUZu0qgAhtajNw9B47IlTRzWIfMy4VcSiGxRG+qR75x6de0Yao1B4SbFUZG11leXEEqlkSpEkuZwknU6Ty+XI5/Os3F8hm80osmQzGRJLCe7cvac0KXJKp/V5VRs722W2NjcoF6u8qezwzjSx6ibvbYt6rTbng+otq85uo0HDatBs2ti2Tbt9QOegy16rRUvdGe7AZex5SG/MJJiiz7fTEZXSPlH0U3UzptOI11tthn0R9xqz9oWPzQ5h8Inp5DOHnSOq5S5G77yP5ypT6XN1FcWGe62vPH64SRheL/D9gEcPNjg+Pov72ewX6y9MXhWK+O4uY2FTLVV49qSCMVCGvhDKUHIZhkr+m/32Cc+flhCuIBjLeN47G+JeuEilk77HsOfgDBw1+xHzfejQP3cwZPxcLzaMbhIedk9ZX3uLGKnkvh/PLwM5rzUTtUgjvWsCHUhp5oY6hUbXnkoWp7mZ/QvGbZc6yd9pFjZcBGORNLca6i8jLkZI8X8M/wD1oBDsDoLR1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"after_update","title":"","src":"/static/b42e1e77a9ed1d715808bc95a7e8233d/1cfc2/after_update.png","srcSet":["/static/b42e1e77a9ed1d715808bc95a7e8233d/3684f/after_update.png 225w","/static/b42e1e77a9ed1d715808bc95a7e8233d/fc2a6/after_update.png 450w","/static/b42e1e77a9ed1d715808bc95a7e8233d/1cfc2/after_update.png 900w","/static/b42e1e77a9ed1d715808bc95a7e8233d/21482/after_update.png 1350w","/static/b42e1e77a9ed1d715808bc95a7e8233d/d61c2/after_update.png 1800w","/static/b42e1e77a9ed1d715808bc95a7e8233d/29114/after_update.png 1920w"],"sizes":"(max-width: 900px) 100vw, 900px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"figcaption","properties":{"className":["gatsby-resp-image-figcaption"]},"children":[{"type":"text","value":"after_update"}]},{"type":"text","value":"\n  "}]},{"type":"element","tagName":"p","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"odoo 가 아니더라도 volumes를 이용해서 수정할 폴더를 따로 빼놓고 수정할 내용은\n그곳에 넣는 방식으로 하면 수정된 내용을 바로 적용하기 좋았다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"지운 후 재실행 했을 때 작업했던 것이 남아있는지 확인해보자"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose down\ndocker-compose up"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이렇게 하면 위에서 docker exec 이후 수정했던 부분은 초기화 되므로 이 작업을\n자동화 해주어야 한다.\n그래서 docker-compose.yml 파일 하나로만 구성 하려던 계획대로 되지는 않았다\n대신 확장성이 높아졌다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"docker-compose-확장-및-개선","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-compose-%ED%99%95%EC%9E%A5-%EB%B0%8F-%EA%B0%9C%EC%84%A0","ariaLabel":"docker compose 확장 및 개선 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"docker-compose 확장 및 개선"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Dockerfile 을 docker-compose.yml 이 있던 위치에 저장"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"FROM odoo:10.0\nUSER root\nRUN apt-get update && apt-get update -y vim\nRUN sed -i \"/addons_path/ s/$/,\\/addons_external/\" /etc/odoo/odoo.conf\nRUN rm -rf /usr/lib/python2.7/dist-packages/odoo/addons/project"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다시 docker-compose.yml 수정"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"services:\n  erp:\n    image: odoo:10.0"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"->"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"services:\n  erp:\n    build: ./"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다시 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose up"}]},{"type":"text","value":" 을 해서 확인 가능하다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다른 컴퓨터로 옮기기 위해서는 볼륨했던 것을 찾아서 옮겨주면 된다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker volume ls\ndocker volume inspect <odoo-erp-data>"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[]},{"type":"element","tagName":"figure","properties":{"className":["gatsby-resp-image-figure"],"style":"margin: 0 0 50px auto;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 895px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/a589eddfa448e7f69584d70127407202/fcbaf/docker_volume.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 55.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABqUlEQVR42pWS63KaUBSF+dOpt5o2NdaqLQEUBYEjIIoYKXhJ08SYTp+h7/8Kq/ts6kwZJ53kxzd7n9s66+x9lB/jFEFjiGnVoGjiwc7x6OQ42BkerAyP7hZHb8fzT94e9zR3mGxwcDY40trt8AZ+nc7XBoxydHaUmHDe6PAbY9zbG+RqjFsjoc0rrD/7vFFeJi+Wh2Uu44mTGAsuVBOrzgBZl+gNsdcmSLsulleC8BC33GJz9S+cGyWRkuCsbWLeGiLr+0zaE/jWC3BDztbdANmXCPPLyX9FSoLTygCLSxd3ZoqkPWURKTC7GCN6b7HDsDmCqLxUsFY0Y6vFXOSdnjBynKsLrNqCxzKKig5BTplnLlBOBU/aHr6ba+Rf57gbpcxWXyKTY3Kf9WeIPtgF5FxGee5M0H2rUScD/BQ7crLEnrq7UedFvI6Lxnx0GJkn5FSWQRoIm2N2WxIM6iNEFxP+KqsONaMTlp7j0TOfQ9TOn61ELRPhO43sqwjqGqLmNcJGUSfuLH0Vv/rPtylhnKHkQYz1KMSvyMLvrYGlbiHsWxCfbEw7r+cPQ1JAlDOCH74AAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"docker volume ls","title":"","src":"/static/a589eddfa448e7f69584d70127407202/fcbaf/docker_volume.png","srcSet":["/static/a589eddfa448e7f69584d70127407202/3684f/docker_volume.png 225w","/static/a589eddfa448e7f69584d70127407202/fc2a6/docker_volume.png 450w","/static/a589eddfa448e7f69584d70127407202/fcbaf/docker_volume.png 895w"],"sizes":"(max-width: 895px) 100vw, 895px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"figcaption","properties":{"className":["gatsby-resp-image-figcaption"]},"children":[{"type":"text","value":"docker volume ls"}]},{"type":"text","value":"\n  "}]},{"type":"element","tagName":"p","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose stop\nsudo cp -r /var/lib/docker/volumes/odoo_test_odoo-erp-data/_data/ ./erp-data\nsudo cp -r /var/lib/docker/volumes/odoo_test_odoo-db-data/_data/ ./db-data"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"기존 데이터를 가져오고"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose up -d\ndocker-compose stop\nsudo su\ncp -r ./erp-data/_data/* /var/lib/docker/volumes/odoo_test_odoo-erp-data/_data\ncp -r ./db-data/_data/* /var/lib/docker/volumes/odoo_test_odoo-db-data/_data\ndocker-compose start"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다시 가져온 데이터를 원래 위치로 보내준다.\nDB에서 추가 설정 필요 없이 바로 데이터 적용이 된다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이렇게 하면 5개의 파일 및 폴더로 ERP 서버를 구동하게 된다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"# 폴더 트리\naddons/ # 수정할 프로젝트 파일들\ndocker-compose.yml\nDockerfile\nerp-data/ # web 내부 데이터들\ndb-data/ # db 내부 데이터들"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"간단한-모니터링을-위해-nagios를-이용했다","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EA%B0%84%EB%8B%A8%ED%95%9C-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81%EC%9D%84-%EC%9C%84%ED%95%B4-nagios%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%96%88%EB%8B%A4","ariaLabel":"간단한 모니터링을 위해 nagios를 이용했다 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"간단한 모니터링을 위해 nagios를 이용했다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Nagios - light weight, lots of modules, well documentation"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위 작성된 내용에 추가"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"services:\n...\n  nagios4:\n    build:\n    volumes:\n      - \"/var/run/docker.sock:/var/run/docker.sock\" # docker process 모니터링\n    ports:\n      - \"8080:80\""}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"추가로-ssl-설정","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%B6%94%EA%B0%80%EB%A1%9C-ssl-%EC%84%A4%EC%A0%95","ariaLabel":"추가로 ssl 설정 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"추가로 SSL 설정"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"services:\n...\n  nginx:\n    build:\n    volumes:\n    ports:"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"전체 소스는 "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/shdkej/odoo_gvm"},"children":[{"type":"text","value":"github"}]},{"type":"text","value":"에서 볼 수 있다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"아쉬운-점","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%95%84%EC%89%AC%EC%9A%B4-%EC%A0%90","ariaLabel":"아쉬운 점 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"아쉬운 점"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"CI/CD"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Test Code"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"HAproxy"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ip setting automatic to vagrant"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"repository split"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"docker build to image"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"announcing update"}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"rawMarkdownBody":"\n## 목표\n\n회사의 내부 전산 작업화를 위해 ERP 서버를 구축해\n데이터를 한 곳에 모으고, 추적하고, 관리하기\n\ndocker-compose.yml 파일 하나로 구성\n\n- odoo -- postgresql -- nginx -- nagios 형태가 된다\n\n## Step by Step\n\n### Docker를 사용해서 어떤 환경에서도 쉽고 빠르게 서버를 관리\n\ndocker 에 대해서는 [subicura님의 블로그](https://subicura.com/2017/01/19/docker-guide-for-beginners-1.html)에 잘 정리되어 있어서 이것을 보면 바로\n사용가능할 것 같다.\n\n우분투 기준 설치 방법\n\n```\napt install -y docker.io\nusermod -aG docker $USER\n\ncurl -L https://github.com/docker/compose/releases/download/1.24.0/docker-compose-`uname -s`-`uname -m` -o /usr/bin/docker-compose\nchmod 755 /usr/bin/docker-compose\nchmod +x /usr/bin/docker-compose\n```\n\n오픈소스 ERP 프레임워크를 이용해서 필요한 것에만 집중하고 빠르게 개발\npython 기반의 odoo 이용\njavascript, c++, php 기반의 다른 프레임워크도 있었지만 파이썬을 써보고 싶고,\nMVC 구조에 모듈로 잘 구성되어 있고 지원해주는 기능이 많아서 odoo 사용\n\ndocker 이미지도 제공되어 있어 바로 사용 가능\n\nDB는 mysql, mssql, postgresql을 두고 봤을 때 postgresql이 docker에서 볼륨상태를\n그대로 옮기기 좋다고 하여 사용.\n\n`docker-compose.yml` 기본 뼈대\n\n```\nversion: '3'\nservices:\n  erp:\n    image: odoo:10.0\n\n  db:\n    image: postgres:9.4\n```\n\n### docker compose 로 여러 서비스 같이 관리한다\n\n포트, 아이디, 비밀번호 설정 등 추가적인 설정을 더해줬다\n\n```\nversion: '3'\nservices:\n  erp:\n    image: odoo:10.0\n    depens_on:\n      - db # db 실행 후 erp 서버 실행하도록 설정\n    ports:\n      - \"8069:8069\"\n    environment:\n      - HOST=db\n      - USER=odoo\n      - PASSWORD=odoo\n    volumes:\n      - odoo-data:/var/lib/odoo\n      - ./addons:/addions_external\n    working_dir: /usr/lib/python2.7/dist-packages/odoo/addons\n\n  db:\n    image: postgres:9.4\n    ports:\n      - \"5432:5432\"\n    environment:\n      - POSTGRES_USER=odoo\n      - POSTGRES_PASSWORD=odoo\n    volumes:\n      - db-data:/var/lib/postgresql/data\n\nvolumes: # 세미콜론(:) 뒤에 공백으로 해두면 docker에서 임의의 위치에 폴더를 잡는다\n  odoo-data:\n  db-data:\n```\n\n`docker-compose up` 을 해주면 odoo와 postgresql을 돌릴 수 있다.\n브라우저를 띄워서 `localhost:8069` 입력하고 조금 기다리면 화면이 뜬다\n\n![erp_first_page](../img/erp_first_page.png)\n\n여기까지만 해도 프로그램 자체는 띄울 수 있다\n그런데 각 상황에 맞게 수정을 해줘야 하는데,\n각 프로그램의 관리 파일을 찾아서 볼륨을 시켜주는 작업을 해야 한다.\n\n### 수정하고 지웠다가 다시 실행해보기\n\n처음 아이디와 비밀번호는 admin으로 입력하면 로그인이 된다.\n\n`http://localhost:8069/web/database/manager` 에 접속하면 db를 새로 만들거나\n수정할 수 있다\n\n이제 odoo를 입맛대로 수정하기 위해서는 addons 폴더에 있는 내용을\naddons_external 폴더로 이동 후에 수정하던지, 새로 만들어서 사용하면 된다\n\nproject 모듈로 한 번 테스트 해보자\n바로 확인하기 위해 views 쪽을 수정해본다.\n\n![before_update](../img/before_update.png)\n\n```\n> docker exec -it --user root odoo_erp_1 /bin/bash\n\n$ apt-get update && apt-get install -y vim # 문서 편집기 설치\n$ mv project /addons_external\n$ vi /etc/odoo/odoo.conf\n  addons_path = /mnt,extra-addons,/usr/lib/python2.7/dist-packages/odoo/addons 뒤에 /addons_external 추가\n  addons_path = /mnt,extra-addons,/usr/lib/python2.7/dist-packages/odoo/addons,/addons_external\n$ exit\n\n> vi /addons_external/project/views/project_views.xml\n> docker restart odoo_erp_1\n```\n\n![after_update](../img/after_update.png)\n\nodoo 가 아니더라도 volumes를 이용해서 수정할 폴더를 따로 빼놓고 수정할 내용은\n그곳에 넣는 방식으로 하면 수정된 내용을 바로 적용하기 좋았다\n\n지운 후 재실행 했을 때 작업했던 것이 남아있는지 확인해보자\n\n```\ndocker-compose down\ndocker-compose up\n```\n\n이렇게 하면 위에서 docker exec 이후 수정했던 부분은 초기화 되므로 이 작업을\n자동화 해주어야 한다.\n그래서 docker-compose.yml 파일 하나로만 구성 하려던 계획대로 되지는 않았다\n대신 확장성이 높아졌다.\n\n### docker-compose 확장 및 개선\n\nDockerfile 을 docker-compose.yml 이 있던 위치에 저장\n\n```\nFROM odoo:10.0\nUSER root\nRUN apt-get update && apt-get update -y vim\nRUN sed -i \"/addons_path/ s/$/,\\/addons_external/\" /etc/odoo/odoo.conf\nRUN rm -rf /usr/lib/python2.7/dist-packages/odoo/addons/project\n```\n\n다시 docker-compose.yml 수정\n\n```\nservices:\n  erp:\n    image: odoo:10.0\n```\n\n->\n\n```\nservices:\n  erp:\n    build: ./\n```\n\n다시 `docker-compose up` 을 해서 확인 가능하다\n\n다른 컴퓨터로 옮기기 위해서는 볼륨했던 것을 찾아서 옮겨주면 된다\n\n```\ndocker volume ls\ndocker volume inspect <odoo-erp-data>\n```\n\n![docker volume ls](../img/docker_volume.png)\n\n```\ndocker-compose stop\nsudo cp -r /var/lib/docker/volumes/odoo_test_odoo-erp-data/_data/ ./erp-data\nsudo cp -r /var/lib/docker/volumes/odoo_test_odoo-db-data/_data/ ./db-data\n```\n\n기존 데이터를 가져오고\n\n```\ndocker-compose up -d\ndocker-compose stop\nsudo su\ncp -r ./erp-data/_data/* /var/lib/docker/volumes/odoo_test_odoo-erp-data/_data\ncp -r ./db-data/_data/* /var/lib/docker/volumes/odoo_test_odoo-db-data/_data\ndocker-compose start\n```\n\n다시 가져온 데이터를 원래 위치로 보내준다.\nDB에서 추가 설정 필요 없이 바로 데이터 적용이 된다\n\n이렇게 하면 5개의 파일 및 폴더로 ERP 서버를 구동하게 된다\n\n```\n# 폴더 트리\naddons/ # 수정할 프로젝트 파일들\ndocker-compose.yml\nDockerfile\nerp-data/ # web 내부 데이터들\ndb-data/ # db 내부 데이터들\n```\n\n### 간단한 모니터링을 위해 nagios를 이용했다\n\n- Nagios - light weight, lots of modules, well documentation\n\n위 작성된 내용에 추가\n\n```\nservices:\n...\n  nagios4:\n    build:\n    volumes:\n      - \"/var/run/docker.sock:/var/run/docker.sock\" # docker process 모니터링\n    ports:\n      - \"8080:80\"\n```\n\n### 추가로 SSL 설정\n\n```\nservices:\n...\n  nginx:\n    build:\n    volumes:\n    ports:\n```\n\n전체 소스는 [github](https://github.com/shdkej/odoo_gvm)에서 볼 수 있다\n\n## 아쉬운 점\n\n- CI/CD\n- Test Code\n- HAproxy\n- ip setting automatic to vagrant\n- repository split\n- docker build to image\n- announcing update\n","frontmatter":{"title":"ERP 서버 개발 스텝 바이 스텝 & 회고","summary":"odoo와 docker-compose를 이용한 erp 서버 구축","date":"2020, 03 23","updated":"2021, 06 15","tags":null,"parent":null},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EB%AA%A9%ED%91%9C\">목표</a></p>\n</li>\n<li>\n<p><a href=\"#step-by-step\">Step by Step</a></p>\n<ul>\n<li><a href=\"#docker%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%84%9C-%EC%96%B4%EB%96%A4-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%EB%8F%84-%EC%89%BD%EA%B3%A0-%EB%B9%A0%EB%A5%B4%EA%B2%8C-%EC%84%9C%EB%B2%84%EB%A5%BC-%EA%B4%80%EB%A6%AC\">Docker를 사용해서 어떤 환경에서도 쉽고 빠르게 서버를 관리</a></li>\n<li><a href=\"#docker-compose-%EB%A1%9C-%EC%97%AC%EB%9F%AC-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B0%99%EC%9D%B4-%EA%B4%80%EB%A6%AC%ED%95%9C%EB%8B%A4\">docker compose 로 여러 서비스 같이 관리한다</a></li>\n<li><a href=\"#%EC%88%98%EC%A0%95%ED%95%98%EA%B3%A0-%EC%A7%80%EC%9B%A0%EB%8B%A4%EA%B0%80-%EB%8B%A4%EC%8B%9C-%EC%8B%A4%ED%96%89%ED%95%B4%EB%B3%B4%EA%B8%B0\">수정하고 지웠다가 다시 실행해보기</a></li>\n<li><a href=\"#docker-compose-%ED%99%95%EC%9E%A5-%EB%B0%8F-%EA%B0%9C%EC%84%A0\">docker-compose 확장 및 개선</a></li>\n<li><a href=\"#%EA%B0%84%EB%8B%A8%ED%95%9C-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81%EC%9D%84-%EC%9C%84%ED%95%B4-nagios%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%96%88%EB%8B%A4\">간단한 모니터링을 위해 nagios를 이용했다</a></li>\n<li><a href=\"#%EC%B6%94%EA%B0%80%EB%A1%9C-ssl-%EC%84%A4%EC%A0%95\">추가로 SSL 설정</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%95%84%EC%89%AC%EC%9A%B4-%EC%A0%90\">아쉬운 점</a></p>\n</li>\n</ul>"}},"pageContext":{"slug":"/deploy_erp_server_story/","previous":{"fields":{"slug":"/blogging/"},"frontmatter":{"title":"Blogging","tags":"communication"},"fileAbsolutePath":"/home/runner/work/shdkej.github.io/shdkej.github.io/content/Communication/Blogging.md"},"next":{"fields":{"slug":"/data_structure/"},"frontmatter":{"title":"Data Structure","tags":"fundamental"},"fileAbsolutePath":"/home/runner/work/shdkej.github.io/shdkej.github.io/content/Fundamental/Data_Structure.md"},"filePath":"blog/Deploy_ERP_server_story.md"}},"staticQueryHashes":["3000541721","4165914708","488914979"],"slicesMap":{}}