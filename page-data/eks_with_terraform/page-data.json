{"componentChunkName":"component---src-templates-blog-post-js","path":"/eks_with_terraform/","result":{"data":{"site":{"siteMetadata":{"title":"SH"}},"markdownRemark":{"id":"bdbb8d1a-3611-544b-a220-bf2255ebff1a","excerpt":"Terraform 을 이용해서 EKS 익히기 쿠버네티스 관리를 클라우드에 맡기고 쿠버네티스의 기능만 쓰게 해주는 EKS를 알아봅시다. Terraform으로 EKS를 올리면서 구성요소는 어떤 것이 있는지 확인해보려고 해요. 미리 셋팅 돼야하는 것들 aws 계정과 credential…","html":"<h2 id=\"terraform-을-이용해서-eks-익히기\" style=\"position:relative;\"><a href=\"#terraform-%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%B4%EC%84%9C-eks-%EC%9D%B5%ED%9E%88%EA%B8%B0\" aria-label=\"terraform 을 이용해서 eks 익히기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Terraform 을 이용해서 EKS 익히기</h2>\n<p>쿠버네티스 관리를 클라우드에 맡기고 쿠버네티스의 기능만 쓰게 해주는 EKS를 알아봅시다.</p>\n<p>Terraform으로 EKS를 올리면서 구성요소는 어떤 것이 있는지 확인해보려고 해요.</p>\n<h4 id=\"미리-셋팅-돼야하는-것들\" style=\"position:relative;\"><a href=\"#%EB%AF%B8%EB%A6%AC-%EC%85%8B%ED%8C%85-%EB%8F%BC%EC%95%BC%ED%95%98%EB%8A%94-%EA%B2%83%EB%93%A4\" aria-label=\"미리 셋팅 돼야하는 것들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>미리 셋팅 돼야하는 것들</h4>\n<ul>\n<li>aws 계정과 credential (~/.aws/credentials)</li>\n<li>terraform 설치</li>\n<li>kubectl</li>\n</ul>\n<h4 id=\"eks의-기본-리소스\" style=\"position:relative;\"><a href=\"#eks%EC%9D%98-%EA%B8%B0%EB%B3%B8-%EB%A6%AC%EC%86%8C%EC%8A%A4\" aria-label=\"eks의 기본 리소스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EKS의 기본 리소스</h4>\n<ul>\n<li>eks-cluster</li>\n<li>eks-worker-nodes</li>\n<li>vpc</li>\n<li>iam</li>\n</ul>\n<h4 id=\"클러스터-생성\" style=\"position:relative;\"><a href=\"#%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%83%9D%EC%84%B1\" aria-label=\"클러스터 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>클러스터 생성</h4>\n<p>모듈을 사용하는 것보다 하나씩 리소스를 선언해보는게 기본 구조를 파악하기 위해\n좋을 것 같아요.</p>\n<ul>\n<li><a href=\"https://github.com/hashicorp/terraform-provider-aws/tree/main/examples/eks-getting-started\">terraform-provider</a> 에서는 테라폼이 제공해주는 소스로, 모듈 없이 뼈대를 알아볼\n수 있습니다.</li>\n<li><a href=\"https://github.com/terraform-aws-modules/terraform-aws-eks/tree/master/examples/basic\">terraform-aws-modules</a> 에서는 모듈로 eks를 제공해주고 있습니다.</li>\n<li><a href=\"https://learn.hashicorp.com/tutorials/terraform/eks\">terraform 공식 가이드</a></li>\n<li><a href=\"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster\">terraform eks 리소스 document</a></li>\n</ul>\n<p>첫번째 예제(terraform-provider)를 참조해서 알아보도록 하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">git clone https://github.com/terraform-providers/terraform-provider-aws.git\ncd terraform-provider-aws/example/eks-getting-started</code></pre></div>\n<p>먼저 aws로 provider 설정이 돼있구요.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># providers.tf\nterraform {\n  required_version = \">= 0.12\"\n}\n\nprovider \"aws\" {\n  region = var.aws_region\n}</code></pre></div>\n<p>eks cluster라는 리소스가 있습니다.\n필수 옵션으로 <code class=\"language-text\">name</code>, <code class=\"language-text\">role_arn</code>, <code class=\"language-text\">vpc_config</code> 가 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># eks-cluster.tf\nresource \"aws_eks_cluster\" \"demo\" {\n  name = var.cluter-name\n  role_arn = aws_iam_role.demo-cluster.arn\n  vpc_config {\n    subnet_ids = aws_subnet.demo[*].id\n  }\n}</code></pre></div>\n<p><code class=\"language-text\">vpc_config</code> 안의 항목이 예제 소스에는 <code class=\"language-text\">security_group</code>도 있지만 <code class=\"language-text\">subnet_ids</code>만 필수입니다.</p>\n<p>eks cluster에서 role과 vpc의 subnet을 필수로 요구했으니 따라가보도록 하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># eks-cluster.tf\nresource \"aws_iam_role\" \"demo-cluster\" {\n  name = \"terraform-eks-demo-cluster\"\n  assume_role_policy = &lt;&lt;POLICY\n  ...\nPOLICY\n}\n\n# vpc.tf\nresource \"aws_vpc\" \"demo\" {\n  cidr_block = \"10.0.0.0/16\"\n\n  tags = {\n    Name = \"terraform-eks-demo-node\",\n    \"kubernetes.io/cluster/${var.cluster-name}\" = \"shared\",\n  }\n}\n\nresource \"aws_subnet\" {\n  count = 2\n\n  cidr_block = \"10.0.${count.index}.0/24\"\n  vpc_id = aws_vpc.demo.id\n\n  # optional\n  # availability_zone = data.aws_availability_zones.available.names[count.index]\n  # map_public_ip_on_launch = true\n}</code></pre></div>\n<p>여기에 iam role policy attachment와 az 설정, route table, gateway가 추가로\n있지만 일단 뼈대만 확인하기 위해 없이 해보도록 하겠습니다.</p>\n<p>하지만 worker node 는 왠지 있어야 할 것 같아 추가해보겠습니다</p>\n<ul>\n<li>예제 소스에서 worker node가 따로있는 것을 통해 node를 따로 선언해야한다는 것을\n유추해 볼 수 있는데, document 만으로는 따로 만들어야 한다는 정보를 얻을 수\n없었습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># eks-worker-nodes.tf\nresource \"aws_eks_node_group\" \"demo\" {\n  cluster_name = aws_eks_cluster.demo.name\n  node_role_arn = aws_iam_role.demo-node.arn\n  subnet_ids = aws_subnet.demo[*].id\n  node_group_name = \"demo\" #optional\n\n  scaling_config {\n    desired_size = 1\n    max_size = 1\n    min_size = 1\n  }\n}</code></pre></div>\n<p>어떤 인스턴스를 쓰는지는 옵셔널이네요. 기본 인스턴스는 amazon linux로 eks용\n이미지를 aws에서 제공해주는게 있다고 합니다.</p>\n<p>마지막으로 가이드를 보다보니 kubeconfig를 output으로 빼서 로컬에서 커맨드를 날릴\n수 있게 하는게 유용한 것 같아 output을 추가하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># output.tf\nlocals {\n  kubeconfig = &lt;&lt;KUBECONFIG\n\napiVersion: v1\nclusters:\n- cluster:\n    server: ${aws_eks_cluster.demo.endpoint}\n    certificate-authority-data: ${aws_eks_cluster.demo.certificate_authority[0].data}\n  name: kubernetes\ncontexts:\n- context:\n    cluster: kubernetes\n    user: aws\n  name: aws\ncurrent-context: aws\nkind: Config\npreferences: {}\nusers:\n- name: aws\n  user:\n    exec:\n      apiVersion: client.authentication.k8s.io/v1alpha1\n      command: aws-iam-authenticator\n      args:\n        - \"token\"\n        - \"-i\"\n        - \"${var.cluster-name}\"\nKUBECONFIG\n}\n\noutput \"kubeconfig\" {\n  value = local.kubeconfig\n}</code></pre></div>\n<p>여길 보니 <code class=\"language-text\">aws_eks_cluster</code>의 <code class=\"language-text\">endpoint</code>, <code class=\"language-text\">certificate_authority</code>,\n<code class=\"language-text\">var.cluster-name</code>를 변수로 가져오는군요.</p>\n<h4 id=\"그럼-이제-뼈대를-올려보도록-하겠습니다\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9F%BC-%EC%9D%B4%EC%A0%9C-%EB%BC%88%EB%8C%80%EB%A5%BC-%EC%98%AC%EB%A0%A4%EB%B3%B4%EB%8F%84%EB%A1%9D-%ED%95%98%EA%B2%A0%EC%8A%B5%EB%8B%88%EB%8B%A4\" aria-label=\"그럼 이제 뼈대를 올려보도록 하겠습니다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그럼 이제 뼈대를 올려보도록 하겠습니다.</h4>\n<p>! 시간당 $0.2 정도 든다고 합니다. 1시간 안에 끝내도록 해보겠습니다.</p>\n<ul>\n<li>클러스터 관리에 시간당 $0.1, EC2를 이용하기에 인스턴스 요금이 추가로 듭니다.</li>\n</ul>\n<p><code class=\"language-text\">terraform init, plan, apply</code></p>\n<p>생성이 오래걸려서 콘솔을 한 번 확인해봤습니다.</p>\n<ul>\n<li>콘솔창에서 생성하는 구성을 보니 네트워크에서 엔드포인트를 설정하고, CNI,\nCoreDNS, kube-proxy 버전을 고르도록 돼있는 반면, terraform에서는 이 설정을\n안하게 되네요.</li>\n</ul>\n<p>클러스터에 리소스를 만드는데 시간이 많이 걸립니다.</p>\n<p>! 노드 그룹 생성 중 Ec2SubnetInvalidConfiguration 에러가 발생했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">node group demo does not automatically assign public IP addresses to instances\nlaunched into it. If you want your instances to be assigned a public IP address,\nthen you need to enable auto-assign public IP address for the subnet. See IP\naddressing in VPC guide:\nhttps://docs.aws.amazon.com/vpc/latest/userguide/vpc-ip-addressing.html#subnet-public-ip</code></pre></div>\n<ul>\n<li>서브넷에서 public IP assing을 할 수 있도록 하라는 것 같습니다. 마침 아까 vpc\nsubnet에서 주석처리한 <code class=\"language-text\">map_public_ip_on_launch</code> 값이 있었습니다. 이 값을 다시\n설정해주니 노드그룹이 생성되었습니다.</li>\n</ul>\n<p>이렇게 eks cluster와 vpc, subnet, iam만 설정하면 eks는 생성되는 것을 볼 수\n있었습니다.</p>\n<p>하지만 이것만으로는 아무 기능이 없고 실제 일을 하는 노드도 생성해야함을 알 수\n있었습니다. 마찬가지로 실제 사용을 위해서는 추가적인 리소스가 더 필요할 것으로\n보입니다. 그건 차차 사용하면서 필요할 때 추가해보도록 하겠습니다.</p>\n<h4 id=\"쿠버네티스-동작-확인\" style=\"position:relative;\"><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%8F%99%EC%9E%91-%ED%99%95%EC%9D%B8\" aria-label=\"쿠버네티스 동작 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿠버네티스 동작 확인</h4>\n<p>다음 작업은 만들어진 클러스터를 이용해서 kubernetes에 pod를 생성해보도록\n하겠습니다.</p>\n<p><a href=\"https://aws.amazon.com/ko/blogs/startups/from-zero-to-eks-with-terraform-and-helm/\">aws 문서</a>를\n<a href=\"http://dveamer.github.io/backend/TerrafromAwsEks.html\">번역한 글</a>을 참고해서 진행해보도록 하겠습니다.</p>\n<p><code class=\"language-text\">terraform output kubeconfig > ~/.kube/config</code></p>\n<p><code class=\"language-text\">kubectl get node</code>로 확인</p>\n<ul>\n<li>실패</li>\n<li>Unable to connec to the server, executable aws-iam-authenticator not found</li>\n<li><a href=\"https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/install-aws-iam-authenticator.html\">aws-iam-authenticator</a>를 설치해봅시다.\n<ul>\n<li>네, 설치하고 환경변수 등록했더니 됩니다.</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"오토스케일링을-통해-트래픽-대응-확인\" style=\"position:relative;\"><a href=\"#%EC%98%A4%ED%86%A0%EC%8A%A4%EC%BC%80%EC%9D%BC%EB%A7%81%EC%9D%84-%ED%86%B5%ED%95%B4-%ED%8A%B8%EB%9E%98%ED%94%BD-%EB%8C%80%EC%9D%91-%ED%99%95%EC%9D%B8\" aria-label=\"오토스케일링을 통해 트래픽 대응 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>오토스케일링을 통해 트래픽 대응 확인</h4>\n<p>서비스를 하나 띄워두고 HPA를 만들고 트래픽을 받아서 오토스케일링을 잘\n하는지 확인해보도록 하겠습니다.</p>\n<p>오토스케일링은 쿠버네티스 HPA 또는 EKS Cluster Autoscaler를 이용할 수 있습니다.</p>\n<p>스케일링을 위해 metrics-server를 설치해야합니다.</p>\n<ul>\n<li>metrics-server 설치\n<code class=\"language-text\">kubectl apply -f  https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml</code></li>\n</ul>\n<p><a href=\"https://kubernetes.io/ko/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/\">간단한 hpa 테스트 방법</a>을 참고해서\nmetric-server를 설치한 후 테스트해봅시다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 디플로이먼트 생성\nkubectl apply -f https://k8s.io/examples/application/php-apache.yaml\n\n# 오토스케일 설정\nkubectl autoscale deployment php-apache --cpu-percent=50 --min=1 --max=10\n\n# 부하 주기\nkubectl run -i --tty load-generator --rm --image=busybox --restart=Never -- /bin/sh -c \"while sleep 0.01; do wget -q -O- http://php-apache; done\"\n</code></pre></div>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"margin: 0 0 50px auto;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8c99d41e1355483e052e810cd6285bfe/ecf19/hpa.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 81.77777777777779%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACxElEQVR42nVU2XLbMAz0p7ROHFsnSZG6Lcm2JN9pp///MdsFlUymmekDhiBFrBYLgCvVhcj6BEVjUHUKw2hxmAt0R4uqTVG0DvVQI28tdK6grUNEe0s1VFlhqxRCHSJQAWKTYDXMM/ppRHM8YT9OGM7czyM6nu2nCfVxQjvOKPojbNvD7juU/YC865HTL7iKuf2e64DV+HhiuNxwuFxwut29DZcrxvsdE78d6J9uN5zf3/3Z8dPnNzmfnk9vS+wDq+nxjuP17gMFoJ8vnlE3n9Gfr2hP9KfF33NtJQvele+SQX++MGY576YZq3xoYJoSrslR9w2U04gzhcQqpG5ZZf/pR5pmDHXTiKhjZDRCWmAsYptjZecGQZUhqRhUpQTX0CyQ4iq+qsUMNNesZ1GaDFnLfWlhCGhK3ufedB0y0fB4ffg0XxKNdazxM1JQVYuddtioDOtI/u7wI0hZkIE/aXmW4DVR3yxl5TMCUljJ/TVOvb3wsqkbppGxJYzfh5nFOozh2r2vpvif978sIaARwDsFnn2gHK7DBTD4BvgzEMClTcT/L+B4f7D3Lj54qzQ2pG+ZVkiRPwGjzBEkYt/1H4DRv2DRktkmIWBWtz6V2OWeia8WfQETcLm405lnvtxxH9l8Ab6lipZiR81Xjn9N85Jj1JDBwIACW22xI7DjJKRFRZ+VJevEFV4OuW+qZVV1iZAjadklpnRsm6FkKxSwNWe3K9iPlnPr2HeGfVUgyQvPUNiKBR/+28devm/SBNs0JkMtgBX7LydIgaovfQNHHPJAp2RXegkkSOQQtoskBQKRh+AvSYStTfhwxJ7E6vz8xYdhRHU44fr7D0fwhtP9CUfxZXarw5EMDV+Y3L8ugchBIAEW7UXbV/bumoXxRWnHkS9J7zXaj6MHkLnUDC6HwbMS4becCmEpz5bsN8nyfH0VaGmbv9W1BS4eM+QcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"hpa\"\n        title=\"\"\n        src=\"/static/8c99d41e1355483e052e810cd6285bfe/1cfc2/hpa.png\"\n        srcset=\"/static/8c99d41e1355483e052e810cd6285bfe/3684f/hpa.png 225w,\n/static/8c99d41e1355483e052e810cd6285bfe/fc2a6/hpa.png 450w,\n/static/8c99d41e1355483e052e810cd6285bfe/1cfc2/hpa.png 900w,\n/static/8c99d41e1355483e052e810cd6285bfe/ecf19/hpa.png 948w\"\n        sizes=\"(max-width: 900px) 100vw, 900px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">hpa</figcaption>\n  </figure></p>\n<p>간단하게 확인 작업은 됐습니다.</p>\n<h4 id=\"이제-ca를-테스트해보겠습니다\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EC%A0%9C-ca%EB%A5%BC-%ED%85%8C%EC%8A%A4%ED%8A%B8%ED%95%B4%EB%B3%B4%EA%B2%A0%EC%8A%B5%EB%8B%88%EB%8B%A4\" aria-label=\"이제 ca를 테스트해보겠습니다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이제 CA를 테스트해보겠습니다.</h4>\n<p>EKS Cluster Autoscaler는 설치가 필요합니다.</p>\n<p>Cluster autoscaler를 따로 설치해야하는줄 알았는데, worker-node를 설치할 때\nscaling config에 넣어준 옵션이 auto scaler를 위한 설정이었고, 자동 생성\n되었습니다.</p>\n<p><a href=\"https://aws-eks-web-application.workshop.aws/ko/100-scaling/200-cluster-scaling.html\">이 예제</a>\n를 참고해서 테스트해보겠습니다.\n먼저 테라폼 eks-worker-node에서 max size를 늘려줍니다. 저는 10으로 했습니다.\n그리고 파드를 100개 생성하고\nkubectl create deployment autoscaler-demo --image=nginx\nkubectl scale deployment autoscaler-demo --replicas=100</p>\n<p>지켜봅니다.</p>\n<p><code class=\"language-text\">k get nodes -w</code>\n<code class=\"language-text\">k get deploy autoscaler-demo -w</code></p>\n<p>! 저 예제 속에 있는 autoscaler discover가 안올라옵니다.</p>\n<ul>\n<li>terraform에서 수동으로 desired size를 2로 올리니 7개만 만들어진 파드가 23개로\n올라갔습니다.</li>\n<li>CA는 좀 더 확인해봐야 할 것 같습니다. (진행중)</li>\n</ul>\n<h4 id=\"추가로-해야-할-것들\" style=\"position:relative;\"><a href=\"#%EC%B6%94%EA%B0%80%EB%A1%9C-%ED%95%B4%EC%95%BC-%ED%95%A0-%EA%B2%83%EB%93%A4\" aria-label=\"추가로 해야 할 것들 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>추가로 해야 할 것들</h4>\n<p>ELB, NLB 등 로드밸런서 연결</p>\n<ul>\n<li><a href=\"https://learnk8s.io/terraform-eks\">https://learnk8s.io/terraform-eks</a></li>\n</ul>\n<h2 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h2>\n<p>terraform destory를 해도 그 리전에 처음 네트워크를 만들게 되면 기본 네트워크로\n설정되어 삭제가 안됩니다\n비용은 따로 나오지 않으니 다음에 삭제해도 되고, 콘솔에서 직접 삭제해도 됩니다.</p>\n<h5 id=\"eks-선언-안했는데자동생성된거-확인\" style=\"position:relative;\"><a href=\"#eks-%EC%84%A0%EC%96%B8-%EC%95%88%ED%96%88%EB%8A%94%EB%8D%B0%EC%9E%90%EB%8F%99%EC%83%9D%EC%84%B1%EB%90%9C%EA%B1%B0-%ED%99%95%EC%9D%B8\" aria-label=\"eks 선언 안했는데자동생성된거 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>eks 선언 안했는데자동생성된거 확인</h5>\n<ul>\n<li>로드 밸런스</li>\n<li>시큐리티그룹</li>\n<li>라우팅 테이블</li>\n</ul>\n<p>지금까지 EKS를 terraform 으로 빌드하고 EKS의 Cluster Autoscaler 기능을\n테스트해봤습니다.</p>\n<p>EKS가 어떤 리소스로 구성되어있고, CA는 어떻게 동작하는지 맛을 살짝 보았는데요.\n관리를 클라우드에 맡기는게 얼마나 메리트가 있는지 확인을 좀 해봐야겠습니다.</p>\n<h4 id=\"그-외-참고자료\" style=\"position:relative;\"><a href=\"#%EA%B7%B8-%EC%99%B8-%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"그 외 참고자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그 외 참고자료</h4>\n<ul>\n<li><a href=\"https://engineering.vcnc.co.kr/2019/02/eks-migration/\">https://engineering.vcnc.co.kr/2019/02/eks-migration/</a></li>\n<li><a href=\"https://suhwan.dev/2021/01/14/kubernetes-ops-components/\">https://suhwan.dev/2021/01/14/kubernetes-ops-components/</a></li>\n<li><a href=\"https://www.slideshare.net/ssuser833a99/aws-ecs-eks-principle-enterprise-evangelist\">https://www.slideshare.net/ssuser833a99/aws-ecs-eks-principle-enterprise-evangelist</a></li>\n</ul>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h2","properties":{"id":"terraform-을-이용해서-eks-익히기","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#terraform-%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%B4%EC%84%9C-eks-%EC%9D%B5%ED%9E%88%EA%B8%B0","ariaLabel":"terraform 을 이용해서 eks 익히기 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Terraform 을 이용해서 EKS 익히기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"쿠버네티스 관리를 클라우드에 맡기고 쿠버네티스의 기능만 쓰게 해주는 EKS를 알아봅시다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Terraform으로 EKS를 올리면서 구성요소는 어떤 것이 있는지 확인해보려고 해요."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"미리-셋팅-돼야하는-것들","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EB%AF%B8%EB%A6%AC-%EC%85%8B%ED%8C%85-%EB%8F%BC%EC%95%BC%ED%95%98%EB%8A%94-%EA%B2%83%EB%93%A4","ariaLabel":"미리 셋팅 돼야하는 것들 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"미리 셋팅 돼야하는 것들"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"aws 계정과 credential (~/.aws/credentials)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"terraform 설치"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"kubectl"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"eks의-기본-리소스","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#eks%EC%9D%98-%EA%B8%B0%EB%B3%B8-%EB%A6%AC%EC%86%8C%EC%8A%A4","ariaLabel":"eks의 기본 리소스 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"EKS의 기본 리소스"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"eks-cluster"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"eks-worker-nodes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"vpc"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"iam"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"클러스터-생성","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%83%9D%EC%84%B1","ariaLabel":"클러스터 생성 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"클러스터 생성"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"모듈을 사용하는 것보다 하나씩 리소스를 선언해보는게 기본 구조를 파악하기 위해\n좋을 것 같아요."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/hashicorp/terraform-provider-aws/tree/main/examples/eks-getting-started"},"children":[{"type":"text","value":"terraform-provider"}]},{"type":"text","value":" 에서는 테라폼이 제공해주는 소스로, 모듈 없이 뼈대를 알아볼\n수 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/terraform-aws-modules/terraform-aws-eks/tree/master/examples/basic"},"children":[{"type":"text","value":"terraform-aws-modules"}]},{"type":"text","value":" 에서는 모듈로 eks를 제공해주고 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://learn.hashicorp.com/tutorials/terraform/eks"},"children":[{"type":"text","value":"terraform 공식 가이드"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster"},"children":[{"type":"text","value":"terraform eks 리소스 document"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"첫번째 예제(terraform-provider)를 참조해서 알아보도록 하겠습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"git clone https://github.com/terraform-providers/terraform-provider-aws.git\ncd terraform-provider-aws/example/eks-getting-started"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"먼저 aws로 provider 설정이 돼있구요."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"# providers.tf\nterraform {\n  required_version = \">= 0.12\"\n}\n\nprovider \"aws\" {\n  region = var.aws_region\n}"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"eks cluster라는 리소스가 있습니다.\n필수 옵션으로 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"name"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"role_arn"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"vpc_config"}]},{"type":"text","value":" 가 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"# eks-cluster.tf\nresource \"aws_eks_cluster\" \"demo\" {\n  name = var.cluter-name\n  role_arn = aws_iam_role.demo-cluster.arn\n  vpc_config {\n    subnet_ids = aws_subnet.demo[*].id\n  }\n}"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"vpc_config"}]},{"type":"text","value":" 안의 항목이 예제 소스에는 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"security_group"}]},{"type":"text","value":"도 있지만 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"subnet_ids"}]},{"type":"text","value":"만 필수입니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"eks cluster에서 role과 vpc의 subnet을 필수로 요구했으니 따라가보도록 하겠습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"# eks-cluster.tf\nresource \"aws_iam_role\" \"demo-cluster\" {\n  name = \"terraform-eks-demo-cluster\"\n  assume_role_policy = <<POLICY\n  ...\nPOLICY\n}\n\n# vpc.tf\nresource \"aws_vpc\" \"demo\" {\n  cidr_block = \"10.0.0.0/16\"\n\n  tags = {\n    Name = \"terraform-eks-demo-node\",\n    \"kubernetes.io/cluster/${var.cluster-name}\" = \"shared\",\n  }\n}\n\nresource \"aws_subnet\" {\n  count = 2\n\n  cidr_block = \"10.0.${count.index}.0/24\"\n  vpc_id = aws_vpc.demo.id\n\n  # optional\n  # availability_zone = data.aws_availability_zones.available.names[count.index]\n  # map_public_ip_on_launch = true\n}"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"여기에 iam role policy attachment와 az 설정, route table, gateway가 추가로\n있지만 일단 뼈대만 확인하기 위해 없이 해보도록 하겠습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"하지만 worker node 는 왠지 있어야 할 것 같아 추가해보겠습니다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"예제 소스에서 worker node가 따로있는 것을 통해 node를 따로 선언해야한다는 것을\n유추해 볼 수 있는데, document 만으로는 따로 만들어야 한다는 정보를 얻을 수\n없었습니다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"# eks-worker-nodes.tf\nresource \"aws_eks_node_group\" \"demo\" {\n  cluster_name = aws_eks_cluster.demo.name\n  node_role_arn = aws_iam_role.demo-node.arn\n  subnet_ids = aws_subnet.demo[*].id\n  node_group_name = \"demo\" #optional\n\n  scaling_config {\n    desired_size = 1\n    max_size = 1\n    min_size = 1\n  }\n}"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"어떤 인스턴스를 쓰는지는 옵셔널이네요. 기본 인스턴스는 amazon linux로 eks용\n이미지를 aws에서 제공해주는게 있다고 합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"마지막으로 가이드를 보다보니 kubeconfig를 output으로 빼서 로컬에서 커맨드를 날릴\n수 있게 하는게 유용한 것 같아 output을 추가하겠습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"# output.tf\nlocals {\n  kubeconfig = <<KUBECONFIG\n\napiVersion: v1\nclusters:\n- cluster:\n    server: ${aws_eks_cluster.demo.endpoint}\n    certificate-authority-data: ${aws_eks_cluster.demo.certificate_authority[0].data}\n  name: kubernetes\ncontexts:\n- context:\n    cluster: kubernetes\n    user: aws\n  name: aws\ncurrent-context: aws\nkind: Config\npreferences: {}\nusers:\n- name: aws\n  user:\n    exec:\n      apiVersion: client.authentication.k8s.io/v1alpha1\n      command: aws-iam-authenticator\n      args:\n        - \"token\"\n        - \"-i\"\n        - \"${var.cluster-name}\"\nKUBECONFIG\n}\n\noutput \"kubeconfig\" {\n  value = local.kubeconfig\n}"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"여길 보니 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"aws_eks_cluster"}]},{"type":"text","value":"의 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"endpoint"}]},{"type":"text","value":", "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"certificate_authority"}]},{"type":"text","value":",\n"},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"var.cluster-name"}]},{"type":"text","value":"를 변수로 가져오는군요."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"그럼-이제-뼈대를-올려보도록-하겠습니다","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EA%B7%B8%EB%9F%BC-%EC%9D%B4%EC%A0%9C-%EB%BC%88%EB%8C%80%EB%A5%BC-%EC%98%AC%EB%A0%A4%EB%B3%B4%EB%8F%84%EB%A1%9D-%ED%95%98%EA%B2%A0%EC%8A%B5%EB%8B%88%EB%8B%A4","ariaLabel":"그럼 이제 뼈대를 올려보도록 하겠습니다 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"그럼 이제 뼈대를 올려보도록 하겠습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"! 시간당 $0.2 정도 든다고 합니다. 1시간 안에 끝내도록 해보겠습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"클러스터 관리에 시간당 $0.1, EC2를 이용하기에 인스턴스 요금이 추가로 듭니다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"terraform init, plan, apply"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"생성이 오래걸려서 콘솔을 한 번 확인해봤습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"콘솔창에서 생성하는 구성을 보니 네트워크에서 엔드포인트를 설정하고, CNI,\nCoreDNS, kube-proxy 버전을 고르도록 돼있는 반면, terraform에서는 이 설정을\n안하게 되네요."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"클러스터에 리소스를 만드는데 시간이 많이 걸립니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"! 노드 그룹 생성 중 Ec2SubnetInvalidConfiguration 에러가 발생했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"node group demo does not automatically assign public IP addresses to instances\nlaunched into it. If you want your instances to be assigned a public IP address,\nthen you need to enable auto-assign public IP address for the subnet. See IP\naddressing in VPC guide:\nhttps://docs.aws.amazon.com/vpc/latest/userguide/vpc-ip-addressing.html#subnet-public-ip"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"서브넷에서 public IP assing을 할 수 있도록 하라는 것 같습니다. 마침 아까 vpc\nsubnet에서 주석처리한 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"map_public_ip_on_launch"}]},{"type":"text","value":" 값이 있었습니다. 이 값을 다시\n설정해주니 노드그룹이 생성되었습니다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이렇게 eks cluster와 vpc, subnet, iam만 설정하면 eks는 생성되는 것을 볼 수\n있었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"하지만 이것만으로는 아무 기능이 없고 실제 일을 하는 노드도 생성해야함을 알 수\n있었습니다. 마찬가지로 실제 사용을 위해서는 추가적인 리소스가 더 필요할 것으로\n보입니다. 그건 차차 사용하면서 필요할 때 추가해보도록 하겠습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"쿠버네티스-동작-확인","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%8F%99%EC%9E%91-%ED%99%95%EC%9D%B8","ariaLabel":"쿠버네티스 동작 확인 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"쿠버네티스 동작 확인"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다음 작업은 만들어진 클러스터를 이용해서 kubernetes에 pod를 생성해보도록\n하겠습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://aws.amazon.com/ko/blogs/startups/from-zero-to-eks-with-terraform-and-helm/"},"children":[{"type":"text","value":"aws 문서"}]},{"type":"text","value":"를\n"},{"type":"element","tagName":"a","properties":{"href":"http://dveamer.github.io/backend/TerrafromAwsEks.html"},"children":[{"type":"text","value":"번역한 글"}]},{"type":"text","value":"을 참고해서 진행해보도록 하겠습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"terraform output kubeconfig > ~/.kube/config"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl get node"}]},{"type":"text","value":"로 확인"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"실패"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Unable to connec to the server, executable aws-iam-authenticator not found"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/install-aws-iam-authenticator.html"},"children":[{"type":"text","value":"aws-iam-authenticator"}]},{"type":"text","value":"를 설치해봅시다.\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"네, 설치하고 환경변수 등록했더니 됩니다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"오토스케일링을-통해-트래픽-대응-확인","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%98%A4%ED%86%A0%EC%8A%A4%EC%BC%80%EC%9D%BC%EB%A7%81%EC%9D%84-%ED%86%B5%ED%95%B4-%ED%8A%B8%EB%9E%98%ED%94%BD-%EB%8C%80%EC%9D%91-%ED%99%95%EC%9D%B8","ariaLabel":"오토스케일링을 통해 트래픽 대응 확인 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"오토스케일링을 통해 트래픽 대응 확인"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"서비스를 하나 띄워두고 HPA를 만들고 트래픽을 받아서 오토스케일링을 잘\n하는지 확인해보도록 하겠습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"오토스케일링은 쿠버네티스 HPA 또는 EKS Cluster Autoscaler를 이용할 수 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"스케일링을 위해 metrics-server를 설치해야합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"metrics-server 설치\n"},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl apply -f  https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/ko/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/"},"children":[{"type":"text","value":"간단한 hpa 테스트 방법"}]},{"type":"text","value":"을 참고해서\nmetric-server를 설치한 후 테스트해봅시다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"# 디플로이먼트 생성\nkubectl apply -f https://k8s.io/examples/application/php-apache.yaml\n\n# 오토스케일 설정\nkubectl autoscale deployment php-apache --cpu-percent=50 --min=1 --max=10\n\n# 부하 주기\nkubectl run -i --tty load-generator --rm --image=busybox --restart=Never -- /bin/sh -c \"while sleep 0.01; do wget -q -O- http://php-apache; done\"\n"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[]},{"type":"element","tagName":"figure","properties":{"className":["gatsby-resp-image-figure"],"style":"margin: 0 0 50px auto;"},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 900px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/8c99d41e1355483e052e810cd6285bfe/ecf19/hpa.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 81.77777777777779%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACxElEQVR42nVU2XLbMAz0p7ROHFsnSZG6Lcm2JN9pp///MdsFlUymmekDhiBFrBYLgCvVhcj6BEVjUHUKw2hxmAt0R4uqTVG0DvVQI28tdK6grUNEe0s1VFlhqxRCHSJQAWKTYDXMM/ppRHM8YT9OGM7czyM6nu2nCfVxQjvOKPojbNvD7juU/YC865HTL7iKuf2e64DV+HhiuNxwuFxwut29DZcrxvsdE78d6J9uN5zf3/3Z8dPnNzmfnk9vS+wDq+nxjuP17gMFoJ8vnlE3n9Gfr2hP9KfF33NtJQvele+SQX++MGY576YZq3xoYJoSrslR9w2U04gzhcQqpG5ZZf/pR5pmDHXTiKhjZDRCWmAsYptjZecGQZUhqRhUpQTX0CyQ4iq+qsUMNNesZ1GaDFnLfWlhCGhK3ufedB0y0fB4ffg0XxKNdazxM1JQVYuddtioDOtI/u7wI0hZkIE/aXmW4DVR3yxl5TMCUljJ/TVOvb3wsqkbppGxJYzfh5nFOozh2r2vpvif978sIaARwDsFnn2gHK7DBTD4BvgzEMClTcT/L+B4f7D3Lj54qzQ2pG+ZVkiRPwGjzBEkYt/1H4DRv2DRktkmIWBWtz6V2OWeia8WfQETcLm405lnvtxxH9l8Ab6lipZiR81Xjn9N85Jj1JDBwIACW22xI7DjJKRFRZ+VJevEFV4OuW+qZVV1iZAjadklpnRsm6FkKxSwNWe3K9iPlnPr2HeGfVUgyQvPUNiKBR/+28devm/SBNs0JkMtgBX7LydIgaovfQNHHPJAp2RXegkkSOQQtoskBQKRh+AvSYStTfhwxJ7E6vz8xYdhRHU44fr7D0fwhtP9CUfxZXarw5EMDV+Y3L8ugchBIAEW7UXbV/bumoXxRWnHkS9J7zXaj6MHkLnUDC6HwbMS4becCmEpz5bsN8nyfH0VaGmbv9W1BS4eM+QcAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"hpa","title":"","src":"/static/8c99d41e1355483e052e810cd6285bfe/1cfc2/hpa.png","srcSet":["/static/8c99d41e1355483e052e810cd6285bfe/3684f/hpa.png 225w","/static/8c99d41e1355483e052e810cd6285bfe/fc2a6/hpa.png 450w","/static/8c99d41e1355483e052e810cd6285bfe/1cfc2/hpa.png 900w","/static/8c99d41e1355483e052e810cd6285bfe/ecf19/hpa.png 948w"],"sizes":"(max-width: 900px) 100vw, 900px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]},{"type":"text","value":"\n    "},{"type":"element","tagName":"figcaption","properties":{"className":["gatsby-resp-image-figcaption"]},"children":[{"type":"text","value":"hpa"}]},{"type":"text","value":"\n  "}]},{"type":"element","tagName":"p","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"간단하게 확인 작업은 됐습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"이제-ca를-테스트해보겠습니다","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%9D%B4%EC%A0%9C-ca%EB%A5%BC-%ED%85%8C%EC%8A%A4%ED%8A%B8%ED%95%B4%EB%B3%B4%EA%B2%A0%EC%8A%B5%EB%8B%88%EB%8B%A4","ariaLabel":"이제 ca를 테스트해보겠습니다 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"이제 CA를 테스트해보겠습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"EKS Cluster Autoscaler는 설치가 필요합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Cluster autoscaler를 따로 설치해야하는줄 알았는데, worker-node를 설치할 때\nscaling config에 넣어준 옵션이 auto scaler를 위한 설정이었고, 자동 생성\n되었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://aws-eks-web-application.workshop.aws/ko/100-scaling/200-cluster-scaling.html"},"children":[{"type":"text","value":"이 예제"}]},{"type":"text","value":"\n를 참고해서 테스트해보겠습니다.\n먼저 테라폼 eks-worker-node에서 max size를 늘려줍니다. 저는 10으로 했습니다.\n그리고 파드를 100개 생성하고\nkubectl create deployment autoscaler-demo --image=nginx\nkubectl scale deployment autoscaler-demo --replicas=100"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"지켜봅니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"k get nodes -w"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"k get deploy autoscaler-demo -w"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"! 저 예제 속에 있는 autoscaler discover가 안올라옵니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"terraform에서 수동으로 desired size를 2로 올리니 7개만 만들어진 파드가 23개로\n올라갔습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"CA는 좀 더 확인해봐야 할 것 같습니다. (진행중)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"추가로-해야-할-것들","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%B6%94%EA%B0%80%EB%A1%9C-%ED%95%B4%EC%95%BC-%ED%95%A0-%EA%B2%83%EB%93%A4","ariaLabel":"추가로 해야 할 것들 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"추가로 해야 할 것들"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ELB, NLB 등 로드밸런서 연결"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://learnk8s.io/terraform-eks"},"children":[{"type":"text","value":"https://learnk8s.io/terraform-eks"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"정리","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%A0%95%EB%A6%AC","ariaLabel":"정리 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"정리"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"terraform destory를 해도 그 리전에 처음 네트워크를 만들게 되면 기본 네트워크로\n설정되어 삭제가 안됩니다\n비용은 따로 나오지 않으니 다음에 삭제해도 되고, 콘솔에서 직접 삭제해도 됩니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h5","properties":{"id":"eks-선언-안했는데자동생성된거-확인","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#eks-%EC%84%A0%EC%96%B8-%EC%95%88%ED%96%88%EB%8A%94%EB%8D%B0%EC%9E%90%EB%8F%99%EC%83%9D%EC%84%B1%EB%90%9C%EA%B1%B0-%ED%99%95%EC%9D%B8","ariaLabel":"eks 선언 안했는데자동생성된거 확인 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"eks 선언 안했는데자동생성된거 확인"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"로드 밸런스"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"시큐리티그룹"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"라우팅 테이블"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"지금까지 EKS를 terraform 으로 빌드하고 EKS의 Cluster Autoscaler 기능을\n테스트해봤습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"EKS가 어떤 리소스로 구성되어있고, CA는 어떻게 동작하는지 맛을 살짝 보았는데요.\n관리를 클라우드에 맡기는게 얼마나 메리트가 있는지 확인을 좀 해봐야겠습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"그-외-참고자료","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EA%B7%B8-%EC%99%B8-%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C","ariaLabel":"그 외 참고자료 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"그 외 참고자료"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://engineering.vcnc.co.kr/2019/02/eks-migration/"},"children":[{"type":"text","value":"https://engineering.vcnc.co.kr/2019/02/eks-migration/"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://suhwan.dev/2021/01/14/kubernetes-ops-components/"},"children":[{"type":"text","value":"https://suhwan.dev/2021/01/14/kubernetes-ops-components/"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://www.slideshare.net/ssuser833a99/aws-ecs-eks-principle-enterprise-evangelist"},"children":[{"type":"text","value":"https://www.slideshare.net/ssuser833a99/aws-ecs-eks-principle-enterprise-evangelist"}]}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"rawMarkdownBody":"\n## Terraform 을 이용해서 EKS 익히기\n\n쿠버네티스 관리를 클라우드에 맡기고 쿠버네티스의 기능만 쓰게 해주는 EKS를 알아봅시다.\n\nTerraform으로 EKS를 올리면서 구성요소는 어떤 것이 있는지 확인해보려고 해요.\n\n#### 미리 셋팅 돼야하는 것들\n\n- aws 계정과 credential (~/.aws/credentials)\n- terraform 설치\n- kubectl\n\n#### EKS의 기본 리소스\n\n- eks-cluster\n- eks-worker-nodes\n- vpc\n- iam\n\n#### 클러스터 생성\n\n모듈을 사용하는 것보다 하나씩 리소스를 선언해보는게 기본 구조를 파악하기 위해\n좋을 것 같아요.\n\n- [terraform-provider](https://github.com/hashicorp/terraform-provider-aws/tree/main/examples/eks-getting-started) 에서는 테라폼이 제공해주는 소스로, 모듈 없이 뼈대를 알아볼\n  수 있습니다.\n- [terraform-aws-modules](https://github.com/terraform-aws-modules/terraform-aws-eks/tree/master/examples/basic) 에서는 모듈로 eks를 제공해주고 있습니다.\n- [terraform 공식 가이드](https://learn.hashicorp.com/tutorials/terraform/eks)\n- [terraform eks 리소스 document](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/eks_cluster)\n\n첫번째 예제(terraform-provider)를 참조해서 알아보도록 하겠습니다.\n\n```\ngit clone https://github.com/terraform-providers/terraform-provider-aws.git\ncd terraform-provider-aws/example/eks-getting-started\n```\n\n먼저 aws로 provider 설정이 돼있구요.\n\n```\n# providers.tf\nterraform {\n  required_version = \">= 0.12\"\n}\n\nprovider \"aws\" {\n  region = var.aws_region\n}\n```\n\neks cluster라는 리소스가 있습니다.\n필수 옵션으로 `name`, `role_arn`, `vpc_config` 가 있습니다.\n\n```\n# eks-cluster.tf\nresource \"aws_eks_cluster\" \"demo\" {\n  name = var.cluter-name\n  role_arn = aws_iam_role.demo-cluster.arn\n  vpc_config {\n    subnet_ids = aws_subnet.demo[*].id\n  }\n}\n```\n\n`vpc_config` 안의 항목이 예제 소스에는 `security_group`도 있지만 `subnet_ids`만 필수입니다.\n\neks cluster에서 role과 vpc의 subnet을 필수로 요구했으니 따라가보도록 하겠습니다.\n\n```\n# eks-cluster.tf\nresource \"aws_iam_role\" \"demo-cluster\" {\n  name = \"terraform-eks-demo-cluster\"\n  assume_role_policy = <<POLICY\n  ...\nPOLICY\n}\n\n# vpc.tf\nresource \"aws_vpc\" \"demo\" {\n  cidr_block = \"10.0.0.0/16\"\n\n  tags = {\n    Name = \"terraform-eks-demo-node\",\n    \"kubernetes.io/cluster/${var.cluster-name}\" = \"shared\",\n  }\n}\n\nresource \"aws_subnet\" {\n  count = 2\n\n  cidr_block = \"10.0.${count.index}.0/24\"\n  vpc_id = aws_vpc.demo.id\n\n  # optional\n  # availability_zone = data.aws_availability_zones.available.names[count.index]\n  # map_public_ip_on_launch = true\n}\n```\n\n여기에 iam role policy attachment와 az 설정, route table, gateway가 추가로\n있지만 일단 뼈대만 확인하기 위해 없이 해보도록 하겠습니다.\n\n하지만 worker node 는 왠지 있어야 할 것 같아 추가해보겠습니다\n\n- 예제 소스에서 worker node가 따로있는 것을 통해 node를 따로 선언해야한다는 것을\n  유추해 볼 수 있는데, document 만으로는 따로 만들어야 한다는 정보를 얻을 수\n  없었습니다.\n\n```\n# eks-worker-nodes.tf\nresource \"aws_eks_node_group\" \"demo\" {\n  cluster_name = aws_eks_cluster.demo.name\n  node_role_arn = aws_iam_role.demo-node.arn\n  subnet_ids = aws_subnet.demo[*].id\n  node_group_name = \"demo\" #optional\n\n  scaling_config {\n    desired_size = 1\n    max_size = 1\n    min_size = 1\n  }\n}\n```\n\n어떤 인스턴스를 쓰는지는 옵셔널이네요. 기본 인스턴스는 amazon linux로 eks용\n이미지를 aws에서 제공해주는게 있다고 합니다.\n\n마지막으로 가이드를 보다보니 kubeconfig를 output으로 빼서 로컬에서 커맨드를 날릴\n수 있게 하는게 유용한 것 같아 output을 추가하겠습니다.\n\n```\n# output.tf\nlocals {\n  kubeconfig = <<KUBECONFIG\n\napiVersion: v1\nclusters:\n- cluster:\n    server: ${aws_eks_cluster.demo.endpoint}\n    certificate-authority-data: ${aws_eks_cluster.demo.certificate_authority[0].data}\n  name: kubernetes\ncontexts:\n- context:\n    cluster: kubernetes\n    user: aws\n  name: aws\ncurrent-context: aws\nkind: Config\npreferences: {}\nusers:\n- name: aws\n  user:\n    exec:\n      apiVersion: client.authentication.k8s.io/v1alpha1\n      command: aws-iam-authenticator\n      args:\n        - \"token\"\n        - \"-i\"\n        - \"${var.cluster-name}\"\nKUBECONFIG\n}\n\noutput \"kubeconfig\" {\n  value = local.kubeconfig\n}\n```\n\n여길 보니 `aws_eks_cluster`의 `endpoint`, `certificate_authority`,\n`var.cluster-name`를 변수로 가져오는군요.\n\n#### 그럼 이제 뼈대를 올려보도록 하겠습니다.\n\n! 시간당 $0.2 정도 든다고 합니다. 1시간 안에 끝내도록 해보겠습니다.\n\n- 클러스터 관리에 시간당 $0.1, EC2를 이용하기에 인스턴스 요금이 추가로 듭니다.\n\n`terraform init, plan, apply`\n\n생성이 오래걸려서 콘솔을 한 번 확인해봤습니다.\n\n- 콘솔창에서 생성하는 구성을 보니 네트워크에서 엔드포인트를 설정하고, CNI,\n  CoreDNS, kube-proxy 버전을 고르도록 돼있는 반면, terraform에서는 이 설정을\n  안하게 되네요.\n\n클러스터에 리소스를 만드는데 시간이 많이 걸립니다.\n\n! 노드 그룹 생성 중 Ec2SubnetInvalidConfiguration 에러가 발생했습니다.\n\n```\nnode group demo does not automatically assign public IP addresses to instances\nlaunched into it. If you want your instances to be assigned a public IP address,\nthen you need to enable auto-assign public IP address for the subnet. See IP\naddressing in VPC guide:\nhttps://docs.aws.amazon.com/vpc/latest/userguide/vpc-ip-addressing.html#subnet-public-ip\n```\n\n- 서브넷에서 public IP assing을 할 수 있도록 하라는 것 같습니다. 마침 아까 vpc\n  subnet에서 주석처리한 `map_public_ip_on_launch` 값이 있었습니다. 이 값을 다시\n  설정해주니 노드그룹이 생성되었습니다.\n\n이렇게 eks cluster와 vpc, subnet, iam만 설정하면 eks는 생성되는 것을 볼 수\n있었습니다.\n\n하지만 이것만으로는 아무 기능이 없고 실제 일을 하는 노드도 생성해야함을 알 수\n있었습니다. 마찬가지로 실제 사용을 위해서는 추가적인 리소스가 더 필요할 것으로\n보입니다. 그건 차차 사용하면서 필요할 때 추가해보도록 하겠습니다.\n\n#### 쿠버네티스 동작 확인\n\n다음 작업은 만들어진 클러스터를 이용해서 kubernetes에 pod를 생성해보도록\n하겠습니다.\n\n[aws 문서](https://aws.amazon.com/ko/blogs/startups/from-zero-to-eks-with-terraform-and-helm/)를\n[번역한 글](http://dveamer.github.io/backend/TerrafromAwsEks.html)을 참고해서 진행해보도록 하겠습니다.\n\n`terraform output kubeconfig > ~/.kube/config`\n\n`kubectl get node`로 확인\n\n- 실패\n- Unable to connec to the server, executable aws-iam-authenticator not found\n- [aws-iam-authenticator](https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/install-aws-iam-authenticator.html)를 설치해봅시다.\n  - 네, 설치하고 환경변수 등록했더니 됩니다.\n\n#### 오토스케일링을 통해 트래픽 대응 확인\n\n서비스를 하나 띄워두고 HPA를 만들고 트래픽을 받아서 오토스케일링을 잘\n하는지 확인해보도록 하겠습니다.\n\n오토스케일링은 쿠버네티스 HPA 또는 EKS Cluster Autoscaler를 이용할 수 있습니다.\n\n스케일링을 위해 metrics-server를 설치해야합니다.\n\n- metrics-server 설치\n  `kubectl apply -f  https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml`\n\n[간단한 hpa 테스트 방법](https://kubernetes.io/ko/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/)을 참고해서\nmetric-server를 설치한 후 테스트해봅시다.\n\n```\n# 디플로이먼트 생성\nkubectl apply -f https://k8s.io/examples/application/php-apache.yaml\n\n# 오토스케일 설정\nkubectl autoscale deployment php-apache --cpu-percent=50 --min=1 --max=10\n\n# 부하 주기\nkubectl run -i --tty load-generator --rm --image=busybox --restart=Never -- /bin/sh -c \"while sleep 0.01; do wget -q -O- http://php-apache; done\"\n\n```\n\n![hpa](../img/hpa.png)\n\n간단하게 확인 작업은 됐습니다.\n\n#### 이제 CA를 테스트해보겠습니다.\n\nEKS Cluster Autoscaler는 설치가 필요합니다.\n\nCluster autoscaler를 따로 설치해야하는줄 알았는데, worker-node를 설치할 때\nscaling config에 넣어준 옵션이 auto scaler를 위한 설정이었고, 자동 생성\n되었습니다.\n\n[이 예제](https://aws-eks-web-application.workshop.aws/ko/100-scaling/200-cluster-scaling.html)\n를 참고해서 테스트해보겠습니다.\n먼저 테라폼 eks-worker-node에서 max size를 늘려줍니다. 저는 10으로 했습니다.\n그리고 파드를 100개 생성하고\nkubectl create deployment autoscaler-demo --image=nginx\nkubectl scale deployment autoscaler-demo --replicas=100\n\n지켜봅니다.\n\n`k get nodes -w`\n`k get deploy autoscaler-demo -w`\n\n! 저 예제 속에 있는 autoscaler discover가 안올라옵니다.\n\n- terraform에서 수동으로 desired size를 2로 올리니 7개만 만들어진 파드가 23개로\n  올라갔습니다.\n- CA는 좀 더 확인해봐야 할 것 같습니다. (진행중)\n\n#### 추가로 해야 할 것들\n\nELB, NLB 등 로드밸런서 연결\n\n- https://learnk8s.io/terraform-eks\n\n## 정리\n\nterraform destory를 해도 그 리전에 처음 네트워크를 만들게 되면 기본 네트워크로\n설정되어 삭제가 안됩니다\n비용은 따로 나오지 않으니 다음에 삭제해도 되고, 콘솔에서 직접 삭제해도 됩니다.\n\n##### eks 선언 안했는데자동생성된거 확인\n\n- 로드 밸런스\n- 시큐리티그룹\n- 라우팅 테이블\n\n지금까지 EKS를 terraform 으로 빌드하고 EKS의 Cluster Autoscaler 기능을\n테스트해봤습니다.\n\nEKS가 어떤 리소스로 구성되어있고, CA는 어떻게 동작하는지 맛을 살짝 보았는데요.\n관리를 클라우드에 맡기는게 얼마나 메리트가 있는지 확인을 좀 해봐야겠습니다.\n\n#### 그 외 참고자료\n\n- https://engineering.vcnc.co.kr/2019/02/eks-migration/\n- https://suhwan.dev/2021/01/14/kubernetes-ops-components/\n- https://www.slideshare.net/ssuser833a99/aws-ecs-eks-principle-enterprise-evangelist\n","frontmatter":{"title":"EKS 맛보기","summary":"근데 이제 Terraform을 곁들인","date":"2021, 08 15","updated":"2021, 08 17","tags":null,"parent":[["Blogging"]]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#terraform-%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%B4%EC%84%9C-eks-%EC%9D%B5%ED%9E%88%EA%B8%B0\">Terraform 을 이용해서 EKS 익히기</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%EB%AF%B8%EB%A6%AC-%EC%85%8B%ED%8C%85-%EB%8F%BC%EC%95%BC%ED%95%98%EB%8A%94-%EA%B2%83%EB%93%A4\">미리 셋팅 돼야하는 것들</a></li>\n<li><a href=\"#eks%EC%9D%98-%EA%B8%B0%EB%B3%B8-%EB%A6%AC%EC%86%8C%EC%8A%A4\">EKS의 기본 리소스</a></li>\n<li><a href=\"#%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%83%9D%EC%84%B1\">클러스터 생성</a></li>\n<li><a href=\"#%EA%B7%B8%EB%9F%BC-%EC%9D%B4%EC%A0%9C-%EB%BC%88%EB%8C%80%EB%A5%BC-%EC%98%AC%EB%A0%A4%EB%B3%B4%EB%8F%84%EB%A1%9D-%ED%95%98%EA%B2%A0%EC%8A%B5%EB%8B%88%EB%8B%A4\">그럼 이제 뼈대를 올려보도록 하겠습니다.</a></li>\n<li><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%8F%99%EC%9E%91-%ED%99%95%EC%9D%B8\">쿠버네티스 동작 확인</a></li>\n<li><a href=\"#%EC%98%A4%ED%86%A0%EC%8A%A4%EC%BC%80%EC%9D%BC%EB%A7%81%EC%9D%84-%ED%86%B5%ED%95%B4-%ED%8A%B8%EB%9E%98%ED%94%BD-%EB%8C%80%EC%9D%91-%ED%99%95%EC%9D%B8\">오토스케일링을 통해 트래픽 대응 확인</a></li>\n<li><a href=\"#%EC%9D%B4%EC%A0%9C-ca%EB%A5%BC-%ED%85%8C%EC%8A%A4%ED%8A%B8%ED%95%B4%EB%B3%B4%EA%B2%A0%EC%8A%B5%EB%8B%88%EB%8B%A4\">이제 CA를 테스트해보겠습니다.</a></li>\n<li><a href=\"#%EC%B6%94%EA%B0%80%EB%A1%9C-%ED%95%B4%EC%95%BC-%ED%95%A0-%EA%B2%83%EB%93%A4\">추가로 해야 할 것들</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></p>\n<ul>\n<li>\n<ul>\n<li>\n<ul>\n<li><a href=\"#eks-%EC%84%A0%EC%96%B8-%EC%95%88%ED%96%88%EB%8A%94%EB%8D%B0%EC%9E%90%EB%8F%99%EC%83%9D%EC%84%B1%EB%90%9C%EA%B1%B0-%ED%99%95%EC%9D%B8\">eks 선언 안했는데자동생성된거 확인</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B7%B8-%EC%99%B8-%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\">그 외 참고자료</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>"}},"pageContext":{"slug":"/eks_with_terraform/","previous":{"fields":{"slug":"/note_management/"},"frontmatter":{"title":"노트를 어떻게 관리해야 할까","tags":null},"fileAbsolutePath":"/home/runner/work/shdkej.github.io/shdkej.github.io/content/blog/Note_Management.md"},"next":{"fields":{"slug":"/일/"},"frontmatter":{"title":"일에 대해서","tags":"meta"},"fileAbsolutePath":"/home/runner/work/shdkej.github.io/shdkej.github.io/content/Meta/일.md"},"filePath":"blog/EKS_with_terraform.md"}},"staticQueryHashes":["3000541721","4165914708","488914979"],"slicesMap":{}}