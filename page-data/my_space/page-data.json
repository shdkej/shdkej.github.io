{"componentChunkName":"component---src-templates-blog-post-js","path":"/my_space/","result":{"data":{"site":{"siteMetadata":{"title":"SH"}},"markdownRemark":{"id":"6c74052b-1d8e-515a-8c1d-a1f568ec7208","excerpt":"확장 가능하고 변경이 쉬운 환경 구축하기. 배포는 인프라에서 처리한다. kubernetes cloud host 월…","html":"<h2 id=\"확장-가능하고-변경이-쉬운-환경-구축하기\" style=\"position:relative;\"><a href=\"#%ED%99%95%EC%9E%A5-%EA%B0%80%EB%8A%A5%ED%95%98%EA%B3%A0-%EB%B3%80%EA%B2%BD%EC%9D%B4-%EC%89%AC%EC%9A%B4-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0\" aria-label=\"확장 가능하고 변경이 쉬운 환경 구축하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>확장 가능하고 변경이 쉬운 환경 구축하기.</h2>\n<p>배포는 인프라에서 처리한다.</p>\n<h2 id=\"kubernetes-cloud-host\" style=\"position:relative;\"><a href=\"#kubernetes-cloud-host\" aria-label=\"kubernetes cloud host permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubernetes cloud host</h2>\n<p>월 5천원 정도만 쓰는 인스턴스 하나 구해서 페이팔 연동, 피씨에서 접속\n어떤 호스트, 어떤 인스턴스를 쓸지\n네트워크, 디스크 가격은 어떻게 되는지 확인.\n쿠버네티스 돌려서 테스트 하는 것까지 블로그 글 작성</p>\n<ol>\n<li>aws, gcp</li>\n<li>cpu, ram</li>\n<li>네트워크 설정</li>\n<li>쿠버네티스 구동(단독형으로 쓸까...)</li>\n</ol>\n<p>클라우드 페이팔 연동해서 n26 매달 빠져나가게 설정\n한달 5유로 정도면 100개월 사용 가능</p>\n<p>price of 3 nodes\naws(RAM 1G): 0.72\ngcp(f1-micro RAM 0.6): 1 free, 2 0.36\ngcp(e2-micro RAM 1G): 0.60</p>\n<ul>\n<li>network more. disk 1G free</li>\n</ul>\n<p>How many pod can run in 1 cpu 512 ram</p>\n<ul>\n<li>kubernetes use 1GB ram</li>\n</ul>\n<p>Build Kubernetes server hybrid</p>\n<ul>\n<li>Check cloud fee</li>\n<li>Run Logging monitoring app</li>\n<li>kubernetes test</li>\n<li>롤링 업데이트 롤백 테스트</li>\n<li>카나리 배포 테스트</li>\n<li>기본 디플로이먼트 실행 후 스트레스 테스트 - cpu 500m, ram 500m 설정 시 nginx 성능 테스트</li>\n<li>auto scaling 배포 후 스트레스 테스트 - 위의 디플로이먼트를 auto scaling 할 시 중단이 없는지 테스트</li>\n<li>쿠버네티스 성능 테스트\n<ul>\n<li>블로그 포스트 작성</li>\n</ul>\n</li>\n<li>페일오버, 이중화 확인</li>\n<li>Mlops 서버에 배포\n<ul>\n<li>모델 바꾸고 푸시하면 바로 업데이트 되도록</li>\n</ul>\n</li>\n<li>고 gRPC 서버 배포\n<ul>\n<li>푸시하면 배포</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"digital-ocean-으로-쿠버네티스-구축\" style=\"position:relative;\"><a href=\"#digital-ocean-%EC%9C%BC%EB%A1%9C-%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EA%B5%AC%EC%B6%95\" aria-label=\"digital ocean 으로 쿠버네티스 구축 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>digital ocean 으로 쿠버네티스 구축</h4>\n<p>필요한 정보</p>\n<ul>\n<li>do api token</li>\n<li>스페이스를 만들어야 한다</li>\n<li>s3 endpoint, region</li>\n</ul>\n<p>compute instance가 droplet 이라는 명칭으로 되어있다. aws에서 ec2 인것처럼\nblock storage는 뭐지</p>\n<p>TLqkf space access key가 안맞다고 계속 에러난다</p>\n<ul>\n<li>Tlqfk .terraform 에 데이터가 저장되어있어서 그랬다. 삭제 후 진행하니 된다</li>\n</ul>\n<p>테라폼 13 버전 위부터 provider 에서 required_provider로 바꿔야하고,\n14버전에서는 source=\"digitalocean/digitalocean\" 으로 설정해줘야 한다</p>\n<p>kubernetes를 DIY로 하는 것은 3노드를 사용하면 15$/month\nkubernetes 서비스를 제공하는 것을 사용하면 10$/month\n자체 쿠버네티스 서비스를 사용할 때 추가요금 내는게 없는지 확인해봐야겠다</p>\n<ul>\n<li>한 노드당 10$였다.. ㅋㅋ</li>\n</ul>\n<p>provision file 에서 ssh key 퍼미션 400으로 바꿔줘야 한다\nansible에서 로컬 네트워크로 전달이 안된다</p>\n<ul class=\"contains-task-list\">\n<li>\n<p>python interpreter 설정 해줘야 한다</p>\n</li>\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" checked disabled> argocd 깔고,</p>\n</li>\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" checked disabled> 모니터링 깔고,</p>\n</li>\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" checked disabled> 로드밸런서 깔고,</p>\n</li>\n</ul>\n<ol>\n<li>모니터링으로 상태 확인 해야한다.</li>\n<li>모니터링 서버는 로드밸런서로 접속 잘되게 설정한다</li>\n<li>argocd로 배포할 때 상태를 본다.</li>\n</ol>\n<p>마스터 서버를 hosts에 등록해놔야겠다\n로드밸런서를 cloud에서 생성 안해도 로드밸런서가 켜질까?</p>\n<p>grafana를 구동하는데 리소스가 많이 든다</p>\n<ul>\n<li>grafana가 문제가 아니라 k3s를 돌리는 것만으로도 0.9G 메모리를 먹었다.</li>\n</ul>\n<p>traefik이 디폴트로 깔려있다.</p>\n<ul>\n<li>dashboard를 쓰도록 configmap을 설정한다</li>\n<li>scale을 0으로 했다가 1로 해서 리스타트한다.</li>\n<li>port forwarding을 해주니까 로컬에서 localhost로 접속이 된다??\n<ul>\n<li>kubectl port forwarding 은 입력하는 호스트를 인식해서 실행되나보다</li>\n</ul>\n</li>\n</ul>\n<p>grafana 올린거에 service를 찾아서 ingress 붙여주니까 잘 된다</p>\n<ul class=\"contains-task-list\">\n<li>\n<p>traefik으로 name based routing을 하니까 접속은 되는데 사진은 못받아왔다</p>\n<ul>\n<li>grafana도 잘되는 걸로 봐서는 ingress가 단일 주소만 받아오는건 아닌듯</li>\n</ul>\n</li>\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" checked disabled> digital ocean dns 세팅해서 휴대폰으로 접속 확인</p>\n<ul>\n<li>cloudflare 를 terraform으로 올려서 dns를 쓰도록 해야겠다</li>\n</ul>\n</li>\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" disabled> 상태 모니터링 알림 추가</p>\n</li>\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" disabled> 배포 시 상태 추적해서 오버로드 발생하면 바로 알림 오는지 확인</p>\n</li>\n<li class=\"task-list-item\">\n<p><input type=\"checkbox\" disabled> 알림 받으면 바로 롤백하는 것도 해본다</p>\n</li>\n</ul>\n<p>내부 시스템은 내부적으로만 traefik으로 설정해놓으면 되겠다\ngrafana.system 정도로 /etc/hosts만 다 설정해주면 로컬용으로 쓸 수 있겠다</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> golang으로 api 서버 만들어서 telegram 보내는 것도 등록\n<ul>\n<li>추상화 잘 해서 telegram을 바로 slack으로 대체 할 수 있도록</li>\n</ul>\n</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> jenkins 설치 후 pr 테스트</li>\n</ul>\n<h4 id=\"확장-가능한-최소한의-인프라\" style=\"position:relative;\"><a href=\"#%ED%99%95%EC%9E%A5-%EA%B0%80%EB%8A%A5%ED%95%9C-%EC%B5%9C%EC%86%8C%ED%95%9C%EC%9D%98-%EC%9D%B8%ED%94%84%EB%9D%BC\" aria-label=\"확장 가능한 최소한의 인프라 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>확장 가능한 최소한의 인프라</h4>\n<p>3노드 쿠버네티스\n로드밸런서\n로그 수집\n모니터링\napi\nfeedback\nci/cd tool</p>\n<ul>\n<li>사용하는 서비스</li>\n</ul>\n<p>kafka, redis, mongodb, hadoop, rdbms</p>\n<h4 id=\"개인-서버-구축\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9D%B8-%EC%84%9C%EB%B2%84-%EA%B5%AC%EC%B6%95\" aria-label=\"개인 서버 구축 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개인 서버 구축</h4>\n<p>Iaac로 되어야 한다\n원할 때 접속, 배포가 쉽게 되어야 한다\n재구축이 바로 되어야 한다\n서버를 돌리고 있는데 서버가 지저분해져서 다시 쌓아올리고 싶을 때 원하는 상태로 바로 만들 수 있어야 한다\n- vagrant kubernetes setting need too many time\n쿠버네티스 안에서 돌리고 에러 한눈에 확인 필요\n쿠버네티스는 어디서 돌리지? 일단 베이그런트로\n카오스 몽키가 로그 서버도 멈추게 할 수 있나?\n각 앱들을 쿠버네티스 파일로 만들고 IaaC가 되도록\n로컬, 클라우드 확인</p>\n<h2 id=\"tool\" style=\"position:relative;\"><a href=\"#tool\" aria-label=\"tool permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tool</h2>\n<p>k3s</p>\n<ul>\n<li>tool</li>\n<li>service</li>\n<li>infra</li>\n</ul>\n<p>tool</p>\n<ul>\n<li>n8n</li>\n<li>tailscale</li>\n</ul>\n<p>service</p>\n<ul>\n<li>note server - redis</li>\n<li>wiki - postgres</li>\n<li>searching - elasticsearch</li>\n</ul>\n<p>infra</p>\n<ul>\n<li>grafana</li>\n<li>prometheus</li>\n<li>traefik</li>\n<li>argocd</li>\n</ul>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h2","properties":{"id":"확장-가능하고-변경이-쉬운-환경-구축하기","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%ED%99%95%EC%9E%A5-%EA%B0%80%EB%8A%A5%ED%95%98%EA%B3%A0-%EB%B3%80%EA%B2%BD%EC%9D%B4-%EC%89%AC%EC%9A%B4-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0","ariaLabel":"확장 가능하고 변경이 쉬운 환경 구축하기 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"확장 가능하고 변경이 쉬운 환경 구축하기."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"배포는 인프라에서 처리한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"kubernetes-cloud-host","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes-cloud-host","ariaLabel":"kubernetes cloud host permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"kubernetes cloud host"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"월 5천원 정도만 쓰는 인스턴스 하나 구해서 페이팔 연동, 피씨에서 접속\n어떤 호스트, 어떤 인스턴스를 쓸지\n네트워크, 디스크 가격은 어떻게 되는지 확인.\n쿠버네티스 돌려서 테스트 하는 것까지 블로그 글 작성"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"aws, gcp"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cpu, ram"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"네트워크 설정"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"쿠버네티스 구동(단독형으로 쓸까...)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"클라우드 페이팔 연동해서 n26 매달 빠져나가게 설정\n한달 5유로 정도면 100개월 사용 가능"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"price of 3 nodes\naws(RAM 1G): 0.72\ngcp(f1-micro RAM 0.6): 1 free, 2 0.36\ngcp(e2-micro RAM 1G): 0.60"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"network more. disk 1G free"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"How many pod can run in 1 cpu 512 ram"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"kubernetes use 1GB ram"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Build Kubernetes server hybrid"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Check cloud fee"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Run Logging monitoring app"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"kubernetes test"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"롤링 업데이트 롤백 테스트"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"카나리 배포 테스트"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"기본 디플로이먼트 실행 후 스트레스 테스트 - cpu 500m, ram 500m 설정 시 nginx 성능 테스트"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"auto scaling 배포 후 스트레스 테스트 - 위의 디플로이먼트를 auto scaling 할 시 중단이 없는지 테스트"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"쿠버네티스 성능 테스트\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"블로그 포스트 작성"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"페일오버, 이중화 확인"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Mlops 서버에 배포\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"모델 바꾸고 푸시하면 바로 업데이트 되도록"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"고 gRPC 서버 배포\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"푸시하면 배포"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"digital-ocean-으로-쿠버네티스-구축","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#digital-ocean-%EC%9C%BC%EB%A1%9C-%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EA%B5%AC%EC%B6%95","ariaLabel":"digital ocean 으로 쿠버네티스 구축 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"digital ocean 으로 쿠버네티스 구축"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"필요한 정보"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"do api token"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"스페이스를 만들어야 한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"s3 endpoint, region"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"compute instance가 droplet 이라는 명칭으로 되어있다. aws에서 ec2 인것처럼\nblock storage는 뭐지"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"TLqkf space access key가 안맞다고 계속 에러난다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Tlqfk .terraform 에 데이터가 저장되어있어서 그랬다. 삭제 후 진행하니 된다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"테라폼 13 버전 위부터 provider 에서 required_provider로 바꿔야하고,\n14버전에서는 source=\"digitalocean/digitalocean\" 으로 설정해줘야 한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"kubernetes를 DIY로 하는 것은 3노드를 사용하면 15$/month\nkubernetes 서비스를 제공하는 것을 사용하면 10$/month\n자체 쿠버네티스 서비스를 사용할 때 추가요금 내는게 없는지 확인해봐야겠다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"한 노드당 10$였다.. ㅋㅋ"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"provision file 에서 ssh key 퍼미션 400으로 바꿔줘야 한다\nansible에서 로컬 네트워크로 전달이 안된다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{"className":["contains-task-list"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"python interpreter 설정 해줘야 한다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","checked":true,"disabled":true},"children":[]},{"type":"text","value":" argocd 깔고,"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","checked":true,"disabled":true},"children":[]},{"type":"text","value":" 모니터링 깔고,"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","checked":true,"disabled":true},"children":[]},{"type":"text","value":" 로드밸런서 깔고,"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"모니터링으로 상태 확인 해야한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"모니터링 서버는 로드밸런서로 접속 잘되게 설정한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"argocd로 배포할 때 상태를 본다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"마스터 서버를 hosts에 등록해놔야겠다\n로드밸런서를 cloud에서 생성 안해도 로드밸런서가 켜질까?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"grafana를 구동하는데 리소스가 많이 든다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"grafana가 문제가 아니라 k3s를 돌리는 것만으로도 0.9G 메모리를 먹었다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"traefik이 디폴트로 깔려있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"dashboard를 쓰도록 configmap을 설정한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"scale을 0으로 했다가 1로 해서 리스타트한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"port forwarding을 해주니까 로컬에서 localhost로 접속이 된다??\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"kubectl port forwarding 은 입력하는 호스트를 인식해서 실행되나보다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"grafana 올린거에 service를 찾아서 ingress 붙여주니까 잘 된다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{"className":["contains-task-list"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"traefik으로 name based routing을 하니까 접속은 되는데 사진은 못받아왔다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"grafana도 잘되는 걸로 봐서는 ingress가 단일 주소만 받아오는건 아닌듯"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","checked":true,"disabled":true},"children":[]},{"type":"text","value":" digital ocean dns 세팅해서 휴대폰으로 접속 확인"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cloudflare 를 terraform으로 올려서 dns를 쓰도록 해야겠다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","disabled":true},"children":[]},{"type":"text","value":" 상태 모니터링 알림 추가"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","disabled":true},"children":[]},{"type":"text","value":" 배포 시 상태 추적해서 오버로드 발생하면 바로 알림 오는지 확인"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","disabled":true},"children":[]},{"type":"text","value":" 알림 받으면 바로 롤백하는 것도 해본다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"내부 시스템은 내부적으로만 traefik으로 설정해놓으면 되겠다\ngrafana.system 정도로 /etc/hosts만 다 설정해주면 로컬용으로 쓸 수 있겠다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{"className":["contains-task-list"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","disabled":true},"children":[]},{"type":"text","value":" golang으로 api 서버 만들어서 telegram 보내는 것도 등록\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"추상화 잘 해서 telegram을 바로 slack으로 대체 할 수 있도록"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","disabled":true},"children":[]},{"type":"text","value":" jenkins 설치 후 pr 테스트"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"확장-가능한-최소한의-인프라","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%ED%99%95%EC%9E%A5-%EA%B0%80%EB%8A%A5%ED%95%9C-%EC%B5%9C%EC%86%8C%ED%95%9C%EC%9D%98-%EC%9D%B8%ED%94%84%EB%9D%BC","ariaLabel":"확장 가능한 최소한의 인프라 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"확장 가능한 최소한의 인프라"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"3노드 쿠버네티스\n로드밸런서\n로그 수집\n모니터링\napi\nfeedback\nci/cd tool"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"사용하는 서비스"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"kafka, redis, mongodb, hadoop, rdbms"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"개인-서버-구축","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EA%B0%9C%EC%9D%B8-%EC%84%9C%EB%B2%84-%EA%B5%AC%EC%B6%95","ariaLabel":"개인 서버 구축 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"개인 서버 구축"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Iaac로 되어야 한다\n원할 때 접속, 배포가 쉽게 되어야 한다\n재구축이 바로 되어야 한다\n서버를 돌리고 있는데 서버가 지저분해져서 다시 쌓아올리고 싶을 때 원하는 상태로 바로 만들 수 있어야 한다\n- vagrant kubernetes setting need too many time\n쿠버네티스 안에서 돌리고 에러 한눈에 확인 필요\n쿠버네티스는 어디서 돌리지? 일단 베이그런트로\n카오스 몽키가 로그 서버도 멈추게 할 수 있나?\n각 앱들을 쿠버네티스 파일로 만들고 IaaC가 되도록\n로컬, 클라우드 확인"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"tool","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#tool","ariaLabel":"tool permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Tool"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"k3s"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"tool"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"service"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"infra"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"tool"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"n8n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"tailscale"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"service"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"note server - redis"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"wiki - postgres"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"searching - elasticsearch"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"infra"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"grafana"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"prometheus"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"traefik"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"argocd"}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"rawMarkdownBody":"\n## 확장 가능하고 변경이 쉬운 환경 구축하기.\n배포는 인프라에서 처리한다.\n\n## kubernetes cloud host\n월 5천원 정도만 쓰는 인스턴스 하나 구해서 페이팔 연동, 피씨에서 접속\n어떤 호스트, 어떤 인스턴스를 쓸지\n네트워크, 디스크 가격은 어떻게 되는지 확인.\n쿠버네티스 돌려서 테스트 하는 것까지 블로그 글 작성\n\n1. aws, gcp\n2. cpu, ram\n3. 네트워크 설정\n4. 쿠버네티스 구동(단독형으로 쓸까...)\n\n클라우드 페이팔 연동해서 n26 매달 빠져나가게 설정\n한달 5유로 정도면 100개월 사용 가능\n\nprice of 3 nodes\naws(RAM 1G): 0.72\ngcp(f1-micro RAM 0.6): 1 free, 2 0.36\ngcp(e2-micro RAM 1G): 0.60\n- network more. disk 1G free\n\nHow many pod can run in 1 cpu 512 ram\n- kubernetes use 1GB ram\n\nBuild Kubernetes server hybrid\n\n- Check cloud fee\n- Run Logging monitoring app\n- kubernetes test\n- 롤링 업데이트 롤백 테스트\n- 카나리 배포 테스트\n- 기본 디플로이먼트 실행 후 스트레스 테스트 - cpu 500m, ram 500m 설정 시 nginx 성능 테스트\n- auto scaling 배포 후 스트레스 테스트 - 위의 디플로이먼트를 auto scaling 할 시 중단이 없는지 테스트\n- 쿠버네티스 성능 테스트\n  - 블로그 포스트 작성\n- 페일오버, 이중화 확인\n- Mlops 서버에 배포\n  - 모델 바꾸고 푸시하면 바로 업데이트 되도록\n- 고 gRPC 서버 배포\n  - 푸시하면 배포\n\n#### digital ocean 으로 쿠버네티스 구축\n필요한 정보\n- do api token\n- 스페이스를 만들어야 한다\n- s3 endpoint, region\n\ncompute instance가 droplet 이라는 명칭으로 되어있다. aws에서 ec2 인것처럼\nblock storage는 뭐지\n\nTLqkf space access key가 안맞다고 계속 에러난다\n- Tlqfk .terraform 에 데이터가 저장되어있어서 그랬다. 삭제 후 진행하니 된다\n\n테라폼 13 버전 위부터 provider 에서 required_provider로 바꿔야하고,\n14버전에서는 source=\"digitalocean/digitalocean\" 으로 설정해줘야 한다\n\n\nkubernetes를 DIY로 하는 것은 3노드를 사용하면 15$/month\nkubernetes 서비스를 제공하는 것을 사용하면 10$/month\n자체 쿠버네티스 서비스를 사용할 때 추가요금 내는게 없는지 확인해봐야겠다\n- 한 노드당 10$였다.. ㅋㅋ\n\nprovision file 에서 ssh key 퍼미션 400으로 바꿔줘야 한다\nansible에서 로컬 네트워크로 전달이 안된다\n- python interpreter 설정 해줘야 한다\n\n- [X] argocd 깔고,\n- [X] 모니터링 깔고,\n- [X] 로드밸런서 깔고,\n1. 모니터링으로 상태 확인 해야한다.\n2. 모니터링 서버는 로드밸런서로 접속 잘되게 설정한다\n3. argocd로 배포할 때 상태를 본다.\n\n마스터 서버를 hosts에 등록해놔야겠다\n로드밸런서를 cloud에서 생성 안해도 로드밸런서가 켜질까?\n\ngrafana를 구동하는데 리소스가 많이 든다\n- grafana가 문제가 아니라 k3s를 돌리는 것만으로도 0.9G 메모리를 먹었다.\n\ntraefik이 디폴트로 깔려있다.\n- dashboard를 쓰도록 configmap을 설정한다\n- scale을 0으로 했다가 1로 해서 리스타트한다.\n- port forwarding을 해주니까 로컬에서 localhost로 접속이 된다??\n    - kubectl port forwarding 은 입력하는 호스트를 인식해서 실행되나보다\n\ngrafana 올린거에 service를 찾아서 ingress 붙여주니까 잘 된다\n\n- traefik으로 name based routing을 하니까 접속은 되는데 사진은 못받아왔다\n    - grafana도 잘되는 걸로 봐서는 ingress가 단일 주소만 받아오는건 아닌듯\n- [X] digital ocean dns 세팅해서 휴대폰으로 접속 확인\n    - cloudflare 를 terraform으로 올려서 dns를 쓰도록 해야겠다\n\n- [ ] 상태 모니터링 알림 추가\n- [ ] 배포 시 상태 추적해서 오버로드 발생하면 바로 알림 오는지 확인\n- [ ] 알림 받으면 바로 롤백하는 것도 해본다\n\n내부 시스템은 내부적으로만 traefik으로 설정해놓으면 되겠다\ngrafana.system 정도로 /etc/hosts만 다 설정해주면 로컬용으로 쓸 수 있겠다\n\n- [ ] golang으로 api 서버 만들어서 telegram 보내는 것도 등록\n    - 추상화 잘 해서 telegram을 바로 slack으로 대체 할 수 있도록\n- [ ] jenkins 설치 후 pr 테스트\n\n#### 확장 가능한 최소한의 인프라\n3노드 쿠버네티스\n로드밸런서\n로그 수집\n모니터링\napi\nfeedback\nci/cd tool\n\n+ 사용하는 서비스\nkafka, redis, mongodb, hadoop, rdbms\n\n#### 개인 서버 구축\nIaac로 되어야 한다\n원할 때 접속, 배포가 쉽게 되어야 한다\n재구축이 바로 되어야 한다\n서버를 돌리고 있는데 서버가 지저분해져서 다시 쌓아올리고 싶을 때 원하는 상태로 바로 만들 수 있어야 한다\n    - vagrant kubernetes setting need too many time\n쿠버네티스 안에서 돌리고 에러 한눈에 확인 필요\n쿠버네티스는 어디서 돌리지? 일단 베이그런트로\n카오스 몽키가 로그 서버도 멈추게 할 수 있나?\n각 앱들을 쿠버네티스 파일로 만들고 IaaC가 되도록\n로컬, 클라우드 확인\n\n\n## Tool\nk3s\n- tool\n- service\n- infra\n\ntool\n- n8n\n- tailscale\n\nservice\n- note server - redis\n- wiki - postgres\n- searching - elasticsearch\n\ninfra\n- grafana\n- prometheus\n- traefik\n- argocd\n","frontmatter":{"title":"My Space","summary":null,"date":"2021, 04 14","updated":"2021, 06 01","tags":null,"parent":[["Blogging"]]},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%ED%99%95%EC%9E%A5-%EA%B0%80%EB%8A%A5%ED%95%98%EA%B3%A0-%EB%B3%80%EA%B2%BD%EC%9D%B4-%EC%89%AC%EC%9A%B4-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0\">확장 가능하고 변경이 쉬운 환경 구축하기.</a></p>\n</li>\n<li>\n<p><a href=\"#kubernetes-cloud-host\">kubernetes cloud host</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#digital-ocean-%EC%9C%BC%EB%A1%9C-%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EA%B5%AC%EC%B6%95\">digital ocean 으로 쿠버네티스 구축</a></li>\n<li><a href=\"#%ED%99%95%EC%9E%A5-%EA%B0%80%EB%8A%A5%ED%95%9C-%EC%B5%9C%EC%86%8C%ED%95%9C%EC%9D%98-%EC%9D%B8%ED%94%84%EB%9D%BC\">확장 가능한 최소한의 인프라</a></li>\n<li><a href=\"#%EA%B0%9C%EC%9D%B8-%EC%84%9C%EB%B2%84-%EA%B5%AC%EC%B6%95\">개인 서버 구축</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#tool\">Tool</a></p>\n</li>\n</ul>"}},"pageContext":{"slug":"/my_space/","previous":{"fields":{"slug":"/web/"},"frontmatter":{"title":"WEB","tags":"deep_knowledge"},"fileAbsolutePath":"/home/runner/work/shdkej.github.io/shdkej.github.io/content/Deep Knowledge/Web.md"},"next":{"fields":{"slug":"/my_space/"},"frontmatter":{"title":"My Space","tags":null},"fileAbsolutePath":"/home/runner/work/shdkej.github.io/shdkej.github.io/content/blog/My_space.md"},"filePath":"Meta/My_space.md"}},"staticQueryHashes":["3000541721","4165914708","488914979"],"slicesMap":{}}