{"componentChunkName":"component---src-templates-blog-post-js","path":"/container/","result":{"data":{"site":{"siteMetadata":{"title":"SH"}},"markdownRemark":{"id":"69f26e74-e89b-503c-8626-c3764a67813d","excerpt":"Container docker strength isolation process no dependency portable light-weight Docker image vs compose image vs volume test with volume, deploy with image…","html":"<h1 id=\"container\" style=\"position:relative;\"><a href=\"#container\" aria-label=\"container permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Container</h1>\n<h4 id=\"docker-strength\" style=\"position:relative;\"><a href=\"#docker-strength\" aria-label=\"docker strength permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker strength</h4>\n<ul>\n<li>isolation process</li>\n<li>no dependency</li>\n<li>portable</li>\n<li>light-weight</li>\n</ul>\n<h4 id=\"docker-image-vs-compose\" style=\"position:relative;\"><a href=\"#docker-image-vs-compose\" aria-label=\"docker image vs compose permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker image vs compose</h4>\n<ul>\n<li>image vs volume\n<ul>\n<li>test with volume, deploy with image</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"docker-logs\" style=\"position:relative;\"><a href=\"#docker-logs\" aria-label=\"docker logs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker logs</h4>\n<ul>\n<li>make stdout\n<ul>\n<li><code class=\"language-text\">echo \"test\" >> /proc/1/fd/1</code></li>\n</ul>\n</li>\n<li><code class=\"language-text\">--log-opt</code>\n<ul>\n<li><code class=\"language-text\">max-size</code></li>\n<li><code class=\"language-text\">max-file</code></li>\n</ul>\n</li>\n</ul>\n<p>Fluentd와 Eleasticsearch를 이용해서 로그 수집 및 검색</p>\n<p>표준출력(stdout)으로 로그를 출력하도록 두고, 이를 수집하도록 한다.</p>\n<p>nginx는 stdout으로 출력되도록 설정이 필요하다</p>\n<ul>\n<li>1.19.8 버전을 쓰는 지금은 stdout으로 출력되도록 설정되어있다.</li>\n</ul>\n<h4 id=\"container-1\" style=\"position:relative;\"><a href=\"#container-1\" aria-label=\"container 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>container</h4>\n<p>libcontainer 개발로 kernel에서 namespaces, cgroups 등을 직접 실행\nLXC -> runC 컨테이너 런타임 변경. OCI 준수\n그 외 rkt, cri-o 등이 있음</p>\n<p>LXC는 다른 호스트에서 실행했을 때 설정 차이로 동일하게 돌아가지 않는 경우가\n있었다고 한다.\n도커도 버전 다르면 안돌아간다.</p>\n<p>Container 구동 원리</p>\n<ul>\n<li><code class=\"language-text\">chroot</code> - 입력받은 디렉토리를 루트로 하여 격리된 환경을 만들어준다</li>\n<li>cgroups - 시스템 리소스를 격리할 수 있다(cpu, memory, network, disk)</li>\n<li>overlayFS - 프로세스 간 파일 시스템 분리\n<ul>\n<li>image layer + container layer(컨테이너 안에서 수정되는 파일들)</li>\n</ul>\n</li>\n<li>namespace - <code class=\"language-text\">unshare</code> 프로세스 간 시스템 자원들을 격리하는 기능\n<ul>\n<li>cgroup - <code class=\"language-text\">-C</code></li>\n<li>user - <code class=\"language-text\">-U</code></li>\n<li>mnt - <code class=\"language-text\">-m</code></li>\n<li>ipc - <code class=\"language-text\">-i</code> 프로세스 간 통신. 같은 네임스페이스 안에 있어야 통신 가능</li>\n<li>pid - <code class=\"language-text\">-p</code> 컨테이너 안에서는 프로세스 번호를 새롭게 받는다</li>\n<li>uts - <code class=\"language-text\">-u</code> hostname 격리</li>\n<li>net - <code class=\"language-text\">ip netns add &lt;ns name></code> 네트워크 규칙들을 새롭게 받는다</li>\n</ul>\n</li>\n<li><a href=\"https://speakerdeck.com/devinjeon/containerbuteo-dasi-salpyeoboneun-kubernetes-pod-dongjag-weonri?slide=29\">https://speakerdeck.com/devinjeon/containerbuteo-dasi-salpyeoboneun-kubernetes-pod-dongjag-weonri?slide=29</a></li>\n</ul>\n<p>네임스페이스와 컨테이너, 네트워크까지 잘 정리된 링크</p>\n<ul>\n<li><a href=\"https://www.44bits.io/ko/keyword/linux-namespace\">https://www.44bits.io/ko/keyword/linux-namespace</a></li>\n</ul>\n<h4 id=\"docker의-위기\" style=\"position:relative;\"><a href=\"#docker%EC%9D%98-%EC%9C%84%EA%B8%B0\" aria-label=\"docker의 위기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker의 위기?</h4>\n<ul>\n<li>\n<p>container is light-weight and portable more than virtual machine image</p>\n</li>\n<li>\n<p>but it can same work that PC's work</p>\n</li>\n<li>\n<p>Can exist more than light-weight task from docker?</p>\n</li>\n<li>\n<p>OCI(Open Container Initiative)</p>\n</li>\n<li>\n<p>Container Runtime</p>\n</li>\n<li>\n<p>Image Download -> Extract Image -> Execute Container</p>\n</li>\n<li>\n<p>Container has cgroups, namespace, networking</p>\n</li>\n<li>\n<p>alternative to Buildah, skopeo, podman</p>\n<ul>\n<li>docker is one big process. It can make single point of failure.</li>\n<li>divide docker position by 3.</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"dockerfile\" style=\"position:relative;\"><a href=\"#dockerfile\" aria-label=\"dockerfile permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dockerfile</h4>\n<ul>\n<li>바이너리를 도커파일에서 받을 때 체크섬을 검증하는 내용을 적으면 이미지의 신뢰성이 올라간다</li>\n<li>루트 대신 사용자 추가하는 내용을 디폴트로 한다\n<ul>\n<li><code class=\"language-text\">RUN useradd sam</code></li>\n<li><code class=\"language-text\">USER sam</code></li>\n<li>간단하다</li>\n</ul>\n</li>\n<li>docker.sock은 호스트의 도커 컨테이너 관리를 장악할 수 있다</li>\n<li>dockerfile에 locale, time 등 설정 해두는게 좋지 않을까</li>\n</ul>\n<h4 id=\"docker-compose에서-빌드-단계의-이미지를-쓸-수-있을까\" style=\"position:relative;\"><a href=\"#docker-compose%EC%97%90%EC%84%9C-%EB%B9%8C%EB%93%9C-%EB%8B%A8%EA%B3%84%EC%9D%98-%EC%9D%B4%EB%AF%B8%EC%A7%80%EB%A5%BC-%EC%93%B8-%EC%88%98-%EC%9E%88%EC%9D%84%EA%B9%8C\" aria-label=\"docker compose에서 빌드 단계의 이미지를 쓸 수 있을까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker compose에서 빌드 단계의 이미지를 쓸 수 있을까</h4>\n<p>Dockerfile은 멀티 빌드로 해놓고 배포시에는 마지막 빌드 이미지를 쓰지만\n개발 시에는 빌드한 것으로 쓰고 싶은데</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">build\n  context: ./\n  target: build</code></pre></div>\n<p>build에 target으로 이름 맞춰주면 된다.</p>\n<h4 id=\"docker-compose를-이용해-이미지를-바로-배포하는-것과-dockerfile을-쓰는-것\" style=\"position:relative;\"><a href=\"#docker-compose%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4-%EC%9D%B4%EB%AF%B8%EC%A7%80%EB%A5%BC-%EB%B0%94%EB%A1%9C-%EB%B0%B0%ED%8F%AC%ED%95%98%EB%8A%94-%EA%B2%83%EA%B3%BC-dockerfile%EC%9D%84-%EC%93%B0%EB%8A%94-%EA%B2%83\" aria-label=\"docker compose를 이용해 이미지를 바로 배포하는 것과 dockerfile을 쓰는 것 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker-compose를 이용해 이미지를 바로 배포하는 것과 Dockerfile을 쓰는 것</h4>\n<p>dockerfile 없이 이미지로만 할 때의 문제점?</p>\n<ul>\n<li>어떤 것을 바꿨는지 추적하기 힘들다</li>\n<li>설치파일들 찾기 힘들다</li>\n<li>docker layer와 image size를 줄일수록 배포가 빨라지는 도커의 장점을 이용못한다.</li>\n</ul>\n<p>dockerfile로 하면 쿠버네티스 사용 시 이미지 빌드를 또 해줘야 하잖아?\n이미지로 올리는 경우는 왜 이미지로 올리는거지?</p>\n<p>볼륨을 해도 커밋 시 볼륨된 내용은 적용 안되고, 기존 이미지가 갖고 있던대로 된다</p>\n<p>dockerfile에서 copy를 한 폴더를 외부에서 수정 후 내부에 들어가면 수정되어 있나?</p>\n<ul>\n<li>No</li>\n</ul>\n<p>build - docker file to image\ndocker-compose up 을 하면 이미지를 새로 부른다? volume</p>\n<p>dockerfile -> image -> pods\nbuild -> push -> kubernetes apply(set image)</p>\n<p>개발환경에서는 볼륨을 해서 compose로 개발하고\n배포 시에는 Dockerfile을 이미지화해서 배포한다\n개발디렉토리는 Dockerfile에도 COPY에 있어야하고, compose에도 볼륨을 한다.\n개발환경에서 쓰는 이미지는 배포 시 쓰는 이미지와 같은 것을 사용한다.\n이미지 빌드는 CD pipeline을 통해서 한다. 이미지 혼동을 막기 위해</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 이미지를 기반으로 작업을 하면 이미지가 업데이트 되었는데 이전 버전으로\n작업하던 사람들은?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 최초 작업 시 이미지가 없어서 compose를 실행 못시키니, 빌드 파이프라인을 먼저 만든다?</li>\n</ul>\n<p>내가 원하는게 디렉토리 전체를 덮어쓰는게 아니라 일부만 수정하는 거라서 좀 꼬였다</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 일일이 COPY를 해야 하나? compose에서는 어떻게?</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Dockerfile\nCOPY /app /app\n\n---\n\ndocker-compose.yml\nvolume: /app:/app</code></pre></div>\n<p>app 폴더의 내용을 수정 후 docker build나 compose up을 하면 동일한 상태가 된다.</p>\n<p>서버 설치: vagrant up (git pull -> [docker-compose up or kubectl apply])\n서버 수정: git pull -> docker-compose up -> 수정 -> 테스트 -> git push -> 서버 적용</p>\n<p>서버 개발: git pull -> docker-compose up -> 수정 -> 테스트 -> git push\n서버 업데이트: git pull -> docker-compose up</p>\n<p>실서버에서도 볼륨으로 돌릴까? 순수 이미지로만 돌릴까?\n실서버에서도 수정을 하고 싶은데 다른 회사들은 어떻게 하지? 실서버는 안건드리는게\n좋으려나?\n그러면 compose.yml을 두개를 만들어야 하나\n실서버에서도 그냥 볼륨을 하면 어떨까?</p>\n<p>실서버에서 수정을 하는게 편하지만 절대로 하면 안된다고 권고한다\n번거롭더라도 재빌드 재배포를 하라고 한다\n그렇다면 핫픽스를 최대한 빨리 배포할 수 있도록 해야 하는데\n쿠버네티스에는 명령어 하나로 되돌릴 수 있다\n깃헙 액션으로 바로 되돌릴 수 있어야 한다\n핫픽스 or 롤백</p>\n<p>배포는 ansible로 github action 하면 되겠다\n근데 ansible로 하면 서버 private key가 필요한게 번거롭다\n그렇다고 vault서버에서 가져오는 것도 private key를 관리해야되서 번거롭다\n보안은 번거롭지만 해야되긴 한다</p>\n<h4 id=\"배포-뼈대-만들기\" style=\"position:relative;\"><a href=\"#%EB%B0%B0%ED%8F%AC-%EB%BC%88%EB%8C%80-%EB%A7%8C%EB%93%A4%EA%B8%B0\" aria-label=\"배포 뼈대 만들기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배포 뼈대 만들기</h4>\n<p>kubernetes 버전\ndocker image 버전</p>\n<p>최소 docker image로 빌드하고, 여유가 있으면 kubernetes를 이용\nCI로 간단 검증\nCD는 ansible 또는 argoCD\n핫픽스룰을 따로 만들어 둔다.\npush를 하면 검증을 한다</p>\n<ol>\n<li>commit, 2. merge, 3. hotfix</li>\n</ol>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 빌드 요청은 어떻게?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 버저닝은 어떻게?</li>\n</ul>\n<h4 id=\"docker-image\" style=\"position:relative;\"><a href=\"#docker-image\" aria-label=\"docker image permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker image</h4>\n<p>alpine, stretch, slim, buster\nbuster, stretch는 debian용\nalpine은 alpine linux로 만든 것\nslim은 그 이미지를 실행하기 위한 최소한의 설치파일만 있는 것</p>\n<p>근데 slim보다 alpine이 더 이미지 크기는 작다?</p>\n<h4 id=\"docker-compose-execute-bash\" style=\"position:relative;\"><a href=\"#docker-compose-execute-bash\" aria-label=\"docker compose execute bash permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker compose execute bash</h4>\n<ul>\n<li><code class=\"language-text\">entrypoint: /bin/bash</code> failed</li>\n<li><code class=\"language-text\">tty:true; stdin_open:true</code> success</li>\n<li><code class=\"language-text\">docker-compose run app bash</code> success</li>\n</ul>\n<h4 id=\"docker-cmd-vs-entrypoint\" style=\"position:relative;\"><a href=\"#docker-cmd-vs-entrypoint\" aria-label=\"docker cmd vs entrypoint permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker cmd vs entrypoint</h4>\n<p>커맨드 툴을 도커명령어에서 바로 실행하려고 하면\nCMD로 하면 안되고 ENTRYPOINT로 하면 된다\n<code class=\"language-text\">docker run hanspell-cli -h</code></p>\n<p>대신 ENTRYPOINT를 쓰면 -it /bin/sh 는 인식을 못한다</p>\n<h4 id=\"docker-간-통신\" style=\"position:relative;\"><a href=\"#docker-%EA%B0%84-%ED%86%B5%EC%8B%A0\" aria-label=\"docker 간 통신 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker 간 통신</h4>\n<ul>\n<li>compose 에서 네트워크 명시적으로 설정해줘서 compose에 설정한 이름으로 통신하면 된다고 한다</li>\n<li>--network host 를 써도 된다고 한다</li>\n<li>docker buildx build --network host --platform linux/arm64 -t goodby .</li>\n<li><a href=\"https://marshallku.com/dev/deploy-rust-with-docker\">https://marshallku.com/dev/deploy-rust-with-docker</a></li>\n</ul>\n<h1 id=\"kubernetes\" style=\"position:relative;\"><a href=\"#kubernetes\" aria-label=\"kubernetes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubernetes</h1>\n<p>A person has a very small component, and it composes of one architecture.\nthe kuberetes seem to be this.\nand I want to make software like this architecture.\nstrong small component to flexible architecture.\nkubernetes makes easy to a devops works\nabout deploy, scaling, update, healthcheck, orchestration\nbut devops works is not clear.</p>\n<ul>\n<li><code class=\"language-text\">kubectl run curl --image=radial/busyboxplus:curl -i --tty</code></li>\n<li>pods cluster inside curl pod</li>\n</ul>\n<p>keep focusing only bisuness logic</p>\n<ul>\n<li>\n<ol>\n<li>monitoring - feedback - update logic</li>\n</ol>\n</li>\n<li>\n<ol start=\"2\">\n<li>data management</li>\n</ol>\n</li>\n<li>production deploy behavior make easy\n<ul>\n<li>update and rollback</li>\n<li>scale up and down</li>\n</ul>\n</li>\n</ul>\n<p><a href=\"https://github.com/dennyzhang/cheatsheet-kubernetes-A4/blob/master/README.org\">https://github.com/dennyzhang/cheatsheet-kubernetes-A4/blob/master/README.org</a></p>\n<ul>\n<li>ClusterIP vs NodePort vs Ingress</li>\n<li>service account?</li>\n<li>cluster role?</li>\n<li>cluster? - node</li>\n<li>daemon set?\n<ul>\n<li>it makes every node to make pods</li>\n<li>example: every node can have logstash</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"resource\" style=\"position:relative;\"><a href=\"#resource\" aria-label=\"resource permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>resource</h4>\n<ul>\n<li>pods</li>\n<li>replicaset</li>\n<li>deployment</li>\n<li>service</li>\n</ul>\n<p>컨테이너 리소스</p>\n<ul>\n<li>pod, deployment</li>\n</ul>\n<p>보안 리소스</p>\n<ul>\n<li>rolebinding</li>\n</ul>\n<p>설정 리소스</p>\n<ul>\n<li>configmap</li>\n</ul>\n<h4 id=\"api\" style=\"position:relative;\"><a href=\"#api\" aria-label=\"api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>api</h4>\n<ul>\n<li>master\n<ul>\n<li>kube-apiserver</li>\n<li>kube-scheduler</li>\n<li>kube-controller</li>\n<li>kubelet</li>\n<li>kube-proxy</li>\n<li>etcd</li>\n</ul>\n</li>\n<li>node\n<ul>\n<li>kubelet</li>\n<li>kube-proxy</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"쿠버네티스는-os와-클라우드를-추상화할-수-있나\" style=\"position:relative;\"><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EB%8A%94-os%EC%99%80-%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%EB%A5%BC-%EC%B6%94%EC%83%81%ED%99%94%ED%95%A0-%EC%88%98-%EC%9E%88%EB%82%98\" aria-label=\"쿠버네티스는 os와 클라우드를 추상화할 수 있나 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿠버네티스는 os와 클라우드를 추상화할 수 있나?</h4>\n<p>서비스의 장애가 os에 영향을 미쳐도 서비스를 격리하면 문제가 해결될 수 있나?\n그렇다면 '쿠버네티스', '마이크로서비스', '데이터'가 소프트웨어의 큰 줄기가 될 수 있다\n원래는 인프라, 서비스, 데이터인 것을 쿠버네티스가 인프라를 완전 대체?</p>\n<h4 id=\"kubernetes-volume\" style=\"position:relative;\"><a href=\"#kubernetes-volume\" aria-label=\"kubernetes volume permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubernetes volume</h4>\n<p>특정 노드의 폴더를 사용할 때는 hostPath를 사용할 수 있다.\n근데 노드 상관 없이 폴더를 써야하는 경우가 대부분일 것이다</p>\n<h4 id=\"쿠버네티스-네트워크의-이해\" style=\"position:relative;\"><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%EC%9D%98-%EC%9D%B4%ED%95%B4\" aria-label=\"쿠버네티스 네트워크의 이해 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿠버네티스 네트워크의 이해</h4>\n<p>팟들끼리의 통신은 veth 을 통해서 하게 된다 eth0 -> docker0 -> veth0\n그리고 eth0이 어떤 veth0과 연결되어 있는지 라우팅 테이블이 존재한다\n하지만 팟은 언제든 사라졌다가 다시 생겨날 수 있어서 이를 추상화하는 레이어가 하나 필요하고 이것을 service로 만들었다\n(IP 네트워크는 보통 자신의 host에서 목적지를 찾지 못하면 상위 게이트웨이로 전달하도록 동작)\nservice는 리눅스 커널 기능인 netfilter와 iptables를 이용한다\nkube-proxy라는 녀석도 같이 동작에 관여하는데 얘는 netfilter에 규칙을 수정하는 역할만 하고 실제 동작은 netfilter에서 이루어진다\n클러스터 외부에서 트래픽을 내부로 전달하고 싶다면 로드밸런서를 이용한다\n외부에서 요청이 오면 NodePort를 거쳐서 내부 Node의 ip를 찾게 되고 이것이 다시 netfilter를 거쳐서 팟을 찾을 수 있게 된다\n하지만 NodePort를 확장한 LoadBalancer Service도 제약사항이 있는데 한개의 로드밸런서가 여러 서비스를 연결하지 못한다는 점이다.\n그래서 ingress가 나왔다\ningress는 그래서 한개의 로드밸런서로 여러 서비스를 유연하게 설정할 수 있게 해준다\ningress는 ingress-controller가 동작하게 해야하고, 각 클라우드 플랫폼 마다 ingress-controller 구현체가 있다</p>\n<h4 id=\"deploy\" style=\"position:relative;\"><a href=\"#deploy\" aria-label=\"deploy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>deploy</h4>\n<ul>\n<li>배포와 릴리즈를 분리\n쿠버네티스에 apply를 해도 실제 서버에 바로 적용되는게 아니라 서비스 메시에서\n릴리즈를 관리 -> istio를 이용</li>\n<li>서비스 키고 시간이 지나면 api 접속이 안됨</li>\n<li>istio, monitoring, argocd 켜놨는데 어디가 리소스 많이 먹는지 알고 싶다</li>\n</ul>\n<h4 id=\"deployment-kill\" style=\"position:relative;\"><a href=\"#deployment-kill\" aria-label=\"deployment kill permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>deployment kill</h4>\n<p>deployment 정지시키려면 scale --replicas=0 으로 해야되나보다</p>\n<ul>\n<li>pod을 삭제하는 건 kill로 한다</li>\n</ul>\n<h4 id=\"kubernetes-test\" style=\"position:relative;\"><a href=\"#kubernetes-test\" aria-label=\"kubernetes test permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubernetes test</h4>\n<ul>\n<li>local test, production build pipeline</li>\n<li>local test with only dockerfile</li>\n<li>local test with same with production</li>\n<li>In msa. need kubernetes?</li>\n<li>In msa. github repo is seperated?</li>\n<li>developer can build docker image?</li>\n<li>how to provide docker image to developer?</li>\n<li>when developer push updated source. pipeline is\n<ul>\n<li>kubernetes apply?</li>\n</ul>\n</li>\n<li>build with tags?\n<ul>\n<li>git tag 1.0.0</li>\n<li>git push origin --tags</li>\n</ul>\n</li>\n<li>hpa</li>\n<li>service</li>\n<li>minikube</li>\n</ul>\n<h4 id=\"쿠버네티스-클러스터-중에-마스터가-자원을-많이-쓰나-노드가-많이쓰나\" style=\"position:relative;\"><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%A4%91%EC%97%90-%EB%A7%88%EC%8A%A4%ED%84%B0%EA%B0%80-%EC%9E%90%EC%9B%90%EC%9D%84-%EB%A7%8E%EC%9D%B4-%EC%93%B0%EB%82%98-%EB%85%B8%EB%93%9C%EA%B0%80-%EB%A7%8E%EC%9D%B4%EC%93%B0%EB%82%98\" aria-label=\"쿠버네티스 클러스터 중에 마스터가 자원을 많이 쓰나 노드가 많이쓰나 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿠버네티스 클러스터 중에 마스터가 자원을 많이 쓰나, 노드가 많이쓰나?</h4>\n<p>master</p>\n<ul>\n<li>api server, etcd 등 기본적으로 자원을 많이 사용한다.</li>\n</ul>\n<p>서비스가 빡세게 돌면 노드가 많이쓰나?</p>\n<p>쿠버네티스 로그 서비스 추가해서\n노드 하나를 일부러 끄면 로그 잘 남는지 확인하고\n죽은 서버를 살릴 수 있을지 확인</p>\n<p>ram 1기가 서버에 ram 0.5를 쓰는 서비스를 6개를 레플리카하면 동작하나?</p>\n<ul>\n<li>자원 한도 넘어가면 파드를 안 만든다.</li>\n</ul>\n<p>글러스터fs 와 db 레플리케이션을\n쿠버네티스에서 편하게 할 수 있는 방법이 있나?</p>\n<p>클러스터를 한번씩 껐다 켜서 리프레시 했을때 안좋은점이 있을까?\n없다면 접속자 적은 시간을 뽑아서 한 서버씩 재부팅 해줘야겠다\n페일오버 테스트도 되고, os도 리프레시 되지 않을까</p>\n<p>걱정되는 점은 한쪽 노드에 팟들이 몰려있다가 다시 돌아갈 때 과부하 걸리지 않을지</p>\n<h4 id=\"쿠버네티스는-어떻게-복잡성을-관리하는가\" style=\"position:relative;\"><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%B3%B5%EC%9E%A1%EC%84%B1%EC%9D%84-%EA%B4%80%EB%A6%AC%ED%95%98%EB%8A%94%EA%B0%80\" aria-label=\"쿠버네티스는 어떻게 복잡성을 관리하는가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿠버네티스는 어떻게 복잡성을 관리하는가</h4>\n<ul>\n<li>ingress -> service -> deployment 식의 계층적 추상화</li>\n<li>namespace 격리</li>\n<li>controller pattern - 이건 좀 더 찾아보자\n<ul>\n<li>각 리소스별 전용 컨트롤러가 상태 관리</li>\n<li>단일 책임 원칙으로 복잡성 분산</li>\n<li>Reconciliation Loop로 일관된 동작 보장</li>\n</ul>\n</li>\n<li>Operator pattern\n<ul>\n<li>도메인 특화 로직을 CRD로 추상화</li>\n<li>인간의 운영 지식을 코드로 전환</li>\n</ul>\n</li>\n<li>그치만 쿠버네티스도 한계가 있다\n<ul>\n<li>노드 수 제한도 있고</li>\n<li>API 서버가 초당 수천개 요청에서 성능 저하하는 처리량 한계도 있다</li>\n<li>컨트롤 플레인은 사용량이 선형적으로 증가할 수 밖에 없다</li>\n</ul>\n</li>\n<li>또한 복잡성의 새로운 차원이 있다\n<ul>\n<li>네트워킹 오버헤드 (CNI 성능 이슈)</li>\n<li>스토리지 관리 복잡성 증가</li>\n<li>보안 정책의 기하급수적 복잡성</li>\n<li>디버깅과 트러블슈팅의 어려움</li>\n</ul>\n</li>\n<li>그래서 클러스터를 분리해야한다\n<ul>\n<li>팀별 / 환경별</li>\n<li>그러면 분리된 클러스터도 관리를 쉽게 할 수 있어야 한다</li>\n<li>하나의 클러스터로 다 하려고 하는건 확장적이지 못하다</li>\n</ul>\n</li>\n<li>하나의 클러스터를 잘 관리할 수 있으면 멀티 클러스터도 관리할 수 있다</li>\n</ul>\n<h4 id=\"쿠버네티스-멀티-클러스터-그-이후\" style=\"position:relative;\"><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%A9%80%ED%8B%B0-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EA%B7%B8-%EC%9D%B4%ED%9B%84\" aria-label=\"쿠버네티스 멀티 클러스터 그 이후 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿠버네티스 멀티 클러스터 그 이후</h4>\n<ul>\n<li>클러스터간 관리를 하는 중앙 관리가 필요할 것 같다</li>\n<li>중앙 클러스터가 있고</li>\n<li>도메인별 클러스터를 따로 만든다</li>\n<li>도메인별 클러스터에는 최대한 공용 인프라를 안쓰고</li>\n<li>중앙 클러스터에서 관리할 수 있도록 한다</li>\n</ul>\n<h4 id=\"docker-kubernetes-istio\" style=\"position:relative;\"><a href=\"#docker-kubernetes-istio\" aria-label=\"docker kubernetes istio permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker kubernetes istio</h4>\n<table>\n<thead>\n<tr>\n<th>docker</th>\n<th>kubernetes</th>\n<th>istio</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>이식성</td>\n<td>배포 (단일 배포점, 롤링 업데이트)</td>\n<td>서비스 메시</td>\n</tr>\n<tr>\n<td>고립성</td>\n<td>로드 밸런싱</td>\n<td>어플리케이션 api 마다 프록시</td>\n</tr>\n<tr>\n<td>가벼움</td>\n<td>서비스 디스커버리</td>\n<td>서킷 브레이킹</td>\n</tr>\n<tr>\n<td>헬스체크</td>\n<td>스케일링</td>\n<td>카오스 테스트</td>\n</tr>\n<tr>\n<td>페일오버</td>\n<td>고가용성 확보(3 node)</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>확장 시 서버 셋팅 자동화</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<p>롤백, 자원관리, 모니터링, 시크릿 관리</p>\n<h2 id=\"network-resource\" style=\"position:relative;\"><a href=\"#network-resource\" aria-label=\"network resource permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Network Resource</h2>\n<h4 id=\"nginx-vs-istio\" style=\"position:relative;\"><a href=\"#nginx-vs-istio\" aria-label=\"nginx vs istio permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>nginx vs istio</h4>\n<ul>\n<li>service -> Ingress</li>\n<li>istio Gateway -> Virtual Service -> Destination Rule</li>\n</ul>\n<p>트래픽을 한 곳에서 다 처리하느냐, 각 서비스마다 분리해서 처리하느냐가 큰 차이\n사이드카가 많아져서 생기는 중복 오버헤드가 많을까, 비대해진 하나의 객체가\n오버헤드가 많을까\n내부에 직접 통신하면서 트래픽을 제어할 수 있는 것은 장점\napi gateway의 상위호환이 되려고 한다</p>\n<p>istio</p>\n<ul>\n<li>트래픽 모니터링 가능</li>\n<li>트래픽을 제어할 수 있다</li>\n<li>각 서비스마다 분리되어 있어서 단일 고장점이 아니다.</li>\n<li>retry 및 timeout 동작</li>\n</ul>\n<p>nginx(api gateway)</p>\n<ul>\n<li>단일 객체</li>\n<li>트래픽 제어</li>\n</ul>\n<h4 id=\"nginx-canary\" style=\"position:relative;\"><a href=\"#nginx-canary\" aria-label=\"nginx canary permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>nginx canary</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">metadata:\n  annotations:\n    nginx.ingress.kubernetes.io/canary: \"true\"\n    nginx.ingress.kubernetes.io/canary-weight: \"20\"</code></pre></div>\n<h4 id=\"kubernetes-supports-cluster\" style=\"position:relative;\"><a href=\"#kubernetes-supports-cluster\" aria-label=\"kubernetes supports cluster permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubernetes supports cluster</h4>\n<ul>\n<li>&#x3C; 5000 nodes</li>\n<li>&#x3C; 150000 pods</li>\n<li>&#x3C; 300000 containers</li>\n<li>&#x3C; 100 pods per node</li>\n</ul>\n<h4 id=\"kubernetes-access-remote-cluster\" style=\"position:relative;\"><a href=\"#kubernetes-access-remote-cluster\" aria-label=\"kubernetes access remote cluster permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubernetes access remote cluster</h4>\n<p><code class=\"language-text\">scp &lt;user>@&lt;ip>:/home/vagrant/.kube/config ~/.kube/config</code></p>\n<h4 id=\"kubernetes-dns\" style=\"position:relative;\"><a href=\"#kubernetes-dns\" aria-label=\"kubernetes dns permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubernetes dns</h4>\n<p>kube-dns\ncoredns 1.12 버전부터 사용, 호환성을 위해 라벨링은 kube-dns로 되있다</p>\n<p><code class=\"language-text\">myapplication.namespace.svc.cluster.local</code> 형식으로 되있다</p>\n<ul>\n<li><a href=\"https://jonnung.dev/kubernetes/2020/05/11/kubernetes-dns-about-coredns/\">https://jonnung.dev/kubernetes/2020/05/11/kubernetes-dns-about-coredns/</a></li>\n</ul>\n<h2 id=\"test\" style=\"position:relative;\"><a href=\"#test\" aria-label=\"test permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test</h2>\n<h4 id=\"test-1\" style=\"position:relative;\"><a href=\"#test-1\" aria-label=\"test 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>test</h4>\n<ul>\n<li>how to test account system?\n<ul>\n<li>check send complete</li>\n<li>check response code</li>\n</ul>\n</li>\n<li>stress test per process\n<ul>\n<li><code class=\"language-text\">while true; do curl http://localhost; done</code></li>\n<li>hpa\n<ul>\n<li>when do switching, connection is waiting?</li>\n</ul>\n</li>\n<li>how to destroy one pod</li>\n<li>recovery time in replicaset</li>\n</ul>\n</li>\n<li>image to rollup, rollback</li>\n<li>ci/cd</li>\n</ul>\n<p>Spinnaker - build tool\nEnvoy - proxy, c/b, network tool</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> image size is matter for performance?</li>\n</ul>\n<ol>\n<li>build image\n<ul>\n<li><code class=\"language-text\">docker build shdkej/imagename:tag .</code></li>\n<li><code class=\"language-text\">docker login</code></li>\n<li><code class=\"language-text\">docker push shdkej/imagename:tag</code></li>\n</ul>\n</li>\n<li>deployment, service\n<ul>\n<li><code class=\"language-text\">kubectl apply -f file.yml</code></li>\n</ul>\n</li>\n<li>test\n<ul>\n<li><code class=\"language-text\">kubectl run -it curl --image=radial/busyboxplus:curl </code></li>\n<li><code class=\"language-text\">curl http://deploy-name:port</code></li>\n</ul>\n</li>\n<li>port forward\n<ul>\n<li><code class=\"language-text\">kubectl port-forward svc/svc-name 8080:8080</code></li>\n</ul>\n</li>\n<li>client run</li>\n<li>check some signal</li>\n<li>report how many success is</li>\n</ol>\n<p>case 1. normal string output check - 100000 user\n- for 10000 -> 24s\n- for 100000 -> 1m30s\n- goroutine 100000\n- server can't accept\ncase 2. stream output check</p>\n<p>파드하나에 접속량을 몰아서 뻣는 경우 테스트\n노드 하나에 몰아서 테스트\n전체에 영향가게 테스트\napi서버가 어떻게 부하를 받는지 확인</p>\n<h2 id=\"plugin\" style=\"position:relative;\"><a href=\"#plugin\" aria-label=\"plugin permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Plugin</h2>\n<h4 id=\"helm-k3s-kubernetes-cluster-unreachable-error\" style=\"position:relative;\"><a href=\"#helm-k3s-kubernetes-cluster-unreachable-error\" aria-label=\"helm k3s kubernetes cluster unreachable error permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>helm k3s Kubernetes cluster unreachable error</h4>\n<p>set <code class=\"language-text\">export KUBECONFIG=/etc/rancher/k3s/k3s.yaml</code>\n<a href=\"https://github.com/rancher/k3s/issues/1126\">https://github.com/rancher/k3s/issues/1126</a></p>\n<h4 id=\"eks-vs-ec2-autoscale-and-setting-kubernetes-vs-kubernetes-hpa\" style=\"position:relative;\"><a href=\"#eks-vs-ec2-autoscale-and-setting-kubernetes-vs-kubernetes-hpa\" aria-label=\"eks vs ec2 autoscale and setting kubernetes vs kubernetes hpa permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>eks vs ec2 autoscale and setting kubernetes vs kubernetes hpa</h4>\n<h4 id=\"container-serverless\" style=\"position:relative;\"><a href=\"#container-serverless\" aria-label=\"container serverless permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>container serverless</h4>\n<ul>\n<li>knative, lstio, open-faas</li>\n</ul>\n<h4 id=\"k3s\" style=\"position:relative;\"><a href=\"#k3s\" aria-label=\"k3s permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>k3s</h4>\n<ul>\n<li>token <code class=\"language-text\">/var/lib/rancher/k3s/server/node-token</code></li>\n<li>join\n<ul>\n<li><code class=\"language-text\">curl -sfL http://get.k3s.io | K3S_URL=https://192.168.0.50:6443 \\ K3S_TOKEN=join_token_we_copied_earlier sh -</code></li>\n</ul>\n</li>\n<li>connect remotly\n<ul>\n<li><code class=\"language-text\">scp root@ip:/etc/rancher/k3s/k3s.yaml ~/.kube/config</code></li>\n<li>replace 127.0.0.1 -> remote ip</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"k3s-monitoring\" style=\"position:relative;\"><a href=\"#k3s-monitoring\" aria-label=\"k3s monitoring permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>k3s monitoring</h4>\n<ul>\n<li><code class=\"language-text\">kubectl apply -k github.com/premist/k3s-kube-prometheus/setup</code></li>\n<li><code class=\"language-text\">kubectl apply -k github.com/premist/k3s-kube-prometheus</code></li>\n</ul>\n<h4 id=\"k3s-helm\" style=\"position:relative;\"><a href=\"#k3s-helm\" aria-label=\"k3s helm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>k3s helm</h4>\n<p>! Kubernetes cluster unreachable</p>\n<ul>\n<li><code class=\"language-text\">export KUBECONFIG=/etc/rancher/k3s/k3s.yaml</code></li>\n<li>or <code class=\"language-text\">kubectl config view --raw >~/.kube/config</code></li>\n</ul>\n<h4 id=\"k3s-connect-remotely-to-the-cluster\" style=\"position:relative;\"><a href=\"#k3s-connect-remotely-to-the-cluster\" aria-label=\"k3s connect remotely to the cluster permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>k3s connect remotely to the cluster</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mkdir ~/.kube\nscp &lt;user@ip>:/etc/rancher/k3s/k3s.yaml ~/.kube/config\nsed -i '' 's/127\\.0\\.0\\.1/192\\.168\\.0\\.22/g' ~/.kube/config</code></pre></div>\n<h4 id=\"helm\" style=\"position:relative;\"><a href=\"#helm\" aria-label=\"helm permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>helm</h4>\n<p>chart.yml\nvalue.yml\ntemplates/\ncharts/</p>\n<p>install <code class=\"language-text\">helm install &lt;name> &lt;chart></code>\n상태 보기 <code class=\"language-text\">helm status &lt;name></code>\n업그레이드 <code class=\"language-text\">helm upgrade -f &lt;value.yml> &lt;name> &lt;folder></code>\n지우기 <code class=\"language-text\">helm del &lt;name></code></p>\n<h4 id=\"helm-install-from-local\" style=\"position:relative;\"><a href=\"#helm-install-from-local\" aria-label=\"helm install from local permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>helm install from local</h4>\n<p><code class=\"language-text\">helm install &lt;name> &lt;directory> --values &lt;values.yaml></code>\nor just setting key\n<code class=\"language-text\">helm install &lt;name> &lt;directory> --set &lt;key=value,key2=value2></code></p>\n<h4 id=\"turn-on-and-access-to-grafana-in-kubernetes-nodes\" style=\"position:relative;\"><a href=\"#turn-on-and-access-to-grafana-in-kubernetes-nodes\" aria-label=\"turn on and access to grafana in kubernetes nodes permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>turn on and access to grafana in kubernetes nodes</h4>\n<ul>\n<li>build kubernetes setup -- vagrant</li>\n<li>access nginx from just node\n<ul>\n<li><code class=\"language-text\">kubectl create deployment --image nginx my-nginx</code></li>\n<li><code class=\"language-text\">kubectl expose deployment my-nginx --port=80 --type=LoadBalancer</code></li>\n</ul>\n</li>\n<li>access from master node</li>\n<li>deploy grafana</li>\n<li>add kubernetes monitoring script</li>\n</ul>\n<h4 id=\"kubernetes-load-balancer\" style=\"position:relative;\"><a href=\"#kubernetes-load-balancer\" aria-label=\"kubernetes load balancer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubernetes load balancer</h4>\n<p>metallb</p>\n<h4 id=\"kubernetes-network-service-test\" style=\"position:relative;\"><a href=\"#kubernetes-network-service-test\" aria-label=\"kubernetes network service test permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubernetes network service test</h4>\n<p>istio\nconsul\nload balancer</p>\n<h4 id=\"kubernetes-tool\" style=\"position:relative;\"><a href=\"#kubernetes-tool\" aria-label=\"kubernetes tool permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubernetes tool</h4>\n<p>chaos-mesh\nspinnaker\nknative</p>\n<h4 id=\"deploy-1\" style=\"position:relative;\"><a href=\"#deploy-1\" aria-label=\"deploy 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>deploy</h4>\n<p>deploy spinnaker</p>\n<p>kubernetes는 github에서 돌아가야 한다. 근데 로컬에서도 똑같이 할 수 있어야 한다\ngithub action에 종속되지 않고 CI를 하려면 스크립트를 호출하는 방식으로 해야하나\ngithub action server와 비슷한 서버를 만들어서 에러 시 리다이렉트 해야하나\njenkins는 자체 서버를 돌리니까 이를 이용해야 하나</p>\n<h4 id=\"인프라-관련-툴과-서비스-관련-툴을-분리하면-좋을-것-같다\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%ED%94%84%EB%9D%BC-%EA%B4%80%EB%A0%A8-%ED%88%B4%EA%B3%BC-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B4%80%EB%A0%A8-%ED%88%B4%EC%9D%84-%EB%B6%84%EB%A6%AC%ED%95%98%EB%A9%B4-%EC%A2%8B%EC%9D%84-%EA%B2%83-%EA%B0%99%EB%8B%A4\" aria-label=\"인프라 관련 툴과 서비스 관련 툴을 분리하면 좋을 것 같다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인프라 관련 툴과 서비스 관련 툴을 분리하면 좋을 것 같다</h4>\n<ul>\n<li>모니터링, 로깅,</li>\n<li>보안, 리버스 프록시</li>\n<li>실제 로직 구동 앱</li>\n<li>미들웨어(카프카)</li>\n</ul>\n<h4 id=\"쿠버네티스-네임스페이스를-어떻게-분리할까\" style=\"position:relative;\"><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%84%A4%EC%9E%84%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4%EB%A5%BC-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%B6%84%EB%A6%AC%ED%95%A0%EA%B9%8C\" aria-label=\"쿠버네티스 네임스페이스를 어떻게 분리할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>쿠버네티스 네임스페이스를 어떻게 분리할까</h4>\n<p>지금 istio, argocd, monitoring으로 나눠져있는데\n그러면 monitoring에서 다른 네임스페이스를 참조할 수 있나?</p>\n<p>production 과 development로 나누면 똑같은 파일로 두번 apply하면 되나?</p>\n<h4 id=\"kubernetes-local-image-사용하기\" style=\"position:relative;\"><a href=\"#kubernetes-local-image-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"kubernetes local image 사용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubernetes local image 사용하기</h4>\n<ul>\n<li><code class=\"language-text\">image</code> 밑에 <code class=\"language-text\">imagePullPolicy</code>를 <code class=\"language-text\">Never</code>로 설정한다</li>\n<li>minikube 사용 시 <code class=\"language-text\">eval $(minikube -p minikube docker-env)</code> 입력</li>\n<li>docker image를 새로 빌드해야한다.</li>\n</ul>\n<h4 id=\"rbac\" style=\"position:relative;\"><a href=\"#rbac\" aria-label=\"rbac permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>RBAC</h4>\n<p>role-based access control\nmatching user - role</p>\n<ul>\n<li>ServiceAccount</li>\n<li>Role</li>\n<li>RoleBinding</li>\n<li>ClusterRole</li>\n<li>ClusterRoleBinding</li>\n</ul>\n<p>Role과 ClusterRole의 차이</p>\n<ul>\n<li>Role은 네임스페이스 하나에만 할당되고 ClusterRole은 여러개가 되며, 허용범위가\n넓다.</li>\n<li>Cluster라 함은 Master와 Node의 범위다.</li>\n</ul>\n<p>service account 생성</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kind: ServiceAccount\nmetadata:\n  name: developer1\n  namespace: team1</code></pre></div>\n<p>허용할 api와 리소스, 명령어를 지정해준다</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kind: Role\nmetadata:\n  ...\nrules:\n- apiGroups: ['', 'apps']\n  resources: ['pods', 'deployment']\n  verbs: ['get', 'list']</code></pre></div>\n<p>롤 바인딩 파일에서 서비스 어카운트와 롤을 매칭해준다</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kind: RoleBinding\nmetadata:\n  ...\nsubjects:\n- kind: ServiceAccount\n  name: developer1\n  apiGroup: \"\"\nroleRef:\n  kind: Role\n  name: role-dev\n  apiGroup: rbac.authorization.k8s.io</code></pre></div>\n<h4 id=\"argocd\" style=\"position:relative;\"><a href=\"#argocd\" aria-label=\"argocd permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>argocd</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># kubernetes에 argocd 올리기\nkubectl create namespace argocd\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml\nkubectl patch svc argocd-server -n argocd -p '{\"spec\": {\"type\": \"LoadBalancer\"}}'\n## port 확인하거나 port-forward 해서 접속 가능\n\n\n# 로그인이나 클라이언트 명령 처리 시 클라이언트 툴 설치\nVERSION=$(curl --silent \"https://api.github.com/repos/argoproj/argo-cd/releases/latest\" | grep '\"tag_name\"' | sed -E 's/.*\"([^\"]+)\".*/\\1/')\ncurl -sSL -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64\nchmod +x /usr/local/bin/argocd\n\n# 로그인 후 비밀번호 변경 (기본값은 파드 이름)\nexport ARGOCD_PASSWORD=`kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2`\nargocd login &lt;ARGOCD_SERVER>\nargocd account update-password</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">echo \"test1\"\necho \"test2\"\necho \"test3\"</code></pre></div>\n<p>argocd 에서 helm 이용하기 <code class=\"language-text\">argocd app set &lt;name> --values &lt;value.yml></code></p>\n<h4 id=\"kubernetes-monitoring\" style=\"position:relative;\"><a href=\"#kubernetes-monitoring\" aria-label=\"kubernetes monitoring permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubernetes monitoring</h4>\n<p><a href=\"https://gruuuuu.github.io/cloud/monitoring-02/#\">https://gruuuuu.github.io/cloud/monitoring-02/#</a></p>\n<ol>\n<li>cluster role</li>\n<li>configmap</li>\n<li>prometheus deployment</li>\n<li>node exporter daemonset &#x26; service</li>\n<li>prometheus service</li>\n</ol>\n<p>configmap... 필요한건가</p>\n<h4 id=\"istio\" style=\"position:relative;\"><a href=\"#istio\" aria-label=\"istio permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>istio</h4>\n<p>하나의 팟 관리를 위해 각 팟마다 관리용 팟을 생성하는 사이드카 패턴을 이용해서 각 서비스를 관리\n관리용 팟이 들어오고 나가는 네트워크를 모두 처리함으로써 로깅, 모니터링,\n디스커버리 모두 가능해진다</p>\n<ul>\n<li>리소스 사용이 2배가 되겠네?\n<ul>\n<li>경량 프록시라서 리소스가 2배는 아니다</li>\n</ul>\n</li>\n<li>envoy를 이용해 프록시를 한다</li>\n<li>파일럿을 통해 디스커버리, 로드밸런싱</li>\n<li>시타델을 이용해 인증서, 키 관리</li>\n</ul>\n<p>서비스 메시가 있으면 서비스는 통신에 신경 쓸 필요가 없나?</p>\n<ul>\n<li>통신은 메시지로 하고, 서비스 통신의 프록시를 해준다</li>\n</ul>\n<p>istio 자체의 gateway를 이용해 라우팅 할 수 있다</p>\n<h4 id=\"istio-설치\" style=\"position:relative;\"><a href=\"#istio-%EC%84%A4%EC%B9%98\" aria-label=\"istio 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>istio 설치</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -L https://istio.io/downloadIstio | sh -\ncd istio-1.9.0\nexport PATH=$PWD/bin:$PATH\nistioctl install --set profile=demo -y</code></pre></div>\n<p>side inject enable</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">kubectl label namespace default istio-injection=enabled\nkubectl label namespace istio-system istio-injection=enabled</code></pre></div>\n<p>apply bookinfo\napply bookinfo-gateway\napply grafana, prometheus</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">export INGRESS_HOST=$(minikube ip)\nexport INGRESS_PORT=$(kubectl get svc istio-ingressgateway -n istio-system \\\n                    -o jsonpath='{.spec.ports[?(@.name==\"http2\")].nodePort}')\nexport GATEWAY_URL=$INGRESS_HOST:$INGRESS_PORT</code></pre></div>\n<ul>\n<li>bookinfo 가 과부하를 일으킨다</li>\n</ul>\n<h4 id=\"istio-routing--tag-tagtag-값-적용시키기\" style=\"position:relative;\"><a href=\"#istio-routing--tag-tagtag-%EA%B0%92-%EC%A0%81%EC%9A%A9%EC%8B%9C%ED%82%A4%EA%B8%B0\" aria-label=\"istio routing  tag tagtag 값 적용시키기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>istio routing /, /tag, /tag/:tag 값 적용시키기</h4>\n<ul>\n<li>httpbin 이라는 서비스로 istio가 예제를 제공해주고 있다.</li>\n<li>이걸로 테스트하니까 match로 지정해주지 않아도 하위 url도 다 전달해준다.</li>\n<li>여기에 ingress를 달아주니까 주소기반으로 라우팅도 된다.\n<ul>\n<li>같은 호스트로 인그레스를 달아주니까 두 서비스를 섞어서 라우팅해준다</li>\n</ul>\n</li>\n<li>ingress에서 path를 /header로 지정해주면 /header로 찾아간다\n<ul>\n<li>주소를 /v2로 해놓았을 때 v2라는 주소가 없으면 루트로 찾아가나?\n<ul>\n<li>/, /aaa가 설정되있으면 /ccc를 넣어도 / 가 있어서 /로 인식한다</li>\n</ul>\n</li>\n<li>whoami 서비스는 이상한 주소로 넣어도 다 받아주고, httpbin은 url\n못찾는다는 에러를 준다.</li>\n<li>ingress에서 지정해주는 주소가 루트로 인식하는 줄 알았는데, 그게 아니라\n매칭을 해주는거였다.\n<ul>\n<li>traefik에서는 원하는 주소를 넣을 수 있어서 헷갈렸던 것 같다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>ingress에서 여러 주소를 한 서비스에 넣으려면 콤마(,)로 구분하면 된다</li>\n</ul>\n<h4 id=\"knative-istio\" style=\"position:relative;\"><a href=\"#knative-istio\" aria-label=\"knative istio permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>knative istio</h4>\n<ul>\n<li>before use knative, install istio first.</li>\n</ul>\n<h4 id=\"spinnaker\" style=\"position:relative;\"><a href=\"#spinnaker\" aria-label=\"spinnaker permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>spinnaker</h4>\n<p>spinnaker 설치를 halyard를 통해서 해야 한다</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mkdir -p ~/.hal/kube\ncp ~/.kube/config ~/.hal/kube/config\nchmod 755 ~/.hal/kube/config\n\ndocker run -p 8084:8084 -p 9000:9000 \\\n    --name halyard --rm \\\n    -v ~/.hal:/home/spinnaker/.hal \\\n    -it \\\n    us-docker.pkg.dev/spinnaker-community/docker/halyard:stable\n\ndocker exec -it halyard bash\n\n### initial in container\n$ source &lt;(hal --print-bash-completion)\n$ hal config provider kubernetes enable\n$ hal config provider kubernetes account add &lt;my-account> \\\n    --context $(kubectl config current-context)\n$ hal config features edit --artifacts true\n$ hal config deploy edit --type distributed --acount-name &lt;my-account></code></pre></div>\n<p>set persistent store</p>\n<ul>\n<li>we will use minio, why?</li>\n</ul>\n<p>install minio</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">helm install minio -n spinnaker \\\n    --set accessKey=&lt;access_key> \\\n    --set secretKey=&lt;secret_key> \\\n    stable/minio</code></pre></div>\n<p>spinnaker deploy</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$ hal deploy apply\n! failed check for namespace/spinnaker is null\n> kubectl get pod >> error >> no search file or directory '/home/sh/.minikube/'\n>> cp -r ~/.minikube ~/.hal/\n\n### open access ip\nkubectl edit svc spin-deck -n spinnaker\n# edit ClusterIP to NodePort,\n# add nodePort: 30900\n\nkubectl edit svc spin-gate -n spinnaker\n# edit ClusterIP to NodePort,\n# add nodePort: 30808\n\n$ hal config security ui edit \\\n    --override-base-url \"http://&lt;HOST_IP>:30900\"\n$ hal config security api edit \\\n    --override-base-url \"http://&lt;HOST_IP>:30808\"\n$ hal deploy apply</code></pre></div>\n<p>connect to '&#x3C;HOST_IP>:30900' in browser</p>\n<h4 id=\"kubernetes를-쓰면서-쉽게-실수하는-10가지\" style=\"position:relative;\"><a href=\"#kubernetes%EB%A5%BC-%EC%93%B0%EB%A9%B4%EC%84%9C-%EC%89%BD%EA%B2%8C-%EC%8B%A4%EC%88%98%ED%95%98%EB%8A%94-10%EA%B0%80%EC%A7%80\" aria-label=\"kubernetes를 쓰면서 쉽게 실수하는 10가지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubernetes를 쓰면서 쉽게 실수하는 10가지</h4>\n<ol>\n<li>리소스 설정 (cpu, memory)</li>\n<li>헬스 체크(liveness, readiness)의 차이에 따른 사용</li>\n<li>모든 서비스에 로드밸런서 달아버리는 것</li>\n<li>쿠버네티스가 모르는 자동확장(?)</li>\n<li>권한 관리 부재</li>\n<li>Anti Affinity 설정(pod가 node에 분산해서 실행하지 않으므로 명시적 설정 필요)</li>\n<li>PodDisruptionBudget 설정(pod 최소필요량(minAvailable))</li>\n<li>클러스터 공유(네임스페이스는 환경 분리가 안되므로 차라리 클러스터를 나눠라)</li>\n<li><code class=\"language-text\">externalTrafficPolicy: Cluster</code> 설정은 네트워크 지연을 일으킬 수 있다</li>\n<li>클러스터를 애완동물처럼 다루기 + 마스터에 너무 큰 부하주는 것</li>\n<li>+1. latest tag 사용하는 것</li>\n</ol>\n<ul>\n<li><a href=\"https://coffeewhale.com/kubernetes/mistake/2020/11/29/mistake-10/\">https://coffeewhale.com/kubernetes/mistake/2020/11/29/mistake-10/</a></li>\n</ul>\n<h4 id=\"kubernetes-in-vcnc\" style=\"position:relative;\"><a href=\"#kubernetes-in-vcnc\" aria-label=\"kubernetes in vcnc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubernetes in VCNC</h4>\n<p>상용 kubernetes를 위한 추가 도구</p>\n<p>ingress - ingress controller</p>\n<ul>\n<li>nginx vs aws nlb</li>\n<li>Class ELB는 동시에 많은 연결을 처리하려면 웜업이 필요하다</li>\n<li>nlb는 gRPC를 지원하지 않는다.</li>\n<li>트래픽 흐름: NLB - NodePort - NGINX ingress controller - service\n<ul>\n<li>외부 로드밸런서를 추가하는 것이 클러스터 오토스케일러를 추가하는 것처럼\n불가피한 것일까</li>\n</ul>\n</li>\n</ul>\n<p>AWS IAM을 사용하기 위해 kube2iam 사용 (19년 03월) -> EKS에서는 지원될 듯</p>\n<p>로그</p>\n<ul>\n<li>fluentd를 daemonset으로 노드마다 실행해서 cloudwatch로 전송</li>\n<li><a href=\"https://github.com/fluent/fluentd-kubernetes-daemonset\">https://github.com/fluent/fluentd-kubernetes-daemonset</a></li>\n</ul>\n<p>모니터링</p>\n<p><a href=\"https://engineering.vcnc.co.kr/2019/03/kubernetes-on-aws/\">https://engineering.vcnc.co.kr/2019/03/kubernetes-on-aws/</a></p>\n<h4 id=\"eks-참고사항\" style=\"position:relative;\"><a href=\"#eks-%EC%B0%B8%EA%B3%A0%EC%82%AC%ED%95%AD\" aria-label=\"eks 참고사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>eks 참고사항</h4>\n<p>쿠버네티스 버전 업 시 전체 노드 새로 올린다?</p>\n<p>EKS의 파드들이 IAM을 인증받는 방법은?</p>\n<ul>\n<li>kube2iam</li>\n</ul>\n<p>EKS에서는 워커 노드 당 Pod 개수 제한이 있다 - flannel을 쓰면 해결되지만 기본은\n제약이 있다.</p>\n<p>ECS, fargate, lambda 차이는?</p>\n<ul>\n<li>Fargate: 서버리스 컨테이너</li>\n</ul>\n<p>AZ, multi region도 지원해주나?</p>\n<p>네트워크 구조</p>\n<ul>\n<li>Region - VPC(논리적) - subnet - AZ - route table - Security groups -</li>\n<li>vpc, subnet, route table 각각 cidr을 설정 가능하다?</li>\n</ul>\n<p>nginx-ingress deprecate 됐고, ingress-nginx를 쓰게 된다.</p>\n<p>eks에서도 kubernetes metrics-server를 통해서 오토스케일링 조절하나?</p>\n<ul>\n<li>cluster autoscaler라는게 있다</li>\n</ul>\n<p>부하 테스트\n<code class=\"language-text\">ab -c 200 -n 200 -t 30 http://$(kubectl get ingress/backend-ingress -o jsonpath='{.status.loadBalancer.ingress[*].hostname}')/contents/aws</code></p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> provider \"kubernetes\"는 뭐지</li>\n</ul>\n<h4 id=\"배포-후-롤백-테스트\" style=\"position:relative;\"><a href=\"#%EB%B0%B0%ED%8F%AC-%ED%9B%84-%EB%A1%A4%EB%B0%B1-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"배포 후 롤백 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배포 후 롤백 테스트</h4>\n<p>지금 서버에 버전 두 개 만들어서 올리고 배포 후, 테스트하고 롤백하는 것 10초 컷\ngif로 만들어보기</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker build -t &lt;image:tag> .\ndocker push &lt;image:tag>\nkubectl set image deployment/&lt;name> &lt;name>=&lt;image:tag> --record\nkubectl rollout history deployment/&lt;name></code></pre></div>\n<p>띄워져 있어야하는 팟 개수 / 현재 개수 확인 바로 할 수 있는 방법은?</p>\n<ul>\n<li><code class=\"language-text\">kubectl get deploy -A</code></li>\n</ul>\n<p>카오스 툴 띄워서 회복 잘 하는지 테스트</p>\n<ul>\n<li>동작안함..ㅠㅠ</li>\n</ul>\n<h4 id=\"helm을-안쓰고-kubernetes로-가변적인-배포를-쉽게-할-수-없을까\" style=\"position:relative;\"><a href=\"#helm%EC%9D%84-%EC%95%88%EC%93%B0%EA%B3%A0-kubernetes%EB%A1%9C-%EA%B0%80%EB%B3%80%EC%A0%81%EC%9D%B8-%EB%B0%B0%ED%8F%AC%EB%A5%BC-%EC%89%BD%EA%B2%8C-%ED%95%A0-%EC%88%98-%EC%97%86%EC%9D%84%EA%B9%8C\" aria-label=\"helm을 안쓰고 kubernetes로 가변적인 배포를 쉽게 할 수 없을까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>helm을 안쓰고 kubernetes로 가변적인 배포를 쉽게 할 수 없을까</h4>\n<p>helm에 install --values도 values 파일을 작성해야하는데, 이러면 그냥 kubernetes\nsnippet으로 만들어도 큰 차이는 없을 것 같다...\n괜히 helm을 안깔아도 될 것 같은데</p>\n<p>gist에 파일을 올려놓고, 설정파일에 이름을 넣어서 이름 확인해서 어떤 gist를\n가져올지만 정해서 불러와서 실행시키면 되겠다.\ngitkube라는 서비스도 있다. kubernetes 안에다가 리소스를 만들어놓고 감시하는\n컨셉이다</p>\n<p>이제 세부적인 설정이 필요해지면 어떻게 수정하지</p>\n<h4 id=\"클러스터-네임스페이스-컨텍스트\" style=\"position:relative;\"><a href=\"#%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EB%84%A4%EC%9E%84%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8\" aria-label=\"클러스터 네임스페이스 컨텍스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>클러스터 네임스페이스 컨텍스트</h4>\n<ul>\n<li>컨텍스트 안에 클러스터, 사용자, 네임스페이스가 있음</li>\n<li>$KUBECONFIG 에 새로 생성한 config 파일을 넣으면 --kubeconfig config-demo 명령어를 안쳐줘도 됨</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">source</span> <span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span>kubectl completion <span class=\"token function\">zsh</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 현재 셸에 zsh의 자동 완성 설정</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'[[ $commands[kubectl] ]] &amp;&amp; source &lt;(kubectl completion zsh)'</span> <span class=\"token operator\">>></span> ~/.zshrc <span class=\"token comment\"># 자동 완성을 zsh 셸에 영구적으로 추가한다.</span></code></pre></div>\n<h5 id=\"새로운-유저로-get-pod-하기\" style=\"position:relative;\"><a href=\"#%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%9C%A0%EC%A0%80%EB%A1%9C-get-pod-%ED%95%98%EA%B8%B0\" aria-label=\"새로운 유저로 get pod 하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>새로운 유저로 get pod 하기</h5>\n<ul>\n<li>인증서 등록</li>\n<li>config-demo 만들기</li>\n<li>role 만들기</li>\n<li>roleBinding 만들기</li>\n<li>CSR 만들기</li>\n<li>인증서 approve 하기</li>\n<li>auth can-i 실행해서 확인</li>\n</ul>\n<p>\u001f</p>\n<h5 id=\"인증서-재설정-필요\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%9E%AC%EC%84%A4%EC%A0%95-%ED%95%84%EC%9A%94\" aria-label=\"인증서 재설정 필요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인증서 재설정 필요</h5>\n<p>minikube 재시작 후 서버 포트 변경됨</p>\n<ul>\n<li>minikube context에서</li>\n<li><code class=\"language-text\">openssl genrsa -out developer.key 2048</code></li>\n<li><code class=\"language-text\">openssl req -new -key developer.key -out developer.csr -subj \"/CN=developer\"</code></li>\n<li><code class=\"language-text\">k apply CSR.yaml</code></li>\n<li><code class=\"language-text\">k certificate approve developer</code></li>\n<li><code class=\"language-text\">k auth can-i list pods --as developer</code></li>\n</ul>\n<hr>\n<h2 id=\"kubernetes-external-library-installation\" style=\"position:relative;\"><a href=\"#kubernetes-external-library-installation\" aria-label=\"kubernetes external library installation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kubernetes External Library Installation</h2>\n<h4 id=\"설치\" style=\"position:relative;\"><a href=\"#%EC%84%A4%EC%B9%98\" aria-label=\"설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>설치</h4>\n<ul>\n<li><code class=\"language-text\">curl -s https://packages.cloude.google.com/apt/doc/apt-key.gpg | apt-key add -</code></li>\n<li><code class=\"language-text\">/etc/apt/sources.list.d/kubernetes.list</code> 파일에\n<ul>\n<li><code class=\"language-text\">deb https://apt.kubernetes.io/ kubernetes-xenial main</code> 입력</li>\n</ul>\n</li>\n<li><code class=\"language-text\">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl</code></li>\n<li><code class=\"language-text\">apt-get install kubelet kubeadm kubectl</code></li>\n<li><code class=\"language-text\">sudo swapoff -a</code></li>\n<li><code class=\"language-text\">sed -i '9s/^/Environment=\"KUBELET_EXTRA_ARGS=--fail-swap-on=false\"\\n/' /etc/systemd/system/kubelet.service.d/10-kubeadm.conf</code></li>\n<li><code class=\"language-text\">sudo sed -i '/ swap / s/^\\(.*\\)$/#\\1/g' /etc/fstab</code></li>\n</ul>\n<p>초기화</p>\n<ul>\n<li><code class=\"language-text\">kubeadm init --pod-network-cidr=10.244.0.0/16 --ignore-preflight-errors Swap</code></li>\n</ul>\n<p>네트워크 설치</p>\n<ul>\n<li>flannel\n<ul>\n<li><code class=\"language-text\">kubectl apply -f https://github.com/coreos/flannel/raw/master/Documentation/kube-flannel.yml</code></li>\n</ul>\n</li>\n<li>calico\n<ul>\n<li><code class=\"language-text\">kubectl apply -f https://docs.projectcalico.org/v3.10/manifests/calico.yaml</code></li>\n</ul>\n</li>\n<li>weave\n<ul>\n<li><code class=\"language-text\">kubectl apply -f \"[https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')](https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n'))\"</code></li>\n</ul>\n</li>\n</ul>\n<p>flannel 설치 시 coredns 안붙음.\ncalico로 설치\n<a href=\"https://docs.projectcalico.org/v3.10/getting-started/kubernetes/\">https://docs.projectcalico.org/v3.10/getting-started/kubernetes/</a></p>\n<p>Slave node 접속</p>\n<ul>\n<li><code class=\"language-text\">kubeadm join 192.168.0.3:6443 --token 8nt7ze.bm7pa8pi3t1jgr70\\ --discovery-token-ca-cert-hash  sha256:4337d62bce67b7ebf55466da74dfa8deb7cda3632ce5054bcc24b1fe3fcf2bff</code></li>\n</ul>\n<p>token 생성 및 확인</p>\n<ul>\n<li><code class=\"language-text\">kubeadm token create</code></li>\n<li><code class=\"language-text\">openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'</code></li>\n</ul>\n<p>Node 제거</p>\n<ul>\n<li><code class=\"language-text\">kubectl delete node &lt;node-name></code></li>\n</ul>\n<p>Master reset</p>\n<ul>\n<li><code class=\"language-text\">kubeadm reset</code></li>\n</ul>\n<p>scale 늘리기</p>\n<ul>\n<li><code class=\"language-text\">kubectl scale deploy &lt;deploy_name> --replicas=10</code></li>\n</ul>\n<h4 id=\"helm-1\" style=\"position:relative;\"><a href=\"#helm-1\" aria-label=\"helm 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>helm</h4>\n<p>kubernetes package manager</p>\n<p><code class=\"language-text\">curl https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get | cat > /tmp/helm_script.sh \\ &amp;&amp; chmod 755 /tmp/helm_script.sh &amp;&amp; /tmp/helm_script.sh --version v2.8.2 helm init --upgrade</code>\n출처: <a href=\"https://sktelecom-oslab.github.io/Virtualization-Software-Lab/Helm/\">https://sktelecom-oslab.github.io/Virtualization-Software-Lab/Helm/</a></p>\n<ul>\n<li><code class=\"language-text\">kubectl create serviceaccount --namespace kube-system tiller</code></li>\n<li><code class=\"language-text\">kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller</code></li>\n<li><code class=\"language-text\">helm init --service-account tiller --upgrade</code></li>\n<li><code class=\"language-text\">helm update repo</code></li>\n<li><code class=\"language-text\">helm install stable/redis --version 3.3.5</code></li>\n</ul>\n<p>repo 추가</p>\n<ul>\n<li><code class=\"language-text\">helm repo add stable https://kubernetes-charts.storage.googleapis.com/</code></li>\n</ul>\n<p>출처: <a href=\"https://stackoverflow.com/questions/43499971/helm-error-no-available-release-name-found\">https://stackoverflow.com/questions/43499971/helm-error-no-available-release-name-found</a></p>\n<p>helm init</p>\n<ul>\n<li>search</li>\n<li>install</li>\n<li>repo update</li>\n<li>list</li>\n<li>delete</li>\n</ul>\n<h4 id=\"kompose\" style=\"position:relative;\"><a href=\"#kompose\" aria-label=\"kompose permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Kompose</h4>\n<p>docker-compose to kubernetes yaml\n출처: <a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/translate-compose-kubernetes/#build-and-push-docker-images\">https://kubernetes.io/docs/tasks/configure-pod-container/translate-compose-kubernetes/#build-and-push-docker-images</a></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -L https://github.com/kubernetes/kompose/releases/download/v1.21.0/kompose-linux-amd64 -o kompose\nchmod +x kompose\nsudo mv ./kompose /usr/local/bin/kompose\nkompose up\nkompose convert\nkubectl apply -f &lt;file>\nkompose down</code></pre></div>\n<h4 id=\"statefulset-pv-sc\" style=\"position:relative;\"><a href=\"#statefulset-pv-sc\" aria-label=\"statefulset pv sc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Statefulset PV SC</h4>\n<p>Statefulset을 사용하기 위해 pv를 만들어야 하고\npv를 만들기 위해서 storageclass가 필요</p>\n<p>storageOS 설치\n출처: <a href=\"https://docs.storageos.com/docs/platforms/kubernetes/install/1.10\">https://docs.storageos.com/docs/platforms/kubernetes/install/1.10</a></p>\n<p>SC default 설정</p>\n<ul>\n<li><code class=\"language-text\">kubectl patch storageclass fast -p '{\"metadata\": {\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"true\"}}}'</code></li>\n</ul>\n<p>출처: <a href=\"https://proinlab.com/archives/2308\">https://proinlab.com/archives/2308</a></p>\n<p>SC default 해제</p>\n<ul>\n<li><code class=\"language-text\">kubectl patch storageclass &lt;your-class-name> -p '{\"metadata\": {\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"false\"}}}'</code></li>\n</ul>\n<p>glusterfs pv pvc 예제</p>\n<ul>\n<li><a href=\"https://teamsmiley.github.io/2019/06/29/kubernetes-glusterfs/\">https://teamsmiley.github.io/2019/06/29/kubernetes-glusterfs/</a></li>\n<li><a href=\"https://docs.okd.io/latest/install_config/storage_examples/gluster_example.html\">https://docs.okd.io/latest/install_config/storage_examples/gluster_example.html</a></li>\n</ul>\n<h4 id=\"glusterfs-설치\" style=\"position:relative;\"><a href=\"#glusterfs-%EC%84%A4%EC%B9%98\" aria-label=\"glusterfs 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>glusterfs 설치</h4>\n<p>gfs1, gfs2 라는 서버가 있다고 하자.</p>\n<ul>\n<li>양쪽 서버에서 /etc/hosts에 host 이름 둘 다 적어준다</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo apt-get install software-properties-common\nsudo add-apt-repository ppa:gluster/glusterfs-5\nsudo apt-get update\nsudo apt install glusterfs-server\nsudo ufw allow proto any from &lt;상대아이피> to &lt;자신아이피>\nsudo service glusterd start\n\nsudo gluster peer probe gfs2 # gfs1에서는 gfs2를, gfs2에서는 gfs1을 둘 다 입력\nsudo mkdir -p /gluster/fs\nsudo gluster volume create vol replica 2 transport tcp gfs1:/gluster/fs gfs2:/gluster/fs force\n# (루트 파티션에는 볼륨 설정 안하기를 권하고 있으나 강제로 가능)\n\nsudo gluster volume start vol\nsudo mkdir -p /mnt/gluster\nsudo mount -t glusterfs &lt;자신아이피>:/vol &lt;마운트할 폴더> # (양쪽 서버에서 실행)</code></pre></div>\n<ul>\n<li>/gluster/fs/ 는 파일 저장되는 공간</li>\n<li>/mnt/gluster 는 마운트 시켜서 사용하는 공간</li>\n</ul>\n<p>/etc/fstab에 추가</p>\n<ul>\n<li><code class=\"language-text\">gfs1:/vol /mnt/gluster glusterfs defaults,_netdev 0 0</code></li>\n</ul>\n<p>peer 추가 시</p>\n<ul>\n<li><code class=\"language-text\">gluster volume add-brick glus_vol gluster5:/data1/gluster gluster6:/data1/gluster</code></li>\n</ul>\n<p>출처: <a href=\"http://junhyung2.blogspot.com/2014/12/7-glusterfs.html\">http://junhyung2.blogspot.com/2014/12/7-glusterfs.html</a></p>\n<p>volume 삭제</p>\n<ul>\n<li><code class=\"language-text\">gluster volume remove-brick vol_dist vmlnx005:/data</code></li>\n</ul>\n<p>출처: <a href=\"http://blog.syszone.co.kr/3038\">http://blog.syszone.co.kr/3038</a></p>\n<p>Glusterfs 로 data volume 구성.\n볼륨형태</p>\n<ul>\n<li>Replication : 완전 복제</li>\n<li>Distributed : 분산 저장, 파일별로 분산</li>\n<li>Striped     : 완전 분산 저장, 하나의 파일도 분산, I/O 성능 향상, 하나의 서버가 죽으면 파일 유실</li>\n</ul>\n<p>Volume2가 꺼졌다가 켜지면 동기화가 어떻게 되는지?</p>\n<p>목표</p>\n<ul>\n<li>스웜으로 두개를 킨 후 하나의 서버를 종료 시켜도 접속 가능하게</li>\n<li>DB 컨테이너 생성 시 볼륨을 시킨다</li>\n</ul>\n<p>[[Troubleshooting#kubernetes]]</p>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{"id":"container","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#container","ariaLabel":"container permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Container"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"docker-strength","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-strength","ariaLabel":"docker strength permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"docker strength"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"isolation process"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"no dependency"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"portable"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"light-weight"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"docker-image-vs-compose","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-image-vs-compose","ariaLabel":"docker image vs compose permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Docker image vs compose"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"image vs volume\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"test with volume, deploy with image"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"docker-logs","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-logs","ariaLabel":"docker logs permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"docker logs"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"make stdout\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"echo \"test\" >> /proc/1/fd/1"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"--log-opt"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"max-size"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"max-file"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Fluentd와 Eleasticsearch를 이용해서 로그 수집 및 검색"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"표준출력(stdout)으로 로그를 출력하도록 두고, 이를 수집하도록 한다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"nginx는 stdout으로 출력되도록 설정이 필요하다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"1.19.8 버전을 쓰는 지금은 stdout으로 출력되도록 설정되어있다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"container-1","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#container-1","ariaLabel":"container 1 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"container"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"libcontainer 개발로 kernel에서 namespaces, cgroups 등을 직접 실행\nLXC -> runC 컨테이너 런타임 변경. OCI 준수\n그 외 rkt, cri-o 등이 있음"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"LXC는 다른 호스트에서 실행했을 때 설정 차이로 동일하게 돌아가지 않는 경우가\n있었다고 한다.\n도커도 버전 다르면 안돌아간다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Container 구동 원리"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"chroot"}]},{"type":"text","value":" - 입력받은 디렉토리를 루트로 하여 격리된 환경을 만들어준다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cgroups - 시스템 리소스를 격리할 수 있다(cpu, memory, network, disk)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"overlayFS - 프로세스 간 파일 시스템 분리\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"image layer + container layer(컨테이너 안에서 수정되는 파일들)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"namespace - "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"unshare"}]},{"type":"text","value":" 프로세스 간 시스템 자원들을 격리하는 기능\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cgroup - "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-C"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"user - "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-U"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"mnt - "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-m"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ipc - "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-i"}]},{"type":"text","value":" 프로세스 간 통신. 같은 네임스페이스 안에 있어야 통신 가능"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"pid - "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-p"}]},{"type":"text","value":" 컨테이너 안에서는 프로세스 번호를 새롭게 받는다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"uts - "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-u"}]},{"type":"text","value":" hostname 격리"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"net - "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"ip netns add <ns name>"}]},{"type":"text","value":" 네트워크 규칙들을 새롭게 받는다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://speakerdeck.com/devinjeon/containerbuteo-dasi-salpyeoboneun-kubernetes-pod-dongjag-weonri?slide=29"},"children":[{"type":"text","value":"https://speakerdeck.com/devinjeon/containerbuteo-dasi-salpyeoboneun-kubernetes-pod-dongjag-weonri?slide=29"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"네임스페이스와 컨테이너, 네트워크까지 잘 정리된 링크"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://www.44bits.io/ko/keyword/linux-namespace"},"children":[{"type":"text","value":"https://www.44bits.io/ko/keyword/linux-namespace"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"docker의-위기","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker%EC%9D%98-%EC%9C%84%EA%B8%B0","ariaLabel":"docker의 위기 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Docker의 위기?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"container is light-weight and portable more than virtual machine image"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"but it can same work that PC's work"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Can exist more than light-weight task from docker?"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"OCI(Open Container Initiative)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Container Runtime"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Image Download -> Extract Image -> Execute Container"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Container has cgroups, namespace, networking"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"alternative to Buildah, skopeo, podman"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"docker is one big process. It can make single point of failure."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"divide docker position by 3."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"dockerfile","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#dockerfile","ariaLabel":"dockerfile permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Dockerfile"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"바이너리를 도커파일에서 받을 때 체크섬을 검증하는 내용을 적으면 이미지의 신뢰성이 올라간다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"루트 대신 사용자 추가하는 내용을 디폴트로 한다\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"RUN useradd sam"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"USER sam"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"간단하다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"docker.sock은 호스트의 도커 컨테이너 관리를 장악할 수 있다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"dockerfile에 locale, time 등 설정 해두는게 좋지 않을까"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"docker-compose에서-빌드-단계의-이미지를-쓸-수-있을까","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-compose%EC%97%90%EC%84%9C-%EB%B9%8C%EB%93%9C-%EB%8B%A8%EA%B3%84%EC%9D%98-%EC%9D%B4%EB%AF%B8%EC%A7%80%EB%A5%BC-%EC%93%B8-%EC%88%98-%EC%9E%88%EC%9D%84%EA%B9%8C","ariaLabel":"docker compose에서 빌드 단계의 이미지를 쓸 수 있을까 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"docker compose에서 빌드 단계의 이미지를 쓸 수 있을까"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Dockerfile은 멀티 빌드로 해놓고 배포시에는 마지막 빌드 이미지를 쓰지만\n개발 시에는 빌드한 것으로 쓰고 싶은데"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"build\n  context: ./\n  target: build"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"build에 target으로 이름 맞춰주면 된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"docker-compose를-이용해-이미지를-바로-배포하는-것과-dockerfile을-쓰는-것","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-compose%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4-%EC%9D%B4%EB%AF%B8%EC%A7%80%EB%A5%BC-%EB%B0%94%EB%A1%9C-%EB%B0%B0%ED%8F%AC%ED%95%98%EB%8A%94-%EA%B2%83%EA%B3%BC-dockerfile%EC%9D%84-%EC%93%B0%EB%8A%94-%EA%B2%83","ariaLabel":"docker compose를 이용해 이미지를 바로 배포하는 것과 dockerfile을 쓰는 것 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"docker-compose를 이용해 이미지를 바로 배포하는 것과 Dockerfile을 쓰는 것"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"dockerfile 없이 이미지로만 할 때의 문제점?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"어떤 것을 바꿨는지 추적하기 힘들다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"설치파일들 찾기 힘들다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"docker layer와 image size를 줄일수록 배포가 빨라지는 도커의 장점을 이용못한다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"dockerfile로 하면 쿠버네티스 사용 시 이미지 빌드를 또 해줘야 하잖아?\n이미지로 올리는 경우는 왜 이미지로 올리는거지?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"볼륨을 해도 커밋 시 볼륨된 내용은 적용 안되고, 기존 이미지가 갖고 있던대로 된다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"dockerfile에서 copy를 한 폴더를 외부에서 수정 후 내부에 들어가면 수정되어 있나?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"No"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"build - docker file to image\ndocker-compose up 을 하면 이미지를 새로 부른다? volume"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"dockerfile -> image -> pods\nbuild -> push -> kubernetes apply(set image)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"개발환경에서는 볼륨을 해서 compose로 개발하고\n배포 시에는 Dockerfile을 이미지화해서 배포한다\n개발디렉토리는 Dockerfile에도 COPY에 있어야하고, compose에도 볼륨을 한다.\n개발환경에서 쓰는 이미지는 배포 시 쓰는 이미지와 같은 것을 사용한다.\n이미지 빌드는 CD pipeline을 통해서 한다. 이미지 혼동을 막기 위해"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{"className":["contains-task-list"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","disabled":true},"children":[]},{"type":"text","value":" 이미지를 기반으로 작업을 하면 이미지가 업데이트 되었는데 이전 버전으로\n작업하던 사람들은?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","disabled":true},"children":[]},{"type":"text","value":" 최초 작업 시 이미지가 없어서 compose를 실행 못시키니, 빌드 파이프라인을 먼저 만든다?"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"내가 원하는게 디렉토리 전체를 덮어쓰는게 아니라 일부만 수정하는 거라서 좀 꼬였다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{"className":["contains-task-list"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","disabled":true},"children":[]},{"type":"text","value":" 일일이 COPY를 해야 하나? compose에서는 어떻게?"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Dockerfile\nCOPY /app /app\n\n---\n\ndocker-compose.yml\nvolume: /app:/app"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"app 폴더의 내용을 수정 후 docker build나 compose up을 하면 동일한 상태가 된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"서버 설치: vagrant up (git pull -> [docker-compose up or kubectl apply])\n서버 수정: git pull -> docker-compose up -> 수정 -> 테스트 -> git push -> 서버 적용"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"서버 개발: git pull -> docker-compose up -> 수정 -> 테스트 -> git push\n서버 업데이트: git pull -> docker-compose up"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"실서버에서도 볼륨으로 돌릴까? 순수 이미지로만 돌릴까?\n실서버에서도 수정을 하고 싶은데 다른 회사들은 어떻게 하지? 실서버는 안건드리는게\n좋으려나?\n그러면 compose.yml을 두개를 만들어야 하나\n실서버에서도 그냥 볼륨을 하면 어떨까?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"실서버에서 수정을 하는게 편하지만 절대로 하면 안된다고 권고한다\n번거롭더라도 재빌드 재배포를 하라고 한다\n그렇다면 핫픽스를 최대한 빨리 배포할 수 있도록 해야 하는데\n쿠버네티스에는 명령어 하나로 되돌릴 수 있다\n깃헙 액션으로 바로 되돌릴 수 있어야 한다\n핫픽스 or 롤백"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"배포는 ansible로 github action 하면 되겠다\n근데 ansible로 하면 서버 private key가 필요한게 번거롭다\n그렇다고 vault서버에서 가져오는 것도 private key를 관리해야되서 번거롭다\n보안은 번거롭지만 해야되긴 한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"배포-뼈대-만들기","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EB%B0%B0%ED%8F%AC-%EB%BC%88%EB%8C%80-%EB%A7%8C%EB%93%A4%EA%B8%B0","ariaLabel":"배포 뼈대 만들기 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"배포 뼈대 만들기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"kubernetes 버전\ndocker image 버전"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"최소 docker image로 빌드하고, 여유가 있으면 kubernetes를 이용\nCI로 간단 검증\nCD는 ansible 또는 argoCD\n핫픽스룰을 따로 만들어 둔다.\npush를 하면 검증을 한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"commit, 2. merge, 3. hotfix"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{"className":["contains-task-list"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","disabled":true},"children":[]},{"type":"text","value":" 빌드 요청은 어떻게?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","disabled":true},"children":[]},{"type":"text","value":" 버저닝은 어떻게?"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"docker-image","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-image","ariaLabel":"docker image permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"docker image"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"alpine, stretch, slim, buster\nbuster, stretch는 debian용\nalpine은 alpine linux로 만든 것\nslim은 그 이미지를 실행하기 위한 최소한의 설치파일만 있는 것"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"근데 slim보다 alpine이 더 이미지 크기는 작다?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"docker-compose-execute-bash","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-compose-execute-bash","ariaLabel":"docker compose execute bash permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"docker compose execute bash"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"entrypoint: /bin/bash"}]},{"type":"text","value":" failed"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"tty:true; stdin_open:true"}]},{"type":"text","value":" success"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose run app bash"}]},{"type":"text","value":" success"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"docker-cmd-vs-entrypoint","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-cmd-vs-entrypoint","ariaLabel":"docker cmd vs entrypoint permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"docker cmd vs entrypoint"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"커맨드 툴을 도커명령어에서 바로 실행하려고 하면\nCMD로 하면 안되고 ENTRYPOINT로 하면 된다\n"},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker run hanspell-cli -h"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"대신 ENTRYPOINT를 쓰면 -it /bin/sh 는 인식을 못한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"docker-간-통신","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-%EA%B0%84-%ED%86%B5%EC%8B%A0","ariaLabel":"docker 간 통신 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"docker 간 통신"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"compose 에서 네트워크 명시적으로 설정해줘서 compose에 설정한 이름으로 통신하면 된다고 한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"--network host 를 써도 된다고 한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"docker buildx build --network host --platform linux/arm64 -t goodby ."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://marshallku.com/dev/deploy-rust-with-docker"},"children":[{"type":"text","value":"https://marshallku.com/dev/deploy-rust-with-docker"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{"id":"kubernetes","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes","ariaLabel":"kubernetes permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Kubernetes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"A person has a very small component, and it composes of one architecture.\nthe kuberetes seem to be this.\nand I want to make software like this architecture.\nstrong small component to flexible architecture.\nkubernetes makes easy to a devops works\nabout deploy, scaling, update, healthcheck, orchestration\nbut devops works is not clear."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl run curl --image=radial/busyboxplus:curl -i --tty"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"pods cluster inside curl pod"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"keep focusing only bisuness logic"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"monitoring - feedback - update logic"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{"start":2},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"data management"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"production deploy behavior make easy\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"update and rollback"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"scale up and down"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/dennyzhang/cheatsheet-kubernetes-A4/blob/master/README.org"},"children":[{"type":"text","value":"https://github.com/dennyzhang/cheatsheet-kubernetes-A4/blob/master/README.org"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ClusterIP vs NodePort vs Ingress"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"service account?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cluster role?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cluster? - node"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"daemon set?\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"it makes every node to make pods"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"example: every node can have logstash"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"resource","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#resource","ariaLabel":"resource permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"resource"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"pods"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"replicaset"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"deployment"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"service"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"컨테이너 리소스"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"pod, deployment"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"보안 리소스"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"rolebinding"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"설정 리소스"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"configmap"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"api","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#api","ariaLabel":"api permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"api"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"master\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"kube-apiserver"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"kube-scheduler"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"kube-controller"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"kubelet"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"kube-proxy"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"etcd"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"node\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"kubelet"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"kube-proxy"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"쿠버네티스는-os와-클라우드를-추상화할-수-있나","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EB%8A%94-os%EC%99%80-%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%EB%A5%BC-%EC%B6%94%EC%83%81%ED%99%94%ED%95%A0-%EC%88%98-%EC%9E%88%EB%82%98","ariaLabel":"쿠버네티스는 os와 클라우드를 추상화할 수 있나 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"쿠버네티스는 os와 클라우드를 추상화할 수 있나?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"서비스의 장애가 os에 영향을 미쳐도 서비스를 격리하면 문제가 해결될 수 있나?\n그렇다면 '쿠버네티스', '마이크로서비스', '데이터'가 소프트웨어의 큰 줄기가 될 수 있다\n원래는 인프라, 서비스, 데이터인 것을 쿠버네티스가 인프라를 완전 대체?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"kubernetes-volume","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes-volume","ariaLabel":"kubernetes volume permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"kubernetes volume"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"특정 노드의 폴더를 사용할 때는 hostPath를 사용할 수 있다.\n근데 노드 상관 없이 폴더를 써야하는 경우가 대부분일 것이다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"쿠버네티스-네트워크의-이해","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%EC%9D%98-%EC%9D%B4%ED%95%B4","ariaLabel":"쿠버네티스 네트워크의 이해 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"쿠버네티스 네트워크의 이해"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"팟들끼리의 통신은 veth 을 통해서 하게 된다 eth0 -> docker0 -> veth0\n그리고 eth0이 어떤 veth0과 연결되어 있는지 라우팅 테이블이 존재한다\n하지만 팟은 언제든 사라졌다가 다시 생겨날 수 있어서 이를 추상화하는 레이어가 하나 필요하고 이것을 service로 만들었다\n(IP 네트워크는 보통 자신의 host에서 목적지를 찾지 못하면 상위 게이트웨이로 전달하도록 동작)\nservice는 리눅스 커널 기능인 netfilter와 iptables를 이용한다\nkube-proxy라는 녀석도 같이 동작에 관여하는데 얘는 netfilter에 규칙을 수정하는 역할만 하고 실제 동작은 netfilter에서 이루어진다\n클러스터 외부에서 트래픽을 내부로 전달하고 싶다면 로드밸런서를 이용한다\n외부에서 요청이 오면 NodePort를 거쳐서 내부 Node의 ip를 찾게 되고 이것이 다시 netfilter를 거쳐서 팟을 찾을 수 있게 된다\n하지만 NodePort를 확장한 LoadBalancer Service도 제약사항이 있는데 한개의 로드밸런서가 여러 서비스를 연결하지 못한다는 점이다.\n그래서 ingress가 나왔다\ningress는 그래서 한개의 로드밸런서로 여러 서비스를 유연하게 설정할 수 있게 해준다\ningress는 ingress-controller가 동작하게 해야하고, 각 클라우드 플랫폼 마다 ingress-controller 구현체가 있다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"deploy","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#deploy","ariaLabel":"deploy permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"deploy"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"배포와 릴리즈를 분리\n쿠버네티스에 apply를 해도 실제 서버에 바로 적용되는게 아니라 서비스 메시에서\n릴리즈를 관리 -> istio를 이용"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"서비스 키고 시간이 지나면 api 접속이 안됨"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"istio, monitoring, argocd 켜놨는데 어디가 리소스 많이 먹는지 알고 싶다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"deployment-kill","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#deployment-kill","ariaLabel":"deployment kill permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"deployment kill"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"deployment 정지시키려면 scale --replicas=0 으로 해야되나보다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"pod을 삭제하는 건 kill로 한다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"kubernetes-test","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes-test","ariaLabel":"kubernetes test permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"kubernetes test"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"local test, production build pipeline"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"local test with only dockerfile"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"local test with same with production"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"In msa. need kubernetes?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"In msa. github repo is seperated?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"developer can build docker image?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"how to provide docker image to developer?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"when developer push updated source. pipeline is\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"kubernetes apply?"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"build with tags?\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"git tag 1.0.0"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"git push origin --tags"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"hpa"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"service"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"minikube"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"쿠버네티스-클러스터-중에-마스터가-자원을-많이-쓰나-노드가-많이쓰나","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%A4%91%EC%97%90-%EB%A7%88%EC%8A%A4%ED%84%B0%EA%B0%80-%EC%9E%90%EC%9B%90%EC%9D%84-%EB%A7%8E%EC%9D%B4-%EC%93%B0%EB%82%98-%EB%85%B8%EB%93%9C%EA%B0%80-%EB%A7%8E%EC%9D%B4%EC%93%B0%EB%82%98","ariaLabel":"쿠버네티스 클러스터 중에 마스터가 자원을 많이 쓰나 노드가 많이쓰나 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"쿠버네티스 클러스터 중에 마스터가 자원을 많이 쓰나, 노드가 많이쓰나?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"master"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"api server, etcd 등 기본적으로 자원을 많이 사용한다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"서비스가 빡세게 돌면 노드가 많이쓰나?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"쿠버네티스 로그 서비스 추가해서\n노드 하나를 일부러 끄면 로그 잘 남는지 확인하고\n죽은 서버를 살릴 수 있을지 확인"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ram 1기가 서버에 ram 0.5를 쓰는 서비스를 6개를 레플리카하면 동작하나?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"자원 한도 넘어가면 파드를 안 만든다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"글러스터fs 와 db 레플리케이션을\n쿠버네티스에서 편하게 할 수 있는 방법이 있나?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"클러스터를 한번씩 껐다 켜서 리프레시 했을때 안좋은점이 있을까?\n없다면 접속자 적은 시간을 뽑아서 한 서버씩 재부팅 해줘야겠다\n페일오버 테스트도 되고, os도 리프레시 되지 않을까"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"걱정되는 점은 한쪽 노드에 팟들이 몰려있다가 다시 돌아갈 때 과부하 걸리지 않을지"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"쿠버네티스는-어떻게-복잡성을-관리하는가","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%B3%B5%EC%9E%A1%EC%84%B1%EC%9D%84-%EA%B4%80%EB%A6%AC%ED%95%98%EB%8A%94%EA%B0%80","ariaLabel":"쿠버네티스는 어떻게 복잡성을 관리하는가 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"쿠버네티스는 어떻게 복잡성을 관리하는가"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ingress -> service -> deployment 식의 계층적 추상화"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"namespace 격리"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"controller pattern - 이건 좀 더 찾아보자\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"각 리소스별 전용 컨트롤러가 상태 관리"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"단일 책임 원칙으로 복잡성 분산"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Reconciliation Loop로 일관된 동작 보장"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Operator pattern\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"도메인 특화 로직을 CRD로 추상화"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"인간의 운영 지식을 코드로 전환"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"그치만 쿠버네티스도 한계가 있다\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"노드 수 제한도 있고"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"API 서버가 초당 수천개 요청에서 성능 저하하는 처리량 한계도 있다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"컨트롤 플레인은 사용량이 선형적으로 증가할 수 밖에 없다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"또한 복잡성의 새로운 차원이 있다\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"네트워킹 오버헤드 (CNI 성능 이슈)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"스토리지 관리 복잡성 증가"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"보안 정책의 기하급수적 복잡성"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"디버깅과 트러블슈팅의 어려움"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"그래서 클러스터를 분리해야한다\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"팀별 / 환경별"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"그러면 분리된 클러스터도 관리를 쉽게 할 수 있어야 한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"하나의 클러스터로 다 하려고 하는건 확장적이지 못하다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"하나의 클러스터를 잘 관리할 수 있으면 멀티 클러스터도 관리할 수 있다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"쿠버네티스-멀티-클러스터-그-이후","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%A9%80%ED%8B%B0-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EA%B7%B8-%EC%9D%B4%ED%9B%84","ariaLabel":"쿠버네티스 멀티 클러스터 그 이후 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"쿠버네티스 멀티 클러스터 그 이후"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"클러스터간 관리를 하는 중앙 관리가 필요할 것 같다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"중앙 클러스터가 있고"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"도메인별 클러스터를 따로 만든다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"도메인별 클러스터에는 최대한 공용 인프라를 안쓰고"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"중앙 클러스터에서 관리할 수 있도록 한다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"docker-kubernetes-istio","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#docker-kubernetes-istio","ariaLabel":"docker kubernetes istio permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"docker kubernetes istio"}]},{"type":"text","value":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"},{"type":"element","tagName":"table","properties":{},"children":[{"type":"element","tagName":"thead","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"docker"}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"kubernetes"}]},{"type":"element","tagName":"th","properties":{},"children":[{"type":"text","value":"istio"}]}]}]},{"type":"element","tagName":"tbody","properties":{},"children":[{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"이식성"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"배포 (단일 배포점, 롤링 업데이트)"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"서비스 메시"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"고립성"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"로드 밸런싱"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"어플리케이션 api 마다 프록시"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"가벼움"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"서비스 디스커버리"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"서킷 브레이킹"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"헬스체크"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"스케일링"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"카오스 테스트"}]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"페일오버"}]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"고가용성 확보(3 node)"}]},{"type":"element","tagName":"td","properties":{},"children":[]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[{"type":"text","value":"확장 시 서버 셋팅 자동화"}]},{"type":"element","tagName":"td","properties":{},"children":[]}]},{"type":"element","tagName":"tr","properties":{},"children":[{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[]},{"type":"element","tagName":"td","properties":{},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"롤백, 자원관리, 모니터링, 시크릿 관리"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"network-resource","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#network-resource","ariaLabel":"network resource permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Network Resource"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"nginx-vs-istio","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#nginx-vs-istio","ariaLabel":"nginx vs istio permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"nginx vs istio"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"service -> Ingress"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"istio Gateway -> Virtual Service -> Destination Rule"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"트래픽을 한 곳에서 다 처리하느냐, 각 서비스마다 분리해서 처리하느냐가 큰 차이\n사이드카가 많아져서 생기는 중복 오버헤드가 많을까, 비대해진 하나의 객체가\n오버헤드가 많을까\n내부에 직접 통신하면서 트래픽을 제어할 수 있는 것은 장점\napi gateway의 상위호환이 되려고 한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"istio"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"트래픽 모니터링 가능"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"트래픽을 제어할 수 있다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"각 서비스마다 분리되어 있어서 단일 고장점이 아니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"retry 및 timeout 동작"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"nginx(api gateway)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"단일 객체"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"트래픽 제어"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"nginx-canary","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#nginx-canary","ariaLabel":"nginx canary permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"nginx canary"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"metadata:\n  annotations:\n    nginx.ingress.kubernetes.io/canary: \"true\"\n    nginx.ingress.kubernetes.io/canary-weight: \"20\""}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"kubernetes-supports-cluster","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes-supports-cluster","ariaLabel":"kubernetes supports cluster permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"kubernetes supports cluster"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"< 5000 nodes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"< 150000 pods"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"< 300000 containers"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"< 100 pods per node"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"kubernetes-access-remote-cluster","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes-access-remote-cluster","ariaLabel":"kubernetes access remote cluster permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"kubernetes access remote cluster"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"scp <user>@<ip>:/home/vagrant/.kube/config ~/.kube/config"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"kubernetes-dns","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes-dns","ariaLabel":"kubernetes dns permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"kubernetes dns"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"kube-dns\ncoredns 1.12 버전부터 사용, 호환성을 위해 라벨링은 kube-dns로 되있다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"myapplication.namespace.svc.cluster.local"}]},{"type":"text","value":" 형식으로 되있다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://jonnung.dev/kubernetes/2020/05/11/kubernetes-dns-about-coredns/"},"children":[{"type":"text","value":"https://jonnung.dev/kubernetes/2020/05/11/kubernetes-dns-about-coredns/"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"test","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#test","ariaLabel":"test permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Test"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"test-1","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#test-1","ariaLabel":"test 1 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"test"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"how to test account system?\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"check send complete"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"check response code"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"stress test per process\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"while true; do curl http://localhost; done"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"hpa\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"when do switching, connection is waiting?"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"how to destroy one pod"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"recovery time in replicaset"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"image to rollup, rollback"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ci/cd"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Spinnaker - build tool\nEnvoy - proxy, c/b, network tool"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{"className":["contains-task-list"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","disabled":true},"children":[]},{"type":"text","value":" image size is matter for performance?"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"build image\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker build shdkej/imagename:tag ."}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker login"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker push shdkej/imagename:tag"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"deployment, service\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl apply -f file.yml"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"test\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl run -it curl --image=radial/busyboxplus:curl "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"curl http://deploy-name:port"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"port forward\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl port-forward svc/svc-name 8080:8080"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"client run"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"check some signal"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"report how many success is"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"case 1. normal string output check - 100000 user\n- for 10000 -> 24s\n- for 100000 -> 1m30s\n- goroutine 100000\n- server can't accept\ncase 2. stream output check"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"파드하나에 접속량을 몰아서 뻣는 경우 테스트\n노드 하나에 몰아서 테스트\n전체에 영향가게 테스트\napi서버가 어떻게 부하를 받는지 확인"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"plugin","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#plugin","ariaLabel":"plugin permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Plugin"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"helm-k3s-kubernetes-cluster-unreachable-error","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#helm-k3s-kubernetes-cluster-unreachable-error","ariaLabel":"helm k3s kubernetes cluster unreachable error permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"helm k3s Kubernetes cluster unreachable error"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"set "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"export KUBECONFIG=/etc/rancher/k3s/k3s.yaml"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"a","properties":{"href":"https://github.com/rancher/k3s/issues/1126"},"children":[{"type":"text","value":"https://github.com/rancher/k3s/issues/1126"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"eks-vs-ec2-autoscale-and-setting-kubernetes-vs-kubernetes-hpa","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#eks-vs-ec2-autoscale-and-setting-kubernetes-vs-kubernetes-hpa","ariaLabel":"eks vs ec2 autoscale and setting kubernetes vs kubernetes hpa permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"eks vs ec2 autoscale and setting kubernetes vs kubernetes hpa"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"container-serverless","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#container-serverless","ariaLabel":"container serverless permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"container serverless"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"knative, lstio, open-faas"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"k3s","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#k3s","ariaLabel":"k3s permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"k3s"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"token "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/var/lib/rancher/k3s/server/node-token"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"join\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"curl -sfL http://get.k3s.io | K3S_URL=https://192.168.0.50:6443 \\ K3S_TOKEN=join_token_we_copied_earlier sh -"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"connect remotly\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"scp root@ip:/etc/rancher/k3s/k3s.yaml ~/.kube/config"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"replace 127.0.0.1 -> remote ip"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"k3s-monitoring","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#k3s-monitoring","ariaLabel":"k3s monitoring permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"k3s monitoring"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl apply -k github.com/premist/k3s-kube-prometheus/setup"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl apply -k github.com/premist/k3s-kube-prometheus"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"k3s-helm","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#k3s-helm","ariaLabel":"k3s helm permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"k3s helm"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"! Kubernetes cluster unreachable"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"export KUBECONFIG=/etc/rancher/k3s/k3s.yaml"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"or "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl config view --raw >~/.kube/config"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"k3s-connect-remotely-to-the-cluster","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#k3s-connect-remotely-to-the-cluster","ariaLabel":"k3s connect remotely to the cluster permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"k3s connect remotely to the cluster"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"mkdir ~/.kube\nscp <user@ip>:/etc/rancher/k3s/k3s.yaml ~/.kube/config\nsed -i '' 's/127\\.0\\.0\\.1/192\\.168\\.0\\.22/g' ~/.kube/config"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"helm","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#helm","ariaLabel":"helm permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"helm"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"chart.yml\nvalue.yml\ntemplates/\ncharts/"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"install "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm install <name> <chart>"}]},{"type":"text","value":"\n상태 보기 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm status <name>"}]},{"type":"text","value":"\n업그레이드 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm upgrade -f <value.yml> <name> <folder>"}]},{"type":"text","value":"\n지우기 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm del <name>"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"helm-install-from-local","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#helm-install-from-local","ariaLabel":"helm install from local permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"helm install from local"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm install <name> <directory> --values <values.yaml>"}]},{"type":"text","value":"\nor just setting key\n"},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm install <name> <directory> --set <key=value,key2=value2>"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"turn-on-and-access-to-grafana-in-kubernetes-nodes","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#turn-on-and-access-to-grafana-in-kubernetes-nodes","ariaLabel":"turn on and access to grafana in kubernetes nodes permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"turn on and access to grafana in kubernetes nodes"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"build kubernetes setup -- vagrant"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"access nginx from just node\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl create deployment --image nginx my-nginx"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl expose deployment my-nginx --port=80 --type=LoadBalancer"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"access from master node"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"deploy grafana"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"add kubernetes monitoring script"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"kubernetes-load-balancer","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes-load-balancer","ariaLabel":"kubernetes load balancer permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"kubernetes load balancer"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"metallb"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"kubernetes-network-service-test","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes-network-service-test","ariaLabel":"kubernetes network service test permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"kubernetes network service test"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"istio\nconsul\nload balancer"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"kubernetes-tool","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes-tool","ariaLabel":"kubernetes tool permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"kubernetes tool"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"chaos-mesh\nspinnaker\nknative"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"deploy-1","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#deploy-1","ariaLabel":"deploy 1 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"deploy"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"deploy spinnaker"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"kubernetes는 github에서 돌아가야 한다. 근데 로컬에서도 똑같이 할 수 있어야 한다\ngithub action에 종속되지 않고 CI를 하려면 스크립트를 호출하는 방식으로 해야하나\ngithub action server와 비슷한 서버를 만들어서 에러 시 리다이렉트 해야하나\njenkins는 자체 서버를 돌리니까 이를 이용해야 하나"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"인프라-관련-툴과-서비스-관련-툴을-분리하면-좋을-것-같다","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%9D%B8%ED%94%84%EB%9D%BC-%EA%B4%80%EB%A0%A8-%ED%88%B4%EA%B3%BC-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B4%80%EB%A0%A8-%ED%88%B4%EC%9D%84-%EB%B6%84%EB%A6%AC%ED%95%98%EB%A9%B4-%EC%A2%8B%EC%9D%84-%EA%B2%83-%EA%B0%99%EB%8B%A4","ariaLabel":"인프라 관련 툴과 서비스 관련 툴을 분리하면 좋을 것 같다 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"인프라 관련 툴과 서비스 관련 툴을 분리하면 좋을 것 같다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"모니터링, 로깅,"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"보안, 리버스 프록시"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"실제 로직 구동 앱"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"미들웨어(카프카)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"쿠버네티스-네임스페이스를-어떻게-분리할까","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%84%A4%EC%9E%84%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4%EB%A5%BC-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%B6%84%EB%A6%AC%ED%95%A0%EA%B9%8C","ariaLabel":"쿠버네티스 네임스페이스를 어떻게 분리할까 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"쿠버네티스 네임스페이스를 어떻게 분리할까"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"지금 istio, argocd, monitoring으로 나눠져있는데\n그러면 monitoring에서 다른 네임스페이스를 참조할 수 있나?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"production 과 development로 나누면 똑같은 파일로 두번 apply하면 되나?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"kubernetes-local-image-사용하기","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes-local-image-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0","ariaLabel":"kubernetes local image 사용하기 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"kubernetes local image 사용하기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"image"}]},{"type":"text","value":" 밑에 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"imagePullPolicy"}]},{"type":"text","value":"를 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Never"}]},{"type":"text","value":"로 설정한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"minikube 사용 시 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"eval $(minikube -p minikube docker-env)"}]},{"type":"text","value":" 입력"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"docker image를 새로 빌드해야한다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"rbac","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#rbac","ariaLabel":"rbac permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"RBAC"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"role-based access control\nmatching user - role"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ServiceAccount"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Role"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"RoleBinding"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ClusterRole"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ClusterRoleBinding"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Role과 ClusterRole의 차이"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Role은 네임스페이스 하나에만 할당되고 ClusterRole은 여러개가 되며, 허용범위가\n넓다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Cluster라 함은 Master와 Node의 범위다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"service account 생성"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kind: ServiceAccount\nmetadata:\n  name: developer1\n  namespace: team1"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"허용할 api와 리소스, 명령어를 지정해준다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kind: Role\nmetadata:\n  ...\nrules:\n- apiGroups: ['', 'apps']\n  resources: ['pods', 'deployment']\n  verbs: ['get', 'list']"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"롤 바인딩 파일에서 서비스 어카운트와 롤을 매칭해준다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kind: RoleBinding\nmetadata:\n  ...\nsubjects:\n- kind: ServiceAccount\n  name: developer1\n  apiGroup: \"\"\nroleRef:\n  kind: Role\n  name: role-dev\n  apiGroup: rbac.authorization.k8s.io"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"argocd","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#argocd","ariaLabel":"argocd permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"argocd"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"# kubernetes에 argocd 올리기\nkubectl create namespace argocd\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml\nkubectl patch svc argocd-server -n argocd -p '{\"spec\": {\"type\": \"LoadBalancer\"}}'\n## port 확인하거나 port-forward 해서 접속 가능\n\n\n# 로그인이나 클라이언트 명령 처리 시 클라이언트 툴 설치\nVERSION=$(curl --silent \"https://api.github.com/repos/argoproj/argo-cd/releases/latest\" | grep '\"tag_name\"' | sed -E 's/.*\"([^\"]+)\".*/\\1/')\ncurl -sSL -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64\nchmod +x /usr/local/bin/argocd\n\n# 로그인 후 비밀번호 변경 (기본값은 파드 이름)\nexport ARGOCD_PASSWORD=`kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2`\nargocd login <ARGOCD_SERVER>\nargocd account update-password"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"echo \"test1\"\necho \"test2\"\necho \"test3\""}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"argocd 에서 helm 이용하기 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"argocd app set <name> --values <value.yml>"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"kubernetes-monitoring","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes-monitoring","ariaLabel":"kubernetes monitoring permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"kubernetes monitoring"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://gruuuuu.github.io/cloud/monitoring-02/#"},"children":[{"type":"text","value":"https://gruuuuu.github.io/cloud/monitoring-02/#"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cluster role"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"configmap"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"prometheus deployment"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"node exporter daemonset & service"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"prometheus service"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"configmap... 필요한건가"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"istio","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#istio","ariaLabel":"istio permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"istio"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"하나의 팟 관리를 위해 각 팟마다 관리용 팟을 생성하는 사이드카 패턴을 이용해서 각 서비스를 관리\n관리용 팟이 들어오고 나가는 네트워크를 모두 처리함으로써 로깅, 모니터링,\n디스커버리 모두 가능해진다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"리소스 사용이 2배가 되겠네?\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"경량 프록시라서 리소스가 2배는 아니다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"envoy를 이용해 프록시를 한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"파일럿을 통해 디스커버리, 로드밸런싱"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"시타델을 이용해 인증서, 키 관리"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"서비스 메시가 있으면 서비스는 통신에 신경 쓸 필요가 없나?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"통신은 메시지로 하고, 서비스 통신의 프록시를 해준다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"istio 자체의 gateway를 이용해 라우팅 할 수 있다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"istio-설치","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#istio-%EC%84%A4%EC%B9%98","ariaLabel":"istio 설치 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"istio 설치"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"curl -L https://istio.io/downloadIstio | sh -\ncd istio-1.9.0\nexport PATH=$PWD/bin:$PATH\nistioctl install --set profile=demo -y"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"side inject enable"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl label namespace default istio-injection=enabled\nkubectl label namespace istio-system istio-injection=enabled"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"apply bookinfo\napply bookinfo-gateway\napply grafana, prometheus"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"export INGRESS_HOST=$(minikube ip)\nexport INGRESS_PORT=$(kubectl get svc istio-ingressgateway -n istio-system \\\n                    -o jsonpath='{.spec.ports[?(@.name==\"http2\")].nodePort}')\nexport GATEWAY_URL=$INGRESS_HOST:$INGRESS_PORT"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"bookinfo 가 과부하를 일으킨다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"istio-routing--tag-tagtag-값-적용시키기","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#istio-routing--tag-tagtag-%EA%B0%92-%EC%A0%81%EC%9A%A9%EC%8B%9C%ED%82%A4%EA%B8%B0","ariaLabel":"istio routing  tag tagtag 값 적용시키기 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"istio routing /, /tag, /tag/:tag 값 적용시키기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"httpbin 이라는 서비스로 istio가 예제를 제공해주고 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"이걸로 테스트하니까 match로 지정해주지 않아도 하위 url도 다 전달해준다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"여기에 ingress를 달아주니까 주소기반으로 라우팅도 된다.\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"같은 호스트로 인그레스를 달아주니까 두 서비스를 섞어서 라우팅해준다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ingress에서 path를 /header로 지정해주면 /header로 찾아간다\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"주소를 /v2로 해놓았을 때 v2라는 주소가 없으면 루트로 찾아가나?\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"/, /aaa가 설정되있으면 /ccc를 넣어도 / 가 있어서 /로 인식한다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"whoami 서비스는 이상한 주소로 넣어도 다 받아주고, httpbin은 url\n못찾는다는 에러를 준다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ingress에서 지정해주는 주소가 루트로 인식하는 줄 알았는데, 그게 아니라\n매칭을 해주는거였다.\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"traefik에서는 원하는 주소를 넣을 수 있어서 헷갈렸던 것 같다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ingress에서 여러 주소를 한 서비스에 넣으려면 콤마(,)로 구분하면 된다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"knative-istio","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#knative-istio","ariaLabel":"knative istio permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"knative istio"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"before use knative, install istio first."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"spinnaker","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#spinnaker","ariaLabel":"spinnaker permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"spinnaker"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"spinnaker 설치를 halyard를 통해서 해야 한다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"mkdir -p ~/.hal/kube\ncp ~/.kube/config ~/.hal/kube/config\nchmod 755 ~/.hal/kube/config\n\ndocker run -p 8084:8084 -p 9000:9000 \\\n    --name halyard --rm \\\n    -v ~/.hal:/home/spinnaker/.hal \\\n    -it \\\n    us-docker.pkg.dev/spinnaker-community/docker/halyard:stable\n\ndocker exec -it halyard bash\n\n### initial in container\n$ source <(hal --print-bash-completion)\n$ hal config provider kubernetes enable\n$ hal config provider kubernetes account add <my-account> \\\n    --context $(kubectl config current-context)\n$ hal config features edit --artifacts true\n$ hal config deploy edit --type distributed --acount-name <my-account>"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"set persistent store"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"we will use minio, why?"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"install minio"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm install minio -n spinnaker \\\n    --set accessKey=<access_key> \\\n    --set secretKey=<secret_key> \\\n    stable/minio"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"spinnaker deploy"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"$ hal deploy apply\n! failed check for namespace/spinnaker is null\n> kubectl get pod >> error >> no search file or directory '/home/sh/.minikube/'\n>> cp -r ~/.minikube ~/.hal/\n\n### open access ip\nkubectl edit svc spin-deck -n spinnaker\n# edit ClusterIP to NodePort,\n# add nodePort: 30900\n\nkubectl edit svc spin-gate -n spinnaker\n# edit ClusterIP to NodePort,\n# add nodePort: 30808\n\n$ hal config security ui edit \\\n    --override-base-url \"http://<HOST_IP>:30900\"\n$ hal config security api edit \\\n    --override-base-url \"http://<HOST_IP>:30808\"\n$ hal deploy apply"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"connect to '<HOST_IP>:30900' in browser"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"kubernetes를-쓰면서-쉽게-실수하는-10가지","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes%EB%A5%BC-%EC%93%B0%EB%A9%B4%EC%84%9C-%EC%89%BD%EA%B2%8C-%EC%8B%A4%EC%88%98%ED%95%98%EB%8A%94-10%EA%B0%80%EC%A7%80","ariaLabel":"kubernetes를 쓰면서 쉽게 실수하는 10가지 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"kubernetes를 쓰면서 쉽게 실수하는 10가지"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"리소스 설정 (cpu, memory)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"헬스 체크(liveness, readiness)의 차이에 따른 사용"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"모든 서비스에 로드밸런서 달아버리는 것"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"쿠버네티스가 모르는 자동확장(?)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"권한 관리 부재"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Anti Affinity 설정(pod가 node에 분산해서 실행하지 않으므로 명시적 설정 필요)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"PodDisruptionBudget 설정(pod 최소필요량(minAvailable))"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"클러스터 공유(네임스페이스는 환경 분리가 안되므로 차라리 클러스터를 나눠라)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"externalTrafficPolicy: Cluster"}]},{"type":"text","value":" 설정은 네트워크 지연을 일으킬 수 있다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"클러스터를 애완동물처럼 다루기 + 마스터에 너무 큰 부하주는 것"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"+1. latest tag 사용하는 것"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://coffeewhale.com/kubernetes/mistake/2020/11/29/mistake-10/"},"children":[{"type":"text","value":"https://coffeewhale.com/kubernetes/mistake/2020/11/29/mistake-10/"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"kubernetes-in-vcnc","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes-in-vcnc","ariaLabel":"kubernetes in vcnc permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"kubernetes in VCNC"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"상용 kubernetes를 위한 추가 도구"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ingress - ingress controller"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"nginx vs aws nlb"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Class ELB는 동시에 많은 연결을 처리하려면 웜업이 필요하다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"nlb는 gRPC를 지원하지 않는다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"트래픽 흐름: NLB - NodePort - NGINX ingress controller - service\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"외부 로드밸런서를 추가하는 것이 클러스터 오토스케일러를 추가하는 것처럼\n불가피한 것일까"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"AWS IAM을 사용하기 위해 kube2iam 사용 (19년 03월) -> EKS에서는 지원될 듯"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"로그"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"fluentd를 daemonset으로 노드마다 실행해서 cloudwatch로 전송"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/fluent/fluentd-kubernetes-daemonset"},"children":[{"type":"text","value":"https://github.com/fluent/fluentd-kubernetes-daemonset"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"모니터링"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://engineering.vcnc.co.kr/2019/03/kubernetes-on-aws/"},"children":[{"type":"text","value":"https://engineering.vcnc.co.kr/2019/03/kubernetes-on-aws/"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"eks-참고사항","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#eks-%EC%B0%B8%EA%B3%A0%EC%82%AC%ED%95%AD","ariaLabel":"eks 참고사항 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"eks 참고사항"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"쿠버네티스 버전 업 시 전체 노드 새로 올린다?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"EKS의 파드들이 IAM을 인증받는 방법은?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"kube2iam"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"EKS에서는 워커 노드 당 Pod 개수 제한이 있다 - flannel을 쓰면 해결되지만 기본은\n제약이 있다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ECS, fargate, lambda 차이는?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Fargate: 서버리스 컨테이너"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"AZ, multi region도 지원해주나?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"네트워크 구조"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Region - VPC(논리적) - subnet - AZ - route table - Security groups -"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"vpc, subnet, route table 각각 cidr을 설정 가능하다?"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"nginx-ingress deprecate 됐고, ingress-nginx를 쓰게 된다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"eks에서도 kubernetes metrics-server를 통해서 오토스케일링 조절하나?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"cluster autoscaler라는게 있다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"부하 테스트\n"},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"ab -c 200 -n 200 -t 30 http://$(kubectl get ingress/backend-ingress -o jsonpath='{.status.loadBalancer.ingress[*].hostname}')/contents/aws"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{"className":["contains-task-list"]},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{"className":["task-list-item"]},"children":[{"type":"element","tagName":"input","properties":{"type":"checkbox","disabled":true},"children":[]},{"type":"text","value":" provider \"kubernetes\"는 뭐지"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"배포-후-롤백-테스트","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EB%B0%B0%ED%8F%AC-%ED%9B%84-%EB%A1%A4%EB%B0%B1-%ED%85%8C%EC%8A%A4%ED%8A%B8","ariaLabel":"배포 후 롤백 테스트 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"배포 후 롤백 테스트"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"지금 서버에 버전 두 개 만들어서 올리고 배포 후, 테스트하고 롤백하는 것 10초 컷\ngif로 만들어보기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker build -t <image:tag> .\ndocker push <image:tag>\nkubectl set image deployment/<name> <name>=<image:tag> --record\nkubectl rollout history deployment/<name>"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"띄워져 있어야하는 팟 개수 / 현재 개수 확인 바로 할 수 있는 방법은?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl get deploy -A"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"카오스 툴 띄워서 회복 잘 하는지 테스트"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"동작안함..ㅠㅠ"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"helm을-안쓰고-kubernetes로-가변적인-배포를-쉽게-할-수-없을까","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#helm%EC%9D%84-%EC%95%88%EC%93%B0%EA%B3%A0-kubernetes%EB%A1%9C-%EA%B0%80%EB%B3%80%EC%A0%81%EC%9D%B8-%EB%B0%B0%ED%8F%AC%EB%A5%BC-%EC%89%BD%EA%B2%8C-%ED%95%A0-%EC%88%98-%EC%97%86%EC%9D%84%EA%B9%8C","ariaLabel":"helm을 안쓰고 kubernetes로 가변적인 배포를 쉽게 할 수 없을까 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"helm을 안쓰고 kubernetes로 가변적인 배포를 쉽게 할 수 없을까"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"helm에 install --values도 values 파일을 작성해야하는데, 이러면 그냥 kubernetes\nsnippet으로 만들어도 큰 차이는 없을 것 같다...\n괜히 helm을 안깔아도 될 것 같은데"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"gist에 파일을 올려놓고, 설정파일에 이름을 넣어서 이름 확인해서 어떤 gist를\n가져올지만 정해서 불러와서 실행시키면 되겠다.\ngitkube라는 서비스도 있다. kubernetes 안에다가 리소스를 만들어놓고 감시하는\n컨셉이다"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이제 세부적인 설정이 필요해지면 어떻게 수정하지"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"클러스터-네임스페이스-컨텍스트","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EB%84%A4%EC%9E%84%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8","ariaLabel":"클러스터 네임스페이스 컨텍스트 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"클러스터 네임스페이스 컨텍스트"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"컨텍스트 안에 클러스터, 사용자, 네임스페이스가 있음"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"$KUBECONFIG 에 새로 생성한 config 파일을 넣으면 --kubeconfig config-demo 명령어를 안쳐줘도 됨"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"bash"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-bash"]},"children":[{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"source"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":"<"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":"("}]},{"type":"text","value":"kubectl completion "},{"type":"element","tagName":"span","properties":{"className":["token","function"]},"children":[{"type":"text","value":"zsh"}]},{"type":"element","tagName":"span","properties":{"className":["token","punctuation"]},"children":[{"type":"text","value":")"}]},{"type":"text","value":"  "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 현재 셸에 zsh의 자동 완성 설정"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"span","properties":{"className":["token","builtin","class-name"]},"children":[{"type":"text","value":"echo"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","string"]},"children":[{"type":"text","value":"'[[ $commands[kubectl] ]] && source <(kubectl completion zsh)'"}]},{"type":"text","value":" "},{"type":"element","tagName":"span","properties":{"className":["token","operator"]},"children":[{"type":"text","value":">>"}]},{"type":"text","value":" ~/.zshrc "},{"type":"element","tagName":"span","properties":{"className":["token","comment"]},"children":[{"type":"text","value":"# 자동 완성을 zsh 셸에 영구적으로 추가한다."}]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h5","properties":{"id":"새로운-유저로-get-pod-하기","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%9C%A0%EC%A0%80%EB%A1%9C-get-pod-%ED%95%98%EA%B8%B0","ariaLabel":"새로운 유저로 get pod 하기 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"새로운 유저로 get pod 하기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"인증서 등록"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"config-demo 만들기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"role 만들기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"roleBinding 만들기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"CSR 만들기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"인증서 approve 하기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"auth can-i 실행해서 확인"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"\u001f"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h5","properties":{"id":"인증서-재설정-필요","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%9E%AC%EC%84%A4%EC%A0%95-%ED%95%84%EC%9A%94","ariaLabel":"인증서 재설정 필요 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"인증서 재설정 필요"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"minikube 재시작 후 서버 포트 변경됨"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"minikube context에서"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"openssl genrsa -out developer.key 2048"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"openssl req -new -key developer.key -out developer.csr -subj \"/CN=developer\""}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"k apply CSR.yaml"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"k certificate approve developer"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"k auth can-i list pods --as developer"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"kubernetes-external-library-installation","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kubernetes-external-library-installation","ariaLabel":"kubernetes external library installation permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Kubernetes External Library Installation"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"설치","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#%EC%84%A4%EC%B9%98","ariaLabel":"설치 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"설치"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"curl -s https://packages.cloude.google.com/apt/doc/apt-key.gpg | apt-key add -"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/etc/apt/sources.list.d/kubernetes.list"}]},{"type":"text","value":" 파일에\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"deb https://apt.kubernetes.io/ kubernetes-xenial main"}]},{"type":"text","value":" 입력"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"apt-get update && apt-get install -y apt-transport-https curl"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"apt-get install kubelet kubeadm kubectl"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sudo swapoff -a"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sed -i '9s/^/Environment=\"KUBELET_EXTRA_ARGS=--fail-swap-on=false\"\\n/' /etc/systemd/system/kubelet.service.d/10-kubeadm.conf"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sudo sed -i '/ swap / s/^\\(.*\\)$/#\\1/g' /etc/fstab"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"초기화"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubeadm init --pod-network-cidr=10.244.0.0/16 --ignore-preflight-errors Swap"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"네트워크 설치"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"flannel\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl apply -f https://github.com/coreos/flannel/raw/master/Documentation/kube-flannel.yml"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"calico\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl apply -f https://docs.projectcalico.org/v3.10/manifests/calico.yaml"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"weave\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl apply -f \"[https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')](https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n'))\""}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"flannel 설치 시 coredns 안붙음.\ncalico로 설치\n"},{"type":"element","tagName":"a","properties":{"href":"https://docs.projectcalico.org/v3.10/getting-started/kubernetes/"},"children":[{"type":"text","value":"https://docs.projectcalico.org/v3.10/getting-started/kubernetes/"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Slave node 접속"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubeadm join 192.168.0.3:6443 --token 8nt7ze.bm7pa8pi3t1jgr70\\ --discovery-token-ca-cert-hash  sha256:4337d62bce67b7ebf55466da74dfa8deb7cda3632ce5054bcc24b1fe3fcf2bff"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"token 생성 및 확인"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubeadm token create"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Node 제거"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl delete node <node-name>"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Master reset"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubeadm reset"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"scale 늘리기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl scale deploy <deploy_name> --replicas=10"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"helm-1","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#helm-1","ariaLabel":"helm 1 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"helm"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"kubernetes package manager"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"curl https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get | cat > /tmp/helm_script.sh \\ && chmod 755 /tmp/helm_script.sh && /tmp/helm_script.sh --version v2.8.2 helm init --upgrade"}]},{"type":"text","value":"\n출처: "},{"type":"element","tagName":"a","properties":{"href":"https://sktelecom-oslab.github.io/Virtualization-Software-Lab/Helm/"},"children":[{"type":"text","value":"https://sktelecom-oslab.github.io/Virtualization-Software-Lab/Helm/"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl create serviceaccount --namespace kube-system tiller"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm init --service-account tiller --upgrade"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm update repo"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm install stable/redis --version 3.3.5"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"repo 추가"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"helm repo add stable https://kubernetes-charts.storage.googleapis.com/"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"출처: "},{"type":"element","tagName":"a","properties":{"href":"https://stackoverflow.com/questions/43499971/helm-error-no-available-release-name-found"},"children":[{"type":"text","value":"https://stackoverflow.com/questions/43499971/helm-error-no-available-release-name-found"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"helm init"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"search"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"install"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"repo update"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"list"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"delete"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"kompose","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#kompose","ariaLabel":"kompose permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Kompose"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"docker-compose to kubernetes yaml\n출처: "},{"type":"element","tagName":"a","properties":{"href":"https://kubernetes.io/docs/tasks/configure-pod-container/translate-compose-kubernetes/#build-and-push-docker-images"},"children":[{"type":"text","value":"https://kubernetes.io/docs/tasks/configure-pod-container/translate-compose-kubernetes/#build-and-push-docker-images"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"curl -L https://github.com/kubernetes/kompose/releases/download/v1.21.0/kompose-linux-amd64 -o kompose\nchmod +x kompose\nsudo mv ./kompose /usr/local/bin/kompose\nkompose up\nkompose convert\nkubectl apply -f <file>\nkompose down"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"statefulset-pv-sc","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#statefulset-pv-sc","ariaLabel":"statefulset pv sc permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"Statefulset PV SC"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Statefulset을 사용하기 위해 pv를 만들어야 하고\npv를 만들기 위해서 storageclass가 필요"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"storageOS 설치\n출처: "},{"type":"element","tagName":"a","properties":{"href":"https://docs.storageos.com/docs/platforms/kubernetes/install/1.10"},"children":[{"type":"text","value":"https://docs.storageos.com/docs/platforms/kubernetes/install/1.10"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"SC default 설정"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl patch storageclass fast -p '{\"metadata\": {\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"true\"}}}'"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"출처: "},{"type":"element","tagName":"a","properties":{"href":"https://proinlab.com/archives/2308"},"children":[{"type":"text","value":"https://proinlab.com/archives/2308"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"SC default 해제"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"kubectl patch storageclass <your-class-name> -p '{\"metadata\": {\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"false\"}}}'"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"glusterfs pv pvc 예제"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://teamsmiley.github.io/2019/06/29/kubernetes-glusterfs/"},"children":[{"type":"text","value":"https://teamsmiley.github.io/2019/06/29/kubernetes-glusterfs/"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://docs.okd.io/latest/install_config/storage_examples/gluster_example.html"},"children":[{"type":"text","value":"https://docs.okd.io/latest/install_config/storage_examples/gluster_example.html"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h4","properties":{"id":"glusterfs-설치","style":"position:relative;"},"children":[{"type":"element","tagName":"a","properties":{"href":"#glusterfs-%EC%84%A4%EC%B9%98","ariaLabel":"glusterfs 설치 permalink","className":["anchor","before"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]},{"type":"text","value":"glusterfs 설치"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"gfs1, gfs2 라는 서버가 있다고 하자."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"양쪽 서버에서 /etc/hosts에 host 이름 둘 다 적어준다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"text"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-text"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sudo apt-get install software-properties-common\nsudo add-apt-repository ppa:gluster/glusterfs-5\nsudo apt-get update\nsudo apt install glusterfs-server\nsudo ufw allow proto any from <상대아이피> to <자신아이피>\nsudo service glusterd start\n\nsudo gluster peer probe gfs2 # gfs1에서는 gfs2를, gfs2에서는 gfs1을 둘 다 입력\nsudo mkdir -p /gluster/fs\nsudo gluster volume create vol replica 2 transport tcp gfs1:/gluster/fs gfs2:/gluster/fs force\n# (루트 파티션에는 볼륨 설정 안하기를 권하고 있으나 강제로 가능)\n\nsudo gluster volume start vol\nsudo mkdir -p /mnt/gluster\nsudo mount -t glusterfs <자신아이피>:/vol <마운트할 폴더> # (양쪽 서버에서 실행)"}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"/gluster/fs/ 는 파일 저장되는 공간"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"/mnt/gluster 는 마운트 시켜서 사용하는 공간"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"/etc/fstab에 추가"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"gfs1:/vol /mnt/gluster glusterfs defaults,_netdev 0 0"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"peer 추가 시"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"gluster volume add-brick glus_vol gluster5:/data1/gluster gluster6:/data1/gluster"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"출처: "},{"type":"element","tagName":"a","properties":{"href":"http://junhyung2.blogspot.com/2014/12/7-glusterfs.html"},"children":[{"type":"text","value":"http://junhyung2.blogspot.com/2014/12/7-glusterfs.html"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"volume 삭제"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"gluster volume remove-brick vol_dist vmlnx005:/data"}]}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"출처: "},{"type":"element","tagName":"a","properties":{"href":"http://blog.syszone.co.kr/3038"},"children":[{"type":"text","value":"http://blog.syszone.co.kr/3038"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Glusterfs 로 data volume 구성.\n볼륨형태"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Replication : 완전 복제"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Distributed : 분산 저장, 파일별로 분산"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Striped     : 완전 분산 저장, 하나의 파일도 분산, I/O 성능 향상, 하나의 서버가 죽으면 파일 유실"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Volume2가 꺼졌다가 켜지면 동기화가 어떻게 되는지?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"목표"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"스웜으로 두개를 킨 후 하나의 서버를 종료 시켜도 접속 가능하게"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"DB 컨테이너 생성 시 볼륨을 시킨다"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"[[Troubleshooting#kubernetes]]"}]}],"data":{"quirksMode":false}},"rawMarkdownBody":"\n# Container\n\n#### docker strength\n- isolation process\n- no dependency\n- portable\n- light-weight\n\n#### Docker image vs compose\n- image vs volume\n    - test with volume, deploy with image\n\n#### docker logs\n- make stdout\n  - `echo \"test\" >> /proc/1/fd/1`\n- `--log-opt`\n  - `max-size`\n  - `max-file`\n\nFluentd와 Eleasticsearch를 이용해서 로그 수집 및 검색\n\n표준출력(stdout)으로 로그를 출력하도록 두고, 이를 수집하도록 한다.\n\nnginx는 stdout으로 출력되도록 설정이 필요하다\n- 1.19.8 버전을 쓰는 지금은 stdout으로 출력되도록 설정되어있다.\n\n#### container\nlibcontainer 개발로 kernel에서 namespaces, cgroups 등을 직접 실행\nLXC -> runC 컨테이너 런타임 변경. OCI 준수\n그 외 rkt, cri-o 등이 있음\n\nLXC는 다른 호스트에서 실행했을 때 설정 차이로 동일하게 돌아가지 않는 경우가\n있었다고 한다.\n도커도 버전 다르면 안돌아간다.\n\nContainer 구동 원리\n- `chroot` - 입력받은 디렉토리를 루트로 하여 격리된 환경을 만들어준다\n- cgroups - 시스템 리소스를 격리할 수 있다(cpu, memory, network, disk)\n- overlayFS - 프로세스 간 파일 시스템 분리\n    - image layer + container layer(컨테이너 안에서 수정되는 파일들)\n- namespace - `unshare` 프로세스 간 시스템 자원들을 격리하는 기능\n    - cgroup - `-C`\n    - user - `-U`\n    - mnt - `-m`\n    - ipc - `-i` 프로세스 간 통신. 같은 네임스페이스 안에 있어야 통신 가능\n    - pid - `-p` 컨테이너 안에서는 프로세스 번호를 새롭게 받는다\n    - uts - `-u` hostname 격리\n    - net - `ip netns add <ns name>` 네트워크 규칙들을 새롭게 받는다\n- https://speakerdeck.com/devinjeon/containerbuteo-dasi-salpyeoboneun-kubernetes-pod-dongjag-weonri?slide=29\n\n네임스페이스와 컨테이너, 네트워크까지 잘 정리된 링크\n- https://www.44bits.io/ko/keyword/linux-namespace\n\n#### Docker의 위기?\n- container is light-weight and portable more than virtual machine image\n- but it can same work that PC's work\n- Can exist more than light-weight task from docker?\n\n- OCI(Open Container Initiative)\n- Container Runtime\n- Image Download -> Extract Image -> Execute Container\n- Container has cgroups, namespace, networking\n- alternative to Buildah, skopeo, podman\n  - docker is one big process. It can make single point of failure.\n  - divide docker position by 3.\n\n#### Dockerfile\n- 바이너리를 도커파일에서 받을 때 체크섬을 검증하는 내용을 적으면 이미지의 신뢰성이 올라간다\n- 루트 대신 사용자 추가하는 내용을 디폴트로 한다\n    - `RUN useradd sam`\n    - `USER sam`\n    - 간단하다\n- docker.sock은 호스트의 도커 컨테이너 관리를 장악할 수 있다\n- dockerfile에 locale, time 등 설정 해두는게 좋지 않을까\n\n#### docker compose에서 빌드 단계의 이미지를 쓸 수 있을까\nDockerfile은 멀티 빌드로 해놓고 배포시에는 마지막 빌드 이미지를 쓰지만\n개발 시에는 빌드한 것으로 쓰고 싶은데\n```\nbuild\n  context: ./\n  target: build\n```\nbuild에 target으로 이름 맞춰주면 된다.\n\n#### docker-compose를 이용해 이미지를 바로 배포하는 것과 Dockerfile을 쓰는 것\ndockerfile 없이 이미지로만 할 때의 문제점?\n- 어떤 것을 바꿨는지 추적하기 힘들다\n- 설치파일들 찾기 힘들다\n- docker layer와 image size를 줄일수록 배포가 빨라지는 도커의 장점을 이용못한다.\n\ndockerfile로 하면 쿠버네티스 사용 시 이미지 빌드를 또 해줘야 하잖아?\n이미지로 올리는 경우는 왜 이미지로 올리는거지?\n\n볼륨을 해도 커밋 시 볼륨된 내용은 적용 안되고, 기존 이미지가 갖고 있던대로 된다\n\ndockerfile에서 copy를 한 폴더를 외부에서 수정 후 내부에 들어가면 수정되어 있나?\n- No\n\nbuild - docker file to image\ndocker-compose up 을 하면 이미지를 새로 부른다? volume\n\ndockerfile -> image -> pods\nbuild -> push -> kubernetes apply(set image)\n\n개발환경에서는 볼륨을 해서 compose로 개발하고\n배포 시에는 Dockerfile을 이미지화해서 배포한다\n개발디렉토리는 Dockerfile에도 COPY에 있어야하고, compose에도 볼륨을 한다.\n개발환경에서 쓰는 이미지는 배포 시 쓰는 이미지와 같은 것을 사용한다.\n이미지 빌드는 CD pipeline을 통해서 한다. 이미지 혼동을 막기 위해\n- [ ] 이미지를 기반으로 작업을 하면 이미지가 업데이트 되었는데 이전 버전으로\n      작업하던 사람들은?\n- [ ] 최초 작업 시 이미지가 없어서 compose를 실행 못시키니, 빌드 파이프라인을 먼저 만든다?\n\n내가 원하는게 디렉토리 전체를 덮어쓰는게 아니라 일부만 수정하는 거라서 좀 꼬였다\n- [ ] 일일이 COPY를 해야 하나? compose에서는 어떻게?\n\n```\nDockerfile\nCOPY /app /app\n\n---\n\ndocker-compose.yml\nvolume: /app:/app\n```\napp 폴더의 내용을 수정 후 docker build나 compose up을 하면 동일한 상태가 된다.\n\n서버 설치: vagrant up (git pull -> [docker-compose up or kubectl apply])\n서버 수정: git pull -> docker-compose up -> 수정 -> 테스트 -> git push -> 서버 적용\n\n서버 개발: git pull -> docker-compose up -> 수정 -> 테스트 -> git push\n서버 업데이트: git pull -> docker-compose up\n\n실서버에서도 볼륨으로 돌릴까? 순수 이미지로만 돌릴까?\n실서버에서도 수정을 하고 싶은데 다른 회사들은 어떻게 하지? 실서버는 안건드리는게\n좋으려나?\n그러면 compose.yml을 두개를 만들어야 하나\n실서버에서도 그냥 볼륨을 하면 어떨까?\n\n실서버에서 수정을 하는게 편하지만 절대로 하면 안된다고 권고한다\n번거롭더라도 재빌드 재배포를 하라고 한다\n그렇다면 핫픽스를 최대한 빨리 배포할 수 있도록 해야 하는데\n쿠버네티스에는 명령어 하나로 되돌릴 수 있다\n깃헙 액션으로 바로 되돌릴 수 있어야 한다\n핫픽스 or 롤백\n\n배포는 ansible로 github action 하면 되겠다\n근데 ansible로 하면 서버 private key가 필요한게 번거롭다\n그렇다고 vault서버에서 가져오는 것도 private key를 관리해야되서 번거롭다\n보안은 번거롭지만 해야되긴 한다\n\n#### 배포 뼈대 만들기\nkubernetes 버전\ndocker image 버전\n\n최소 docker image로 빌드하고, 여유가 있으면 kubernetes를 이용\nCI로 간단 검증\nCD는 ansible 또는 argoCD\n핫픽스룰을 따로 만들어 둔다.\npush를 하면 검증을 한다\n1. commit, 2. merge, 3. hotfix\n\n- [ ] 빌드 요청은 어떻게?\n- [ ] 버저닝은 어떻게?\n\n#### docker image\nalpine, stretch, slim, buster\nbuster, stretch는 debian용\nalpine은 alpine linux로 만든 것\nslim은 그 이미지를 실행하기 위한 최소한의 설치파일만 있는 것\n\n근데 slim보다 alpine이 더 이미지 크기는 작다?\n\n#### docker compose execute bash\n- `entrypoint: /bin/bash` failed\n- `tty:true; stdin_open:true` success\n- `docker-compose run app bash` success\n\n#### docker cmd vs entrypoint\n커맨드 툴을 도커명령어에서 바로 실행하려고 하면\nCMD로 하면 안되고 ENTRYPOINT로 하면 된다\n`docker run hanspell-cli -h`\n\n대신 ENTRYPOINT를 쓰면 -it /bin/sh 는 인식을 못한다\n\n#### docker 간 통신\n- compose 에서 네트워크 명시적으로 설정해줘서 compose에 설정한 이름으로 통신하면 된다고 한다\n- --network host 를 써도 된다고 한다\n- docker buildx build --network host --platform linux/arm64 -t goodby .\n- https://marshallku.com/dev/deploy-rust-with-docker\n\n# Kubernetes\nA person has a very small component, and it composes of one architecture.\nthe kuberetes seem to be this.\nand I want to make software like this architecture.\nstrong small component to flexible architecture.\nkubernetes makes easy to a devops works\nabout deploy, scaling, update, healthcheck, orchestration\nbut devops works is not clear.\n\n- `kubectl run curl --image=radial/busyboxplus:curl -i --tty`\n- pods cluster inside curl pod\n\nkeep focusing only bisuness logic\n- 1. monitoring - feedback - update logic\n- 2. data management\n- production deploy behavior make easy\n  - update and rollback\n  - scale up and down\n\nhttps://github.com/dennyzhang/cheatsheet-kubernetes-A4/blob/master/README.org\n- ClusterIP vs NodePort vs Ingress\n- service account?\n- cluster role?\n- cluster? - node\n- daemon set?\n  - it makes every node to make pods\n  - example: every node can have logstash\n\n#### resource\n- pods\n- replicaset\n- deployment\n- service\n\n컨테이너 리소스\n- pod, deployment\n\n보안 리소스\n- rolebinding\n\n설정 리소스\n- configmap\n\n#### api\n- master\n    - kube-apiserver\n    - kube-scheduler\n    - kube-controller\n    - kubelet\n    - kube-proxy\n    - etcd\n- node\n    - kubelet\n    - kube-proxy\n\n#### 쿠버네티스는 os와 클라우드를 추상화할 수 있나?\n서비스의 장애가 os에 영향을 미쳐도 서비스를 격리하면 문제가 해결될 수 있나?\n그렇다면 '쿠버네티스', '마이크로서비스', '데이터'가 소프트웨어의 큰 줄기가 될 수 있다\n원래는 인프라, 서비스, 데이터인 것을 쿠버네티스가 인프라를 완전 대체?\n\n#### kubernetes volume\n특정 노드의 폴더를 사용할 때는 hostPath를 사용할 수 있다.\n근데 노드 상관 없이 폴더를 써야하는 경우가 대부분일 것이다\n\n#### 쿠버네티스 네트워크의 이해\n팟들끼리의 통신은 veth 을 통해서 하게 된다 eth0 -> docker0 -> veth0\n그리고 eth0이 어떤 veth0과 연결되어 있는지 라우팅 테이블이 존재한다\n하지만 팟은 언제든 사라졌다가 다시 생겨날 수 있어서 이를 추상화하는 레이어가 하나 필요하고 이것을 service로 만들었다\n(IP 네트워크는 보통 자신의 host에서 목적지를 찾지 못하면 상위 게이트웨이로 전달하도록 동작)\nservice는 리눅스 커널 기능인 netfilter와 iptables를 이용한다\nkube-proxy라는 녀석도 같이 동작에 관여하는데 얘는 netfilter에 규칙을 수정하는 역할만 하고 실제 동작은 netfilter에서 이루어진다\n클러스터 외부에서 트래픽을 내부로 전달하고 싶다면 로드밸런서를 이용한다\n외부에서 요청이 오면 NodePort를 거쳐서 내부 Node의 ip를 찾게 되고 이것이 다시 netfilter를 거쳐서 팟을 찾을 수 있게 된다\n하지만 NodePort를 확장한 LoadBalancer Service도 제약사항이 있는데 한개의 로드밸런서가 여러 서비스를 연결하지 못한다는 점이다.\n그래서 ingress가 나왔다\ningress는 그래서 한개의 로드밸런서로 여러 서비스를 유연하게 설정할 수 있게 해준다\ningress는 ingress-controller가 동작하게 해야하고, 각 클라우드 플랫폼 마다 ingress-controller 구현체가 있다\n\n#### deploy\n- 배포와 릴리즈를 분리\n  쿠버네티스에 apply를 해도 실제 서버에 바로 적용되는게 아니라 서비스 메시에서\n  릴리즈를 관리 -> istio를 이용\n- 서비스 키고 시간이 지나면 api 접속이 안됨\n- istio, monitoring, argocd 켜놨는데 어디가 리소스 많이 먹는지 알고 싶다\n\n#### deployment kill\ndeployment 정지시키려면 scale --replicas=0 으로 해야되나보다\n- pod을 삭제하는 건 kill로 한다\n\n#### kubernetes test\n- local test, production build pipeline\n- local test with only dockerfile\n- local test with same with production\n- In msa. need kubernetes?\n- In msa. github repo is seperated?\n- developer can build docker image?\n- how to provide docker image to developer?\n- when developer push updated source. pipeline is\n    - kubernetes apply?\n- build with tags?\n    - git tag 1.0.0\n    - git push origin --tags\n- hpa\n- service\n- minikube\n\n#### 쿠버네티스 클러스터 중에 마스터가 자원을 많이 쓰나, 노드가 많이쓰나?\nmaster\n- api server, etcd 등 기본적으로 자원을 많이 사용한다.\n\n서비스가 빡세게 돌면 노드가 많이쓰나?\n\n쿠버네티스 로그 서비스 추가해서\n노드 하나를 일부러 끄면 로그 잘 남는지 확인하고\n죽은 서버를 살릴 수 있을지 확인\n\nram 1기가 서버에 ram 0.5를 쓰는 서비스를 6개를 레플리카하면 동작하나?\n- 자원 한도 넘어가면 파드를 안 만든다.\n\n글러스터fs 와 db 레플리케이션을\n쿠버네티스에서 편하게 할 수 있는 방법이 있나?\n\n클러스터를 한번씩 껐다 켜서 리프레시 했을때 안좋은점이 있을까?\n없다면 접속자 적은 시간을 뽑아서 한 서버씩 재부팅 해줘야겠다\n페일오버 테스트도 되고, os도 리프레시 되지 않을까\n\n걱정되는 점은 한쪽 노드에 팟들이 몰려있다가 다시 돌아갈 때 과부하 걸리지 않을지\n\n#### 쿠버네티스는 어떻게 복잡성을 관리하는가\n- ingress -> service -> deployment 식의 계층적 추상화\n- namespace 격리\n- controller pattern - 이건 좀 더 찾아보자\n\t- 각 리소스별 전용 컨트롤러가 상태 관리\n\t- 단일 책임 원칙으로 복잡성 분산\n\t- Reconciliation Loop로 일관된 동작 보장\n- Operator pattern\n\t- 도메인 특화 로직을 CRD로 추상화\n\t- 인간의 운영 지식을 코드로 전환\n- 그치만 쿠버네티스도 한계가 있다\n\t- 노드 수 제한도 있고\n\t- API 서버가 초당 수천개 요청에서 성능 저하하는 처리량 한계도 있다\n\t- 컨트롤 플레인은 사용량이 선형적으로 증가할 수 밖에 없다\n- 또한 복잡성의 새로운 차원이 있다\n\t- 네트워킹 오버헤드 (CNI 성능 이슈)\n\t- 스토리지 관리 복잡성 증가\n\t- 보안 정책의 기하급수적 복잡성\n\t- 디버깅과 트러블슈팅의 어려움\n- 그래서 클러스터를 분리해야한다\n\t- 팀별 / 환경별\n\t- 그러면 분리된 클러스터도 관리를 쉽게 할 수 있어야 한다\n\t- 하나의 클러스터로 다 하려고 하는건 확장적이지 못하다\n- 하나의 클러스터를 잘 관리할 수 있으면 멀티 클러스터도 관리할 수 있다\n\n#### 쿠버네티스 멀티 클러스터 그 이후\n- 클러스터간 관리를 하는 중앙 관리가 필요할 것 같다\n- 중앙 클러스터가 있고\n- 도메인별 클러스터를 따로 만든다\n- 도메인별 클러스터에는 최대한 공용 인프라를 안쓰고\n- 중앙 클러스터에서 관리할 수 있도록 한다\n\n\n#### docker kubernetes istio\n| docker   | kubernetes                        | istio                        |\n| -------- | ---------------------             | ---------------------------  |\n| 이식성   | 배포 (단일 배포점, 롤링 업데이트) | 서비스 메시                  |\n| 고립성   | 로드 밸런싱                       | 어플리케이션 api 마다 프록시 |\n| 가벼움   | 서비스 디스커버리                 | 서킷 브레이킹                |\n| 헬스체크 | 스케일링                          | 카오스 테스트                |\n| 페일오버 | 고가용성 확보(3 node)             |                              |\n|          | 확장 시 서버 셋팅 자동화          |                              |\n|          |                                   |                              |\n\n롤백, 자원관리, 모니터링, 시크릿 관리\n\n## Network Resource\n#### nginx vs istio\n- service -> Ingress\n- istio Gateway -> Virtual Service -> Destination Rule\n\n트래픽을 한 곳에서 다 처리하느냐, 각 서비스마다 분리해서 처리하느냐가 큰 차이\n사이드카가 많아져서 생기는 중복 오버헤드가 많을까, 비대해진 하나의 객체가\n오버헤드가 많을까\n내부에 직접 통신하면서 트래픽을 제어할 수 있는 것은 장점\napi gateway의 상위호환이 되려고 한다\n\nistio\n- 트래픽 모니터링 가능\n- 트래픽을 제어할 수 있다\n- 각 서비스마다 분리되어 있어서 단일 고장점이 아니다.\n- retry 및 timeout 동작\n\nnginx(api gateway)\n- 단일 객체\n- 트래픽 제어\n\n#### nginx canary\n```\nmetadata:\n  annotations:\n    nginx.ingress.kubernetes.io/canary: \"true\"\n    nginx.ingress.kubernetes.io/canary-weight: \"20\"\n```\n\n#### kubernetes supports cluster\n- < 5000 nodes\n- < 150000 pods\n- < 300000 containers\n- < 100 pods per node\n\n#### kubernetes access remote cluster\n`scp <user>@<ip>:/home/vagrant/.kube/config ~/.kube/config`\n\n#### kubernetes dns\nkube-dns\ncoredns 1.12 버전부터 사용, 호환성을 위해 라벨링은 kube-dns로 되있다\n\n`myapplication.namespace.svc.cluster.local` 형식으로 되있다\n- https://jonnung.dev/kubernetes/2020/05/11/kubernetes-dns-about-coredns/\n\n## Test\n#### test\n- how to test account system?\n    - check send complete\n    - check response code\n- stress test per process\n    - `while true; do curl http://localhost; done`\n    - hpa\n        - when do switching, connection is waiting?\n    - how to destroy one pod\n    - recovery time in replicaset\n- image to rollup, rollback\n- ci/cd\n\nSpinnaker - build tool\nEnvoy - proxy, c/b, network tool\n\n- [ ] image size is matter for performance?\n\n1. build image\n    - `docker build shdkej/imagename:tag .`\n    - `docker login`\n    - `docker push shdkej/imagename:tag`\n3. deployment, service\n    - `kubectl apply -f file.yml`\n4. test\n    - `kubectl run -it curl --image=radial/busyboxplus:curl `\n    - `curl http://deploy-name:port`\n1. port forward\n    - `kubectl port-forward svc/svc-name 8080:8080`\n2. client run\n3. check some signal\n4. report how many success is\n\ncase 1. normal string output check - 100000 user\n    - for 10000 -> 24s\n    - for 100000 -> 1m30s\n    - goroutine 100000\n        - server can't accept\ncase 2. stream output check\n\n\n파드하나에 접속량을 몰아서 뻣는 경우 테스트\n노드 하나에 몰아서 테스트\n전체에 영향가게 테스트\napi서버가 어떻게 부하를 받는지 확인\n\n\n## Plugin\n#### helm k3s Kubernetes cluster unreachable error\nset `export KUBECONFIG=/etc/rancher/k3s/k3s.yaml`\nhttps://github.com/rancher/k3s/issues/1126\n\n#### eks vs ec2 autoscale and setting kubernetes vs kubernetes hpa\n\n#### container serverless\n- knative, lstio, open-faas\n\n#### k3s\n- token `/var/lib/rancher/k3s/server/node-token`\n- join\n    - `curl -sfL http://get.k3s.io | K3S_URL=https://192.168.0.50:6443 \\ K3S_TOKEN=join_token_we_copied_earlier sh -`\n- connect remotly\n    - `scp root@ip:/etc/rancher/k3s/k3s.yaml ~/.kube/config`\n    - replace 127.0.0.1 -> remote ip\n\n#### k3s monitoring\n- `kubectl apply -k github.com/premist/k3s-kube-prometheus/setup`\n- `kubectl apply -k github.com/premist/k3s-kube-prometheus`\n\n#### k3s helm\n! Kubernetes cluster unreachable\n- `export KUBECONFIG=/etc/rancher/k3s/k3s.yaml`\n- or `kubectl config view --raw >~/.kube/config`\n\n#### k3s connect remotely to the cluster\n```\nmkdir ~/.kube\nscp <user@ip>:/etc/rancher/k3s/k3s.yaml ~/.kube/config\nsed -i '' 's/127\\.0\\.0\\.1/192\\.168\\.0\\.22/g' ~/.kube/config\n```\n\n#### helm\nchart.yml\nvalue.yml\ntemplates/\ncharts/\n\ninstall `helm install <name> <chart>`\n상태 보기 `helm status <name>`\n업그레이드 `helm upgrade -f <value.yml> <name> <folder>`\n지우기 `helm del <name>`\n\n#### helm install from local\n`helm install <name> <directory> --values <values.yaml>`\nor just setting key\n`helm install <name> <directory> --set <key=value,key2=value2>`\n\n#### turn on and access to grafana in kubernetes nodes\n- build kubernetes setup -- vagrant\n- access nginx from just node\n    - `kubectl create deployment --image nginx my-nginx`\n    - `kubectl expose deployment my-nginx --port=80 --type=LoadBalancer`\n- access from master node\n- deploy grafana\n- add kubernetes monitoring script\n\n#### kubernetes load balancer\nmetallb\n\n#### kubernetes network service test\nistio\nconsul\nload balancer\n\n#### kubernetes tool\nchaos-mesh\nspinnaker\nknative\n\n#### deploy\ndeploy spinnaker\n\nkubernetes는 github에서 돌아가야 한다. 근데 로컬에서도 똑같이 할 수 있어야 한다\ngithub action에 종속되지 않고 CI를 하려면 스크립트를 호출하는 방식으로 해야하나\ngithub action server와 비슷한 서버를 만들어서 에러 시 리다이렉트 해야하나\njenkins는 자체 서버를 돌리니까 이를 이용해야 하나\n\n#### 인프라 관련 툴과 서비스 관련 툴을 분리하면 좋을 것 같다\n- 모니터링, 로깅,\n- 보안, 리버스 프록시\n- 실제 로직 구동 앱\n- 미들웨어(카프카)\n\n#### 쿠버네티스 네임스페이스를 어떻게 분리할까\n지금 istio, argocd, monitoring으로 나눠져있는데\n그러면 monitoring에서 다른 네임스페이스를 참조할 수 있나?\n\nproduction 과 development로 나누면 똑같은 파일로 두번 apply하면 되나?\n\n#### kubernetes local image 사용하기\n- `image` 밑에 `imagePullPolicy`를 `Never`로 설정한다\n- minikube 사용 시 `eval $(minikube -p minikube docker-env)` 입력\n- docker image를 새로 빌드해야한다.\n\n#### RBAC\nrole-based access control\nmatching user - role\n\n- ServiceAccount\n- Role\n- RoleBinding\n- ClusterRole\n- ClusterRoleBinding\n\nRole과 ClusterRole의 차이\n- Role은 네임스페이스 하나에만 할당되고 ClusterRole은 여러개가 되며, 허용범위가\n  넓다.\n- Cluster라 함은 Master와 Node의 범위다.\n\nservice account 생성\n```\nkind: ServiceAccount\nmetadata:\n  name: developer1\n  namespace: team1\n```\n\n허용할 api와 리소스, 명령어를 지정해준다\n```\nkind: Role\nmetadata:\n  ...\nrules:\n- apiGroups: ['', 'apps']\n  resources: ['pods', 'deployment']\n  verbs: ['get', 'list']\n```\n\n롤 바인딩 파일에서 서비스 어카운트와 롤을 매칭해준다\n```\nkind: RoleBinding\nmetadata:\n  ...\nsubjects:\n- kind: ServiceAccount\n  name: developer1\n  apiGroup: \"\"\nroleRef:\n  kind: Role\n  name: role-dev\n  apiGroup: rbac.authorization.k8s.io\n```\n\n#### argocd\n```\n# kubernetes에 argocd 올리기\nkubectl create namespace argocd\nkubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml\nkubectl patch svc argocd-server -n argocd -p '{\"spec\": {\"type\": \"LoadBalancer\"}}'\n## port 확인하거나 port-forward 해서 접속 가능\n\n\n# 로그인이나 클라이언트 명령 처리 시 클라이언트 툴 설치\nVERSION=$(curl --silent \"https://api.github.com/repos/argoproj/argo-cd/releases/latest\" | grep '\"tag_name\"' | sed -E 's/.*\"([^\"]+)\".*/\\1/')\ncurl -sSL -o /usr/local/bin/argocd https://github.com/argoproj/argo-cd/releases/download/$VERSION/argocd-linux-amd64\nchmod +x /usr/local/bin/argocd\n\n# 로그인 후 비밀번호 변경 (기본값은 파드 이름)\nexport ARGOCD_PASSWORD=`kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2`\nargocd login <ARGOCD_SERVER>\nargocd account update-password\n```\n```\necho \"test1\"\necho \"test2\"\necho \"test3\"\n```\n\nargocd 에서 helm 이용하기 `argocd app set <name> --values <value.yml>`\n\n#### kubernetes monitoring\nhttps://gruuuuu.github.io/cloud/monitoring-02/#\n1. cluster role\n2. configmap\n3. prometheus deployment\n4. node exporter daemonset & service\n5. prometheus service\n\nconfigmap... 필요한건가\n\n#### istio\n하나의 팟 관리를 위해 각 팟마다 관리용 팟을 생성하는 사이드카 패턴을 이용해서 각 서비스를 관리\n관리용 팟이 들어오고 나가는 네트워크를 모두 처리함으로써 로깅, 모니터링,\n디스커버리 모두 가능해진다\n- 리소스 사용이 2배가 되겠네?\n    - 경량 프록시라서 리소스가 2배는 아니다\n- envoy를 이용해 프록시를 한다\n- 파일럿을 통해 디스커버리, 로드밸런싱\n- 시타델을 이용해 인증서, 키 관리\n\n서비스 메시가 있으면 서비스는 통신에 신경 쓸 필요가 없나?\n- 통신은 메시지로 하고, 서비스 통신의 프록시를 해준다\n\nistio 자체의 gateway를 이용해 라우팅 할 수 있다\n\n#### istio 설치\n```\ncurl -L https://istio.io/downloadIstio | sh -\ncd istio-1.9.0\nexport PATH=$PWD/bin:$PATH\nistioctl install --set profile=demo -y\n```\n\nside inject enable\n```\nkubectl label namespace default istio-injection=enabled\nkubectl label namespace istio-system istio-injection=enabled\n```\napply bookinfo\napply bookinfo-gateway\napply grafana, prometheus\n\n```\nexport INGRESS_HOST=$(minikube ip)\nexport INGRESS_PORT=$(kubectl get svc istio-ingressgateway -n istio-system \\\n                    -o jsonpath='{.spec.ports[?(@.name==\"http2\")].nodePort}')\nexport GATEWAY_URL=$INGRESS_HOST:$INGRESS_PORT\n```\n\n- bookinfo 가 과부하를 일으킨다\n\n#### istio routing /, /tag, /tag/:tag 값 적용시키기\n- httpbin 이라는 서비스로 istio가 예제를 제공해주고 있다.\n- 이걸로 테스트하니까 match로 지정해주지 않아도 하위 url도 다 전달해준다.\n- 여기에 ingress를 달아주니까 주소기반으로 라우팅도 된다.\n    - 같은 호스트로 인그레스를 달아주니까 두 서비스를 섞어서 라우팅해준다\n- ingress에서 path를 /header로 지정해주면 /header로 찾아간다\n    - 주소를 /v2로 해놓았을 때 v2라는 주소가 없으면 루트로 찾아가나?\n        - /, /aaa가 설정되있으면 /ccc를 넣어도 / 가 있어서 /로 인식한다\n    - whoami 서비스는 이상한 주소로 넣어도 다 받아주고, httpbin은 url\n      못찾는다는 에러를 준다.\n    - ingress에서 지정해주는 주소가 루트로 인식하는 줄 알았는데, 그게 아니라\n      매칭을 해주는거였다.\n        - traefik에서는 원하는 주소를 넣을 수 있어서 헷갈렸던 것 같다.\n- ingress에서 여러 주소를 한 서비스에 넣으려면 콤마(,)로 구분하면 된다\n\n#### knative istio\n- before use knative, install istio first.\n\n#### spinnaker\nspinnaker 설치를 halyard를 통해서 해야 한다\n```\nmkdir -p ~/.hal/kube\ncp ~/.kube/config ~/.hal/kube/config\nchmod 755 ~/.hal/kube/config\n\ndocker run -p 8084:8084 -p 9000:9000 \\\n    --name halyard --rm \\\n    -v ~/.hal:/home/spinnaker/.hal \\\n    -it \\\n    us-docker.pkg.dev/spinnaker-community/docker/halyard:stable\n\ndocker exec -it halyard bash\n\n### initial in container\n$ source <(hal --print-bash-completion)\n$ hal config provider kubernetes enable\n$ hal config provider kubernetes account add <my-account> \\\n    --context $(kubectl config current-context)\n$ hal config features edit --artifacts true\n$ hal config deploy edit --type distributed --acount-name <my-account>\n```\n\nset persistent store\n- we will use minio, why?\ninstall minio\n```\nhelm install minio -n spinnaker \\\n    --set accessKey=<access_key> \\\n    --set secretKey=<secret_key> \\\n    stable/minio\n```\n\nspinnaker deploy\n```\n$ hal deploy apply\n! failed check for namespace/spinnaker is null\n> kubectl get pod >> error >> no search file or directory '/home/sh/.minikube/'\n>> cp -r ~/.minikube ~/.hal/\n\n### open access ip\nkubectl edit svc spin-deck -n spinnaker\n# edit ClusterIP to NodePort,\n# add nodePort: 30900\n\nkubectl edit svc spin-gate -n spinnaker\n# edit ClusterIP to NodePort,\n# add nodePort: 30808\n\n$ hal config security ui edit \\\n    --override-base-url \"http://<HOST_IP>:30900\"\n$ hal config security api edit \\\n    --override-base-url \"http://<HOST_IP>:30808\"\n$ hal deploy apply\n```\n\nconnect to '<HOST_IP>:30900' in browser\n\n#### kubernetes를 쓰면서 쉽게 실수하는 10가지\n1. 리소스 설정 (cpu, memory)\n2. 헬스 체크(liveness, readiness)의 차이에 따른 사용\n3. 모든 서비스에 로드밸런서 달아버리는 것\n4. 쿠버네티스가 모르는 자동확장(?)\n5. 권한 관리 부재\n6. Anti Affinity 설정(pod가 node에 분산해서 실행하지 않으므로 명시적 설정 필요)\n7. PodDisruptionBudget 설정(pod 최소필요량(minAvailable))\n8. 클러스터 공유(네임스페이스는 환경 분리가 안되므로 차라리 클러스터를 나눠라)\n9. `externalTrafficPolicy: Cluster` 설정은 네트워크 지연을 일으킬 수 있다\n10. 클러스터를 애완동물처럼 다루기 + 마스터에 너무 큰 부하주는 것\n11. +1. latest tag 사용하는 것\n- https://coffeewhale.com/kubernetes/mistake/2020/11/29/mistake-10/\n\n#### kubernetes in VCNC\n상용 kubernetes를 위한 추가 도구\n\ningress - ingress controller\n- nginx vs aws nlb\n- Class ELB는 동시에 많은 연결을 처리하려면 웜업이 필요하다\n- nlb는 gRPC를 지원하지 않는다.\n- 트래픽 흐름: NLB - NodePort - NGINX ingress controller - service\n    - 외부 로드밸런서를 추가하는 것이 클러스터 오토스케일러를 추가하는 것처럼\n      불가피한 것일까\n\nAWS IAM을 사용하기 위해 kube2iam 사용 (19년 03월) -> EKS에서는 지원될 듯\n\n로그\n- fluentd를 daemonset으로 노드마다 실행해서 cloudwatch로 전송\n- https://github.com/fluent/fluentd-kubernetes-daemonset\n\n모니터링\n\nhttps://engineering.vcnc.co.kr/2019/03/kubernetes-on-aws/\n\n#### eks 참고사항\n쿠버네티스 버전 업 시 전체 노드 새로 올린다?\n\nEKS의 파드들이 IAM을 인증받는 방법은?\n- kube2iam\n\nEKS에서는 워커 노드 당 Pod 개수 제한이 있다 - flannel을 쓰면 해결되지만 기본은\n제약이 있다.\n\nECS, fargate, lambda 차이는?\n- Fargate: 서버리스 컨테이너\n\nAZ, multi region도 지원해주나?\n\n네트워크 구조\n- Region - VPC(논리적) - subnet - AZ - route table - Security groups -\n- vpc, subnet, route table 각각 cidr을 설정 가능하다?\n\nnginx-ingress deprecate 됐고, ingress-nginx를 쓰게 된다.\n\neks에서도 kubernetes metrics-server를 통해서 오토스케일링 조절하나?\n- cluster autoscaler라는게 있다\n\n부하 테스트\n`ab -c 200 -n 200 -t 30 http://$(kubectl get ingress/backend-ingress -o jsonpath='{.status.loadBalancer.ingress[*].hostname}')/contents/aws`\n\n- [ ] provider \"kubernetes\"는 뭐지\n\n#### 배포 후 롤백 테스트\n지금 서버에 버전 두 개 만들어서 올리고 배포 후, 테스트하고 롤백하는 것 10초 컷\ngif로 만들어보기\n\n```\ndocker build -t <image:tag> .\ndocker push <image:tag>\nkubectl set image deployment/<name> <name>=<image:tag> --record\nkubectl rollout history deployment/<name>\n```\n\n띄워져 있어야하는 팟 개수 / 현재 개수 확인 바로 할 수 있는 방법은?\n- `kubectl get deploy -A`\n\n카오스 툴 띄워서 회복 잘 하는지 테스트\n- 동작안함..ㅠㅠ\n\n#### helm을 안쓰고 kubernetes로 가변적인 배포를 쉽게 할 수 없을까\nhelm에 install --values도 values 파일을 작성해야하는데, 이러면 그냥 kubernetes\nsnippet으로 만들어도 큰 차이는 없을 것 같다...\n괜히 helm을 안깔아도 될 것 같은데\n\ngist에 파일을 올려놓고, 설정파일에 이름을 넣어서 이름 확인해서 어떤 gist를\n가져올지만 정해서 불러와서 실행시키면 되겠다.\ngitkube라는 서비스도 있다. kubernetes 안에다가 리소스를 만들어놓고 감시하는\n컨셉이다\n\n이제 세부적인 설정이 필요해지면 어떻게 수정하지\n\n#### 클러스터 네임스페이스 컨텍스트\n- 컨텍스트 안에 클러스터, 사용자, 네임스페이스가 있음\n- $KUBECONFIG 에 새로 생성한 config 파일을 넣으면 --kubeconfig config-demo 명령어를 안쳐줘도 됨\n\n```bash\nsource <(kubectl completion zsh)  # 현재 셸에 zsh의 자동 완성 설정\necho '[[ $commands[kubectl] ]] && source <(kubectl completion zsh)' >> ~/.zshrc # 자동 완성을 zsh 셸에 영구적으로 추가한다.\n```\n\n##### 새로운 유저로 get pod 하기\n- 인증서 등록\n- config-demo 만들기\n- role 만들기\n- roleBinding 만들기\n- CSR 만들기\n- 인증서 approve 하기\n- auth can-i 실행해서 확인\n\u001f\n##### 인증서 재설정 필요\nminikube 재시작 후 서버 포트 변경됨\n- minikube context에서\n- `openssl genrsa -out developer.key 2048`\n- `openssl req -new -key developer.key -out developer.csr -subj \"/CN=developer\"`\n- `k apply CSR.yaml`\n- `k certificate approve developer`\n- `k auth can-i list pods --as developer`\n\n-----------------------------------------------------------------------\n\n## Kubernetes External Library Installation\n#### 설치\n- `curl -s https://packages.cloude.google.com/apt/doc/apt-key.gpg | apt-key add -`\n- `/etc/apt/sources.list.d/kubernetes.list` 파일에\n  - `deb https://apt.kubernetes.io/ kubernetes-xenial main` 입력\n- `apt-get update && apt-get install -y apt-transport-https curl`\n- `apt-get install kubelet kubeadm kubectl`\n- `sudo swapoff -a`\n- `sed -i '9s/^/Environment=\"KUBELET_EXTRA_ARGS=--fail-swap-on=false\"\\n/' /etc/systemd/system/kubelet.service.d/10-kubeadm.conf`\n- `sudo sed -i '/ swap / s/^\\(.*\\)$/#\\1/g' /etc/fstab`\n\n초기화\n- `kubeadm init --pod-network-cidr=10.244.0.0/16 --ignore-preflight-errors Swap`\n\n네트워크 설치\n- flannel\n  - `kubectl apply -f https://github.com/coreos/flannel/raw/master/Documentation/kube-flannel.yml`\n- calico\n  - `kubectl apply -f https://docs.projectcalico.org/v3.10/manifests/calico.yaml`\n- weave\n  - `kubectl apply -f \"[https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n')](https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\\n'))\"`\n\nflannel 설치 시 coredns 안붙음.\ncalico로 설치\nhttps://docs.projectcalico.org/v3.10/getting-started/kubernetes/\n\nSlave node 접속\n- `kubeadm join 192.168.0.3:6443 --token 8nt7ze.bm7pa8pi3t1jgr70\\ --discovery-token-ca-cert-hash  sha256:4337d62bce67b7ebf55466da74dfa8deb7cda3632ce5054bcc24b1fe3fcf2bff`\n\ntoken 생성 및 확인\n- `kubeadm token create`\n- `openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'`\n\nNode 제거\n- `kubectl delete node <node-name>`\n\nMaster reset\n- `kubeadm reset`\n\nscale 늘리기\n- `kubectl scale deploy <deploy_name> --replicas=10`\n\n#### helm\nkubernetes package manager\n\n`curl https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get | cat > /tmp/helm_script.sh \\ && chmod 755 /tmp/helm_script.sh && /tmp/helm_script.sh --version v2.8.2 helm init --upgrade`\n출처: <https://sktelecom-oslab.github.io/Virtualization-Software-Lab/Helm/>\n\n- `kubectl create serviceaccount --namespace kube-system tiller`\n- `kubectl create clusterrolebinding tiller-cluster-rule --clusterrole=cluster-admin --serviceaccount=kube-system:tiller`\n- `helm init --service-account tiller --upgrade`\n- `helm update repo`\n- `helm install stable/redis --version 3.3.5`\n\nrepo 추가\n- `helm repo add stable https://kubernetes-charts.storage.googleapis.com/`\n출처: <https://stackoverflow.com/questions/43499971/helm-error-no-available-release-name-found>\n\nhelm init\n- search\n- install\n- repo update\n- list\n- delete\n\n#### Kompose\ndocker-compose to kubernetes yaml\n출처: https://kubernetes.io/docs/tasks/configure-pod-container/translate-compose-kubernetes/#build-and-push-docker-images\n\n```\ncurl -L https://github.com/kubernetes/kompose/releases/download/v1.21.0/kompose-linux-amd64 -o kompose\nchmod +x kompose\nsudo mv ./kompose /usr/local/bin/kompose\nkompose up\nkompose convert\nkubectl apply -f <file>\nkompose down\n```\n\n#### Statefulset PV SC\nStatefulset을 사용하기 위해 pv를 만들어야 하고\npv를 만들기 위해서 storageclass가 필요\n\nstorageOS 설치\n출처: <https://docs.storageos.com/docs/platforms/kubernetes/install/1.10>\n\nSC default 설정\n- `kubectl patch storageclass fast -p '{\"metadata\": {\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"true\"}}}'`\n출처: <https://proinlab.com/archives/2308>\n\nSC default 해제\n- `kubectl patch storageclass <your-class-name> -p '{\"metadata\": {\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"false\"}}}'`\n\nglusterfs pv pvc 예제\n- https://teamsmiley.github.io/2019/06/29/kubernetes-glusterfs/\n- https://docs.okd.io/latest/install_config/storage_examples/gluster_example.html\n\n\n#### glusterfs 설치\ngfs1, gfs2 라는 서버가 있다고 하자.\n- 양쪽 서버에서 /etc/hosts에 host 이름 둘 다 적어준다\n```\nsudo apt-get install software-properties-common\nsudo add-apt-repository ppa:gluster/glusterfs-5\nsudo apt-get update\nsudo apt install glusterfs-server\nsudo ufw allow proto any from <상대아이피> to <자신아이피>\nsudo service glusterd start\n\nsudo gluster peer probe gfs2 # gfs1에서는 gfs2를, gfs2에서는 gfs1을 둘 다 입력\nsudo mkdir -p /gluster/fs\nsudo gluster volume create vol replica 2 transport tcp gfs1:/gluster/fs gfs2:/gluster/fs force\n# (루트 파티션에는 볼륨 설정 안하기를 권하고 있으나 강제로 가능)\n\nsudo gluster volume start vol\nsudo mkdir -p /mnt/gluster\nsudo mount -t glusterfs <자신아이피>:/vol <마운트할 폴더> # (양쪽 서버에서 실행)\n```\n- /gluster/fs/ 는 파일 저장되는 공간\n- /mnt/gluster 는 마운트 시켜서 사용하는 공간\n\n/etc/fstab에 추가\n- `gfs1:/vol /mnt/gluster glusterfs defaults,_netdev 0 0`\n\npeer 추가 시\n- `gluster volume add-brick glus_vol gluster5:/data1/gluster gluster6:/data1/gluster`\n출처: <http://junhyung2.blogspot.com/2014/12/7-glusterfs.html>\n\nvolume 삭제\n- `gluster volume remove-brick vol_dist vmlnx005:/data`\n출처: <http://blog.syszone.co.kr/3038>\n\nGlusterfs 로 data volume 구성.\n볼륨형태\n- Replication : 완전 복제\n- Distributed : 분산 저장, 파일별로 분산\n- Striped     : 완전 분산 저장, 하나의 파일도 분산, I/O 성능 향상, 하나의 서버가 죽으면 파일 유실\n\nVolume2가 꺼졌다가 켜지면 동기화가 어떻게 되는지?\n\n목표\n- 스웜으로 두개를 킨 후 하나의 서버를 종료 시켜도 접속 가능하게\n- DB 컨테이너 생성 시 볼륨을 시킨다\n\n[[Troubleshooting#kubernetes]]\n","frontmatter":{"title":"Container","summary":"Docker, Kubernetes","date":"2020, 12 17","updated":"2025, 07 23","tags":"deep_knowledge","parent":null},"tableOfContents":"<ul>\n<li>\n<p><a href=\"#container\">Container</a></p>\n<ul>\n<li>\n<ul>\n<li>\n<ul>\n<li><a href=\"#docker-strength\">docker strength</a></li>\n<li><a href=\"#docker-image-vs-compose\">Docker image vs compose</a></li>\n<li><a href=\"#docker-logs\">docker logs</a></li>\n<li><a href=\"#container-1\">container</a></li>\n<li><a href=\"#docker%EC%9D%98-%EC%9C%84%EA%B8%B0\">Docker의 위기?</a></li>\n<li><a href=\"#dockerfile\">Dockerfile</a></li>\n<li><a href=\"#docker-compose%EC%97%90%EC%84%9C-%EB%B9%8C%EB%93%9C-%EB%8B%A8%EA%B3%84%EC%9D%98-%EC%9D%B4%EB%AF%B8%EC%A7%80%EB%A5%BC-%EC%93%B8-%EC%88%98-%EC%9E%88%EC%9D%84%EA%B9%8C\">docker compose에서 빌드 단계의 이미지를 쓸 수 있을까</a></li>\n<li><a href=\"#docker-compose%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%B4-%EC%9D%B4%EB%AF%B8%EC%A7%80%EB%A5%BC-%EB%B0%94%EB%A1%9C-%EB%B0%B0%ED%8F%AC%ED%95%98%EB%8A%94-%EA%B2%83%EA%B3%BC-dockerfile%EC%9D%84-%EC%93%B0%EB%8A%94-%EA%B2%83\">docker-compose를 이용해 이미지를 바로 배포하는 것과 Dockerfile을 쓰는 것</a></li>\n<li><a href=\"#%EB%B0%B0%ED%8F%AC-%EB%BC%88%EB%8C%80-%EB%A7%8C%EB%93%A4%EA%B8%B0\">배포 뼈대 만들기</a></li>\n<li><a href=\"#docker-image\">docker image</a></li>\n<li><a href=\"#docker-compose-execute-bash\">docker compose execute bash</a></li>\n<li><a href=\"#docker-cmd-vs-entrypoint\">docker cmd vs entrypoint</a></li>\n<li><a href=\"#docker-%EA%B0%84-%ED%86%B5%EC%8B%A0\">docker 간 통신</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#kubernetes\">Kubernetes</a></p>\n<ul>\n<li>\n<ul>\n<li>\n<ul>\n<li><a href=\"#resource\">resource</a></li>\n<li><a href=\"#api\">api</a></li>\n<li><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EB%8A%94-os%EC%99%80-%ED%81%B4%EB%9D%BC%EC%9A%B0%EB%93%9C%EB%A5%BC-%EC%B6%94%EC%83%81%ED%99%94%ED%95%A0-%EC%88%98-%EC%9E%88%EB%82%98\">쿠버네티스는 os와 클라우드를 추상화할 수 있나?</a></li>\n<li><a href=\"#kubernetes-volume\">kubernetes volume</a></li>\n<li><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC%EC%9D%98-%EC%9D%B4%ED%95%B4\">쿠버네티스 네트워크의 이해</a></li>\n<li><a href=\"#deploy\">deploy</a></li>\n<li><a href=\"#deployment-kill\">deployment kill</a></li>\n<li><a href=\"#kubernetes-test\">kubernetes test</a></li>\n<li><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%A4%91%EC%97%90-%EB%A7%88%EC%8A%A4%ED%84%B0%EA%B0%80-%EC%9E%90%EC%9B%90%EC%9D%84-%EB%A7%8E%EC%9D%B4-%EC%93%B0%EB%82%98-%EB%85%B8%EB%93%9C%EA%B0%80-%EB%A7%8E%EC%9D%B4%EC%93%B0%EB%82%98\">쿠버네티스 클러스터 중에 마스터가 자원을 많이 쓰나, 노드가 많이쓰나?</a></li>\n<li><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%B3%B5%EC%9E%A1%EC%84%B1%EC%9D%84-%EA%B4%80%EB%A6%AC%ED%95%98%EB%8A%94%EA%B0%80\">쿠버네티스는 어떻게 복잡성을 관리하는가</a></li>\n<li><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%A9%80%ED%8B%B0-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EA%B7%B8-%EC%9D%B4%ED%9B%84\">쿠버네티스 멀티 클러스터 그 이후</a></li>\n<li><a href=\"#docker-kubernetes-istio\">docker kubernetes istio</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#network-resource\">Network Resource</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#nginx-vs-istio\">nginx vs istio</a></li>\n<li><a href=\"#nginx-canary\">nginx canary</a></li>\n<li><a href=\"#kubernetes-supports-cluster\">kubernetes supports cluster</a></li>\n<li><a href=\"#kubernetes-access-remote-cluster\">kubernetes access remote cluster</a></li>\n<li><a href=\"#kubernetes-dns\">kubernetes dns</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#test\">Test</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#test-1\">test</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#plugin\">Plugin</a></p>\n<ul>\n<li>\n<ul>\n<li>\n<p><a href=\"#helm-k3s-kubernetes-cluster-unreachable-error\">helm k3s Kubernetes cluster unreachable error</a></p>\n</li>\n<li>\n<p><a href=\"#eks-vs-ec2-autoscale-and-setting-kubernetes-vs-kubernetes-hpa\">eks vs ec2 autoscale and setting kubernetes vs kubernetes hpa</a></p>\n</li>\n<li>\n<p><a href=\"#container-serverless\">container serverless</a></p>\n</li>\n<li>\n<p><a href=\"#k3s\">k3s</a></p>\n</li>\n<li>\n<p><a href=\"#k3s-monitoring\">k3s monitoring</a></p>\n</li>\n<li>\n<p><a href=\"#k3s-helm\">k3s helm</a></p>\n</li>\n<li>\n<p><a href=\"#k3s-connect-remotely-to-the-cluster\">k3s connect remotely to the cluster</a></p>\n</li>\n<li>\n<p><a href=\"#helm\">helm</a></p>\n</li>\n<li>\n<p><a href=\"#helm-install-from-local\">helm install from local</a></p>\n</li>\n<li>\n<p><a href=\"#turn-on-and-access-to-grafana-in-kubernetes-nodes\">turn on and access to grafana in kubernetes nodes</a></p>\n</li>\n<li>\n<p><a href=\"#kubernetes-load-balancer\">kubernetes load balancer</a></p>\n</li>\n<li>\n<p><a href=\"#kubernetes-network-service-test\">kubernetes network service test</a></p>\n</li>\n<li>\n<p><a href=\"#kubernetes-tool\">kubernetes tool</a></p>\n</li>\n<li>\n<p><a href=\"#deploy-1\">deploy</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%9D%B8%ED%94%84%EB%9D%BC-%EA%B4%80%EB%A0%A8-%ED%88%B4%EA%B3%BC-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B4%80%EB%A0%A8-%ED%88%B4%EC%9D%84-%EB%B6%84%EB%A6%AC%ED%95%98%EB%A9%B4-%EC%A2%8B%EC%9D%84-%EA%B2%83-%EA%B0%99%EB%8B%A4\">인프라 관련 툴과 서비스 관련 툴을 분리하면 좋을 것 같다</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%84%A4%EC%9E%84%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4%EB%A5%BC-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%B6%84%EB%A6%AC%ED%95%A0%EA%B9%8C\">쿠버네티스 네임스페이스를 어떻게 분리할까</a></p>\n</li>\n<li>\n<p><a href=\"#kubernetes-local-image-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\">kubernetes local image 사용하기</a></p>\n</li>\n<li>\n<p><a href=\"#rbac\">RBAC</a></p>\n</li>\n<li>\n<p><a href=\"#argocd\">argocd</a></p>\n</li>\n<li>\n<p><a href=\"#kubernetes-monitoring\">kubernetes monitoring</a></p>\n</li>\n<li>\n<p><a href=\"#istio\">istio</a></p>\n</li>\n<li>\n<p><a href=\"#istio-%EC%84%A4%EC%B9%98\">istio 설치</a></p>\n</li>\n<li>\n<p><a href=\"#istio-routing--tag-tagtag-%EA%B0%92-%EC%A0%81%EC%9A%A9%EC%8B%9C%ED%82%A4%EA%B8%B0\">istio routing /, /tag, /tag/:tag 값 적용시키기</a></p>\n</li>\n<li>\n<p><a href=\"#knative-istio\">knative istio</a></p>\n</li>\n<li>\n<p><a href=\"#spinnaker\">spinnaker</a></p>\n</li>\n<li>\n<p><a href=\"#kubernetes%EB%A5%BC-%EC%93%B0%EB%A9%B4%EC%84%9C-%EC%89%BD%EA%B2%8C-%EC%8B%A4%EC%88%98%ED%95%98%EB%8A%94-10%EA%B0%80%EC%A7%80\">kubernetes를 쓰면서 쉽게 실수하는 10가지</a></p>\n</li>\n<li>\n<p><a href=\"#kubernetes-in-vcnc\">kubernetes in VCNC</a></p>\n</li>\n<li>\n<p><a href=\"#eks-%EC%B0%B8%EA%B3%A0%EC%82%AC%ED%95%AD\">eks 참고사항</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%B0%B0%ED%8F%AC-%ED%9B%84-%EB%A1%A4%EB%B0%B1-%ED%85%8C%EC%8A%A4%ED%8A%B8\">배포 후 롤백 테스트</a></p>\n</li>\n<li>\n<p><a href=\"#helm%EC%9D%84-%EC%95%88%EC%93%B0%EA%B3%A0-kubernetes%EB%A1%9C-%EA%B0%80%EB%B3%80%EC%A0%81%EC%9D%B8-%EB%B0%B0%ED%8F%AC%EB%A5%BC-%EC%89%BD%EA%B2%8C-%ED%95%A0-%EC%88%98-%EC%97%86%EC%9D%84%EA%B9%8C\">helm을 안쓰고 kubernetes로 가변적인 배포를 쉽게 할 수 없을까</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EB%84%A4%EC%9E%84%EC%8A%A4%ED%8E%98%EC%9D%B4%EC%8A%A4-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8\">클러스터 네임스페이스 컨텍스트</a></p>\n<ul>\n<li><a href=\"#%EC%83%88%EB%A1%9C%EC%9A%B4-%EC%9C%A0%EC%A0%80%EB%A1%9C-get-pod-%ED%95%98%EA%B8%B0\">새로운 유저로 get pod 하기</a></li>\n<li><a href=\"#%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%9E%AC%EC%84%A4%EC%A0%95-%ED%95%84%EC%9A%94\">인증서 재설정 필요</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#kubernetes-external-library-installation\">Kubernetes External Library Installation</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%EC%84%A4%EC%B9%98\">설치</a></li>\n<li><a href=\"#helm-1\">helm</a></li>\n<li><a href=\"#kompose\">Kompose</a></li>\n<li><a href=\"#statefulset-pv-sc\">Statefulset PV SC</a></li>\n<li><a href=\"#glusterfs-%EC%84%A4%EC%B9%98\">glusterfs 설치</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>"}},"pageContext":{"slug":"/container/","previous":{"fields":{"slug":"/talk/"},"frontmatter":{"title":"Communication","tags":"communication"},"fileAbsolutePath":"/home/runner/work/shdkej.github.io/shdkej.github.io/content/Communication/Talk.md"},"next":{"fields":{"slug":"/life_tracking/"},"frontmatter":{"title":"Life Tracking","tags":null},"fileAbsolutePath":"/home/runner/work/shdkej.github.io/shdkej.github.io/content/blog/Life_Tracking.md"},"filePath":"Deep Knowledge/Container.md"}},"staticQueryHashes":["3000541721","4165914708","488914979"],"slicesMap":{}}