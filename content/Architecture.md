---
title   : Infra Architecture
summary : ğŸš€ Server Infra Architecture
date    : 2020-05-07 20:51:37 +0100
updated : 2021-05-27 14:51:35 +0900
tags    : strong_base
---

## Goal
ì¸í”„ë¼ êµ¬ì¶• ë° ë°°í¬ë¥¼ ì‰½ê³  ë¹ ë¥´ê²Œ, í”¼ë“œë°±ì„ ì˜ ë°›ì•„ ì ì§„ì ìœ¼ë¡œ ë°œì „í•˜ëŠ” í™˜ê²½

#### More
- check feedback
    - ì–´ë–¤ í•­ëª©ì„ ë´ì•¼ ì´ê²ƒì´ ì˜ ì§„í–‰ë˜ëŠ”ì§€ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤
    - ë³€í™”ì˜ ê¸°ë¡ì„ ì±™ê²¨ì•¼ í•œë‹¤ (following changed thing)
- local loading file time > 0.4s
- external network time > 0.4s. - total 0.8s
- ë°±ì—… ì˜ í•´ì•¼ í•œë‹¤. ë°±ì—… ì „ëµì„ ì„¸ì›Œì•¼ í•œë‹¤
- auto scaling
- auto recovery
- ì‹œìŠ¤í…œ êµ¬ì„±ì„ í•˜ë‚˜í•˜ë‚˜ ê²€ì¦í•˜ë©° ë„ì…í•˜ê¸°
- ì¬ì‚¬ìš©ì„±
- ë³µì¡ë„ëŠ” ë‚®ì¶”ê³  ì‹¶ê³  ì„œë¹„ìŠ¤ëŠ” ë§ì´ ë§Œë“¤ê³  ì‹¶ë‹¤
- ë°°í¬ìš© ì´ë¯¸ì§€ë¥¼ ë§Œë“ ë‹¤.
  ë°°í¬ìš© ì´ë¯¸ì§€ëŠ” í•­ìƒ ì²˜ìŒë¶€í„° ìƒˆë¡œ ë¹Œë“œë˜ì–´ì•¼ í•œë‹¤.
  ë®ê³  ë®ëŠ” ë°©ì‹ì€ ë¶ˆí™•ì‹¤ì„±ì„ ì¦ê°€ì‹œí‚¨ë‹¤.
- ë„ë©”ì¸ì„ ìƒê°í•˜ì. ë„ë©”ì¸ì´ ë””ìì¸ì„ ë§Œë“ ë‹¤.
- Fail_Fast
- ê³ íš¨ìœ¨ ì €ë¹„ìš©

- ë®ëŠ” ë°©ì‹ì¸ í”„ë ˆì„ì›Œí¬ë³´ë‹¤ ë¶™ì´ëŠ” ë°©ì‹ì¸ ì–´ëŒ‘í„° ë°©ì‹ì´ ì¢‹ë‹¤
- ë‚´ë¶€ì ìœ¼ë¡œëŠ” íš¨ìœ¨ì„ ìµœëŒ€ë¡œ í•˜ë˜
  ì‚¬ëŒë“¤ì€ ì«™ë¹ ì§„ ê²ƒë³´ë‹¤ ë„‰ë„‰í•œ ê²ƒì„ ë” ì¢‹ì•„í•˜ëŠ” ì ì„ ìƒê°í•œë‹¤
- User experience searchable website
- ì„œë¹„ìŠ¤ëŠ” ê´€ë¦¬ìê°€ ê´€ë¦¬í•˜ì§€ë§ê³  ì‚¬ìš©ìê°€ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•˜ë©´ ì¢‹ê² ë‹¤

[[Information#ì¢‹ì€ ì•„í‚¤í…íŠ¸ëŠ” ì„¸ë¶€ì‚¬í•­ì— ëŒ€í•œ ê²°ì •ì„ ê°€ëŠ¥í•œ í•œ ì˜¤ë«ë™ì•ˆ ë¯¸ë£° ìˆ˜ ìˆëŠ” ë°©í–¥ìœ¼ë¡œ ì •ì±…ì„ ì„¤ê³„í•œë‹¤.]]
[[Think#server architecture to using some company service]]

## Summary
- code with log, test, api
- CI with lint, test, performance, dependency
- CD with deploy
- Monitoring with check node, api, log, performance

#### Need Component
- MQ
- M/L
- Elasticsearch
- [[Information#ë¬´ì§ˆì„œí•œ ì›ìˆ­ì´(Chaos Monkey)]]
- new software to kubernetes cluster

## Check Point
ìˆ˜ì‹œ ë°°í¬
- ê²°ê³¼ë¥¼ ë¹ ë¥´ê²Œ í™•ì¸ ê°€ëŠ¥
- ì—ëŸ¬ í™•ë¥  ì¦ê°€ - ë¹ ë¥¸ ë¡¤ë°±ìœ¼ë¡œ ìœ„í—˜ë„ ë‚®ì¶œ ìˆ˜ ìˆìŒ

ì£¼ê°„ ë°°í¬
- ë„ˆë¬´ í° ë°°í¬ ë‹¨ìœ„ê°€ ë  ìˆ˜ ìˆìŒ
- í…ŒìŠ¤íŠ¸ ìƒíƒœì˜ ê²°ê³¼ì™€ ì‹¤ì œ ê²°ê³¼ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ
- ë°°í¬ì¼ìì— ì—ëŸ¬ ì§‘ì¤‘

ê°•ì œì„±ì„ ì–¼ë§Œí¼ í• ì§€, ììœ¨ì„±ì„ ì–¼ë§Œí¼ í• ì§€

ì—…ë¬´ê°€ ê°€ëŠ¥í•œì§€ ì•„ë‹Œì§€ íŒë‹¨í•  ë°©ë²•
- ì—…ë¬´ë¥¼ ë°›ìœ¼ë©´ ì–´ë–»ê²Œ ì‹œì‘í•˜ë©´ ì¢‹ì„ì§€? ê´€ê³„ê°€ ì–´ë–»ê²Œ ë˜ìˆëŠ”ì§€ ì•Œì•„ì•¼ í•˜ëŠ”ë°..

SOLID - Open Closed Principle
ë³€í™”ë¥¼ ìµœì†Œí™” í•˜ê¸° ìœ„í•´ ë³€í™” ì˜ˆìƒê°€ëŠ¥í•œ ë¶€ë¶„ì„ ì„¤ê³„ì‹œ ë‚˜ëˆ ë†“ì•„ì•¼ í•œë‹¤ëŠ” ì›ì¹™ì¸ë°
ê·¸ ê¸°ì¤€ì„ ì„ ì–´ë–»ê²Œ ì„¤ì •í•˜ëŠëƒê°€ ì¤‘ìš”í•  ê²ƒ ê°™ë‹¤

divide code / config file

ìì£¼ ë³€í•˜ëŠ” ê²ƒê³¼ ìì£¼ ë³€í•˜ì§€ ì•ŠëŠ” ê²ƒ ê³ ë ¤í•˜ê¸°
ìì£¼ ë³€í•˜ì§€ ì•ŠëŠ” ê²ƒì€ ì‹ ê²½ ì•ˆì¨ë„ ë˜ë„ë¡ í•˜ê¸°

ë””ë ‰í† ë¦¬ ë‹¨ìœ„ë¥¼ ê¸°ëŠ¥ë³„ë¡œ í• ì§€, ì—­í• ë³„ë¡œ í• ì§€
- ì½”ë“œ ë¶„ë¦¬ ê¸°ì¤€
  íšŒì‚¬ì—ì„œëŠ” ë ˆì´ì–´ë³„ë¡œ ë‚˜ëˆ´ë‹¤
  ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì—ì„œëŠ” ê¸°ëŠ¥ë³„ë¡œ ë‚˜ëˆˆë‹¤

monorepo vs microrepo
- ê¹Šì´ vs ë„“ì´
- ë””ë ‰í† ë¦¬ë¥¼ ì¤‘ì²©ì‹œì¼œ í•œ ë ˆí¬ ì•ˆì— ë‘˜ì§€
- ë””ë ‰í† ë¦¬ê°€ ì¤‘ì²©ë˜ë©´ í”„ë¡œì íŠ¸ë¥¼ ë¶„ë¦¬ ì‹œì¼œ ë ˆí¬ë¥¼ ë‚˜ëˆŒì§€

ê°œë°œì€ docker composeë¡œ ìš´ì˜ì€ kubernetesë¡œ í•˜ë„ë¡ ì‚¬ëŒë“¤ì„ ìœ ë„í•  ìˆ˜
ìˆì„ê¹Œ? ë‚˜ëŠ” ì´ë ‡ê²Œ ì‘ì—…í•˜ê³  ìˆëŠ”ê°€?

íšŒì‚¬ì˜ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ìì²´ì ìœ¼ë¡œ êµ¬ì¶•í•œ ê²ƒì„ ì“°ëŠëƒ, ì˜ ê°€ì ¸ë‹¤ ì“°ëŠëƒ
- ë‚˜ì˜ ì•„í‚¤í…ì²˜ë¥¼ ë„ˆë¬´ ì¢‹ì•„í•˜ê²Œ ë˜ë©´
  ë‹¤ë¥¸ ì•„í‚¤í…ì²˜ë¥¼ ê±°ë¶€í•˜ê²Œ ë˜ê±°ë‚˜ ë³´ê¸° í˜ë“¤ì–´ì§€ì§€ ì•Šì„ê¹Œ
- ë‚´ ì•„í‚¤í…ì²˜ë¥¼ ë§Œë“¤ê¸°ë³´ë‹¤ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ ì•„í‚¤í…ì²˜ë¥¼ ë°›ì•„ë“¤ì´ëŠ”ê²Œ ë‚˜ì„ê¹Œ
- [[About_Development#ì¿ íŒ¡ì´ ìì²´ì ìœ¼ë¡œ ë§Œë“  ì„œí‚·ë¸Œë ˆì´ì»¤ì™€ api gateway]]

í•˜ë‚˜ì˜ íˆ´ê³¼ ì¢…ì†ì„±
- ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ê¸°ëŠ¥ì„ ëª¨ë‘ ì“°ëŠ” ê²ƒì´ ë‹¤ë¥¸ ë„êµ¬ë¥¼ ì¤„ì¼ ìˆ˜ ìˆëŠ” ë°©ë²•ì´ë‹¤.
  ê·¼ë° ê·¸ëŸ¬ë©´ ì¿ ë²„ë„¤í‹°ìŠ¤ì— ì¢…ì†ì„±ì´ ì‹¬í•˜ê²Œ ê±¸ë¦°ë‹¤

-----------------------------------------------------------------------

## Monitoring
- urgent
- important

#### system
- ë³´ì•ˆ (ë¡œê·¸ì¸ ì²´í¬)
- load average
- error message
- memory
- disk
- network + time wait port
- https://www.mimul.com/blog/linux-server-operations/

#### web
- api response time
- ì›¹ ìš”ì²­ëŸ‰
- homepage health
- ì ‘ì†ì ë¡œê·¸
- ì ‘ì†í•œ í˜ì´ì§€
- ì‚¬ëŒë“¤ì´ ì–´ë–¤ ë©”ë‰´ë¥¼ ë§ì´ ì“°ëŠ”ì§€ í™•ì¸

#### ì›¹ ì„±ëŠ¥ í™•ì¸ ì§€í‘œ
- DNS Lookup time
- tcp ì—°ê²° ì‹œê°„ (ë¸Œë¼ìš°ì €ì™€ ì„œë²„ê°„ ì—°ê²° ì‹œê°„)
- SSL ì—°ê²° ì‹œê°„
- ì²« ë²ˆì§¸ ë°”ì´íŠ¸ ë‹¤ìš´ë¡œë“œ ì‹œê°„
- ì „ì²´ ë‹¤ìš´ë¡œë“œ ì‹œê°„

#### ë©”ì¸ ëª¨ë‹ˆí„°ë§ íŒë„¬ì—ì„œ ë³´ì—¬ì ¸ì•¼ í•  ê²ƒë“¤
node ëŒ€ìˆ˜
cpu, memory ì‚¬ìš©ëŸ‰
ì‘ë‹µëŸ‰
ì²˜ë¦¬ ì‹œê°„
- cpu, memory, disk, network

#### monitoring
- application, framework, os, cloud ì´ ì •ë„ê°€ ê¸°ë³¸ ê´€ë¦¬ ì˜ì—­ì´ê² ë‹¤.
- ì •ìƒ ìƒíƒœë¥¼ ì¶”ê°€í•´ì•¼í•œë‹¤. ë²”ìœ„ë¥¼ ì •í•´ì„œ ì´ ì •ë„ë©´ ì •ìƒì¸ ë²”ìœ„ë¡œ ë†“ê³ , ì •ìƒ
  ë²”ìœ„ ë‚´ë¥¼ ê³„ì† ê±´ë“œë ¤ì„œ ì¹´ì˜¤ìŠ¤ í…ŒìŠ¤íŒ… í•˜ê³ , ë²”ìœ„ ë²—ì–´ë‚œ ê°’ì€ ë‹¤ ì•Œë¦¼
  ë³´ë‚´ë„ë¡ í•´ë³´ë©´ ì¢‹ê² ë‹¤

#### etc
- ê° ì„œë¹„ìŠ¤ ìƒíƒœ
- ë…¸ë“œ ì‚´ì•„ ìˆëŠ”ì§€ ì²´í¬
- ì ‘ì†ì ìˆ˜
- ì‘ë‹µì‹œê°„
- ì²˜ë¦¬ì‹œê°„
- DB ê´€ë ¨
- ì ‘ì†í•œ ì–´í”Œë¦¬ìºì´ì…˜
- ë¶€í•˜ìœ¨
- ì•ŒëŒ
- docker up/total
- íŠ¸ë˜í”½ ê´€ë¦¬
- GCDN
- static code analysis
- lambda, ec2, s3, Dynamodb
- GCP

#### íŠ¸ë˜í”½ì„ ì¸¡ì •í•˜ëŠ” ë°©ë²•?
tps
ì ‘ì†ì ìˆ˜
resource usage
page view
api count
loading time
response time

#### ì„œë²„ë¥¼ ì˜¤ë˜ ì¼œë†“ì•˜ì„ ë•Œ ìƒê¸°ëŠ” ë¬¸ì œì 
ì•„íŒŒì¹˜ì—ì„œ ë™ì‹œì‘ì—…ì„ ìœ„í•´
ìì‹ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•˜ë„ë¡ í•˜ê³ , ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤ì™€ ë©”ëª¨ë¦¬ë¥¼ ì¼ì • ë¶€ë¶„ ê³µìœ í•˜ë©´ì„œ
ë©”ëª¨ë¦¬ë¥¼ ì ˆì•½í•˜ëŠ”ë°,
ê³µìœ ë˜ëŠ” ë©”ëª¨ë¦¬ì˜ ì–‘ì´ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì ì–´ì ¸ì„œ ìì‹ í”„ë¡œì„¸ìŠ¤ë¥¼ ì¬ì‹œì‘
í•´ì¤˜ì•¼í•œë‹¤ê³  í•œë‹¤

ì´ì²˜ëŸ¼ ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ì„±ëŠ¥ ì €í•˜ë¥¼ ì¼ìœ¼í‚¤ëŠ”ê²Œ ìˆìœ¼ë©´ í™•ì¸í•´ë´ì•¼ê² ë‹¤

ê·¸ì•¼ë§ë¡œ ì¼œë†“ê³ ë§Œ ìˆì—ˆëŠ”ë° ì„±ëŠ¥ì´ ì•ˆì¢‹ì•„ì§€ëŠ” ì›ì¸ ì¤‘ í•˜ë‚˜ì˜€ë‹¤

ë¦¬ëˆ…ìŠ¤ì—ì„œ jiffies ë¼ëŠ” ë³€ìˆ˜ê°€ 32ë¹„íŠ¸ë¼ 500ì¼ ì •ë„ ì§€ë‚˜ë©´ ì˜¤ë²„í”Œë¡œìš° ë  ìˆ˜
ìˆì—ˆëŠ”ë° ìµœì‹  ì»¤ë„ì€ 64ë¹„íŠ¸ë¡œ í• ë‹¹ë˜ì–´ ìµœì‹  ì»¤ë„ì„ ì“°ë©´ ë„‰ë„‰í•´ì§„ë‹¤

ì¿ ë²„ë„¤í‹°ìŠ¤ë‹¨, ë¦¬ëˆ…ìŠ¤ë‹¨, ê¸°íƒ€ ì„œë¹„ìŠ¤ë‹¨ì—ì„œ ì²´í¬ í•„ìš”
ì£¼ë¡œ ë°ì´í„°ê°€ ìŒ“ì´ê±°ë‚˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ìŒ“ì¼ ë•Œ ë¬¸ì œê°€ ìƒê¸´ë‹¤

#### ëª¨ë‹ˆí„°ë§ ë²”ì£¼
í”„ë¡œíŒŒì¼ë§
ë¡œê¹…
íŠ¸ë ˆì´ì‹±
ë©”íŠ¸ë¦­
ì•Œë¦¼
ë””ë²„ê¹…
ì¶”ì„¸ íŒŒì•…(íŠ¸ë Œë”©)
í”ŒëŸ¬ë°

#### reference
- https://andromedarabbit.net/ë¬´ì—‡ì„-ëª¨ë‹ˆí„°ë§í• -ê²ƒì¸ê°€/
    - AWS, Kubernetes ë“±ì—ì„œì˜ ëª¨ë‹ˆí„°ë§ íŒŒë¼ë¯¸í„°
- https://www.mimul.com/blog/linux-server-operations/
    - ë¦¬ëˆ…ìŠ¤ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ìŠ¤í¬ë¦½íŠ¸
- [CPU ì§€í‘œ](https://brunch.co.kr/@leedongins/75)
- [ë¦¬ëˆ…ìŠ¤ 60ì´ˆ ì•ˆì— ìƒí™© íŒŒì•…í•˜ê¸°](https://luavis.me/server/linux-performance-analysis)

-----------------------------------------------------------------------

## Distributed Systems
#### how to test
#### when would you use request/reply and publish/subscribe


## Security
- how to manage ssh key?
  1. make every each computer
  2. keep other storage

[[Linux#ì„œë²„ ë³´ì•ˆ ì„¤ì •]]

#### jwt, oauth, session
- token can make easy check current users count?

#### double check, error handling, logging, security

#### reference
- [ì•”í˜¸í™” ì´ê²ƒë§Œ ì•Œë©´ ëœë‹¤](https://www.slideshare.net/ssuser800974/ss-76664853)

## cloud
í´ë¼ìš°ë“œëŠ” í¸ë¦¬í•˜ì§€ë§Œ ë‚´ë¶€ë¥¼ í†µì œí•  ìˆ˜ ì—†ë‹¤
- AWS, GCP, AZURE
- server -> lambda -> dynamodb -> server
- web, db, lambda, mq
- cognito
- cloud program micro service - use app engine
- lambda <-> sns server <-> web server

#### ec2 ì¸ìŠ¤í„´ìŠ¤ ë¦¬ì†ŒìŠ¤ ìš”ê¸ˆ í•­ëª©
ì¸ìŠ¤í„´ìŠ¤ ìœ ì§€í•˜ëŠ”ë° ë¹„ìš©ì€ í‘œì‹œëœë§Œí¼ ë‚˜ì˜¤ëŠ”ë° ì‚¬ìš©í•˜ë‹¤ë³´ë©´ ê·¸ ì™¸ì— ì¶”ê°€ ìš”ê¸ˆì´
ìƒê¸´ë‹¤
public static ip
bandwidth (per GB)

#### aws ì„œë²„ë“¤ ê°„ ë²¤ì¹˜ë§ˆí¬
- https://dev.to/yaorenjie/benchmarks-of-aws-ec2-5-4-3-series-1kpl
- C (cpu) / M (general) / R (memory) ì‹œë¦¬ì¦ˆê°€ ìˆê³ , 3, 4, 5ì„¸ëŒ€ë¡œ ë°œì „í•˜ê³  ìˆë‹¤
- ì‹±ê¸€ì½”ì–´ì—ì„œëŠ” ì‹œë¦¬ì¦ˆë³„ ì°¨ì´ëŠ” ê±°ì˜ ì—†ë‹¤
- AMD ì„œë²„ëŠ” CPUëŠ” 20% ë¹ ë¥´ì§€ë§Œ ë©”ëª¨ë¦¬ëŠ” 25% ëŠë ¸ë‹¤

#### kubernetes ì…‹íŒ…ì„ ìœ„í•œ cloud hosting ìì› ì¢…ë¥˜
- control plane (aks, gke ...)
- compute instance (on demand, reserved, spot)
  - kubernetes cluster need at least 3.5GB of RAM
- load balancer
- disk storage
- container registry
- https://georgepaw.medium.com/how-to-run-the-cheapest-kubernetes-cluster-at-1-per-day-9287abb90cee

#### server stress test
- redis i/o test
- go http server
- kubernetes pod
- simple http server stress test

1. find report
2. manual test
    - make test code
      - while
      - concurrent
    - curl
      - `ulimit -n` -> 1024 (default) -> `ulimit -n 10000`
      - `while true; do curl localhost; done`

- it depends on CPU, memory

## í”„ë¡œë•ì…˜ì— í•„ìš”í•œ ì†ì„±
ë³´ì•ˆ, ê°œë³„ ì„¤ì •ì„ ìœ ì—°í•˜ê²Œ í•˜ëŠ” ê²ƒ, ê´€ì¸¡ì„±
